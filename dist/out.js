(()=>{"use strict";const e={events:{},addEventListener(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):(console.warn(`${this.constructor.name} added event listener for ${e} despite not being pre-defined.`),this.events[e]=[t])},addEventListeners(e){for(const t in e)this.addEventListener(t,e[t])},on(e,t){return this.addEventListener(e,t),this},triggerEvent(e,...t){if(this.events.hasOwnProperty(e))for(let n of this.events[e])n(...t);else console.warn(`${this.constructor.name} triggered unknown event ${e} with args ${t}`)}};class t{constructor(e){if(this.constructor===t)throw new Error("Cannot instantiate base Usetype class.");e.hasNoval&&(this.hasNoval=!0,this.novalVal=e.novalVal),e.isConstant&&(this.isConstant=e.isConstant,this.constantVal=e.constantVal),e.potentialIds&&(this.potentialIds=!0),e.ambiguousSets&&(this.ambiguousSets=e.ambiguousSets),e.limitExceeded&&(this.ignored=!0)}format(e){throw new Error("Abstract baseclass Usetype.format() called.")}deformat(e){throw new Error("Abstract base class Usetype.deformat() called.")}toString(){return"U{undefined}"}toFormatString(){return""}toDebugString(){return"Usetype::Base()"}isSubsetOf(e){throw new Error("Abstract base class Usetype.isSubsetOf() called.")}isSupersetOf(e){throw new Error("Abstract base class Usetype.isSupersetOf() called.")}isEqualTo(e){throw new Error("Abstract base class Usetype.isEqualTo() called.")}isSimilarTo(e){throw new Error("Abstract base class Usetype.isSimilarTo() called.")}compatibleTypes=[];type="undefined";domainType="none";priority=-1}const n={countries:{url:"https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-abbreviation.json",extract:e=>{n.countries.names=e.map((e=>e.country)),n.countries.codes=e.map((e=>e.abbreviation))}},currencies:{url:"https://gist.githubusercontent.com/Fluidbyte/2973986/raw/8bb35718d0c90fdacb388961c98b8d56abc392c9/Common-Currency.json",extract:e=>{let t=Object.keys(e);n.currencies.codes=t,n.currencies.symbols=t.map((t=>e[t].symbol)),n.currencies.nativeSymbols=t.map((t=>e[t].symbol_native))}},cities:{url:"https://raw.githubusercontent.com/lutangar/cities.json/master/cities.json",extract:e=>{n.cities.names=e.map((e=>e.name)),n.cities.codes=e.map((e=>e.country))}}};let i=!1;!function(){if(!i){for(let e in n){let t;fetch(n[e].url).then((e=>e.json())).then((t=>n[e].extract(t))).catch((n=>(console.error("parse.constants.js fetch item",e,"failed with err",n),t.text())))}i=!0}}();const r=function(){let e=n.currencies;return e&&e.symbols?e.symbols:[]},s=function(){let e=n.currencies;return e&&e.abbreviations?e.abbreviations:[]},a=function(e){return["yotta","zetta","exa","peta","tera","giga","mega","kilo","hecto","deca","","deci","centi","milli","micro","nano","pico","femto","atto","zepto","yocto"]},o=function(e){return["Y","Z","E","P","T","G","M","k","h","da","","d","c","m","μ","n","p","f","a","z","y"]},l=function(e){return["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td"]};function c(e){return new Set(e).size!==e.length}function u(e,t){return e.every((e=>t.includes(e)))}function h(e,t){return e.filter((e=>t.includes(e)))}function d(e,t,n=!1,i=!1){let r=e.map((e=>[e,t])).flat(1);return n&&r.splice(0,0,t),i||r.splice(-1,1),r}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let m=(window.verbose??{}).number;if(console.log("parse.num.js verbosity = ",m),m)var f=window.console;else f={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>f[e]=window.console[e]));function g(e,t){const n=(t,n)=>{f.warn(`Number Recognizer (CSV line ${t} = ${e[t]}): ${n}`)},i=[".",","," "," "],r=[".",","],s=(a=i.concat(r),[...new Set(a)]);var a;const o=new RegExp("^["+s.join("")+"\\d]+$");let l=[],c=[],u=!1,h=!1,d=!1,p=!1,m=!1,g=[];for(let t=0,a=e.length;t<a;t++){let a=e[t],f="",x=a.match(/^[^0-9]*[^0-9+-]/);x&&(f=x[0],a=a.replace(x[0],""));let S="",w=a.match(/[^.0-9][^0-9]*$/);w&&(S=w[0],a=a.replace(w[0],""));let T=!1,v=a.match(/e[0-9]+$/);v&&(T=!0,a=a.replace(v[0],""));let _=!1,M=!1,O=a.match(/^[-+]/);if(O&&("+"===O[0]&&(M=!0),_=!0,a=a.replace(O[0],"")),!a.match(o)){n(t,`Stripped sample ${a} not in pure numeric form .`),window.purePat=o;continue}let D=i.filter((e=>a.includes(e))),k=r.filter((e=>a.includes(e))),E=[],Y=s.filter((e=>a.includes(e)));if(0!==a.length){if(0===Y.length)E.push(["",""]);else if(1===Y.length){let e=Y[0];y(a,e)&&E.push([e,""]),b(a,e)&&E.push(["",e])}else{let e=!1;for(let t of D)for(let n of k){if(t===n)continue;if(!y(a,t))continue;if(!b(a,n))continue;let i=a.split(t).join("").split(n).join(".");isNaN(parseFloat(i))||(E.push([t,n]),console.error("ALSEP",[t,n]),e=!0)}if(!e){n(t,`Failed to parse ${a} using parseFloat with any combination of separators.`);continue}}f&&l.push(f),S&&c.push(S),u&=_,h&=M,d=!1,p=!1,m&=T,g=g.concat(E)}else n(t,`Sample ${e[t]} empty after stripping process.`)}let S=[];for(let e of g){let n=new x({prefixes:l,suffixes:c,separators:e,integral:!e[1],scientific:m,explicitSign:h},t);S.push(n)}let w=!0;for(;w;){w=!1;for(let e=0;e<S.length;e++){for(let t=0;t<S.length&&(e===t||(S[e].isEqualTo(S[t])||S[e].isSupersetOf(S[t])?(S.splice(t),w=!0):S[t].isSupersetOf(S[e])&&(S.splice(e),w=!0),!w));t++);if(w)break}}return S}function y(e,t){let n=e.split(t);return!(n[0].length>3)&&(3===n[n.length-1].length||!n[n.length-1].match(/^[0-9]+$/))&&n.slice(1,-1).every((e=>3===e.length||e.match(/\D/)))}function b(e,t){let n=e.match(new RegExp(p(t),"g"));return n&&1===n.length}class x extends t{constructor({separators:e=[],prefixes:t=[],suffixes:n=[],scientific:i=!1,strictlyPositive:r=!1,explicitSign:s=!1},a){console.log("Number ctor",a),super(a),e.length>0&&""!==e[0]&&(this.thousandSeparator=e[0]),e.length>1&&""!==e[1]?this.decimalSeparator=e[1]:this.integral=!0,e.length>2&&e[2]===e[0]&&(this.separateDecimalThousands=!0),i&&(this.scientific=!0),r&&(this.strictlyPositive=!0),s&&(this.explicit=!0),this.prefixes=t;let o=S(this.prefixes);"unknown"!==o.type&&(this.prefixes=o.domain,this.prefixPlaceholder=o.type),this.suffixes=n;let l=S(this.suffixes);"unknown"!==l.type&&(this.suffixes=l.domain,this.suffixPlaceholder=l.type)}prefixes=[];suffixes=[];decimalSeparator="";thousandSeparator="";separateDecimalThousands=!1;scientific=!1;explicit=!1;min=void 0;max=void 0;format(e){function t(e,t,n){return(n?e.match(/.{1,3}/g):e.match(/.{1,3}(?=(.{3})*$)/g)).join(t)}let n=this.prefixPlaceholder??this.prefixes,i=this.suffixPlaceholder??this.suffixes;if(this.scientific){let t=e.toFixed(1).indexOf(".")-1;e/=10**t,suffix="e"+t+suffix}this.explicit&&e>=0&&(prefix+="+");var r=(this.decimalPlaces?e.toFixed(this.decimalPlaces):e.toString()).split("."),s=r[0];if(this.integerPlaces>0&&r[0].length<this.integerPlaces&&(s="0".repeat(this.integerPlaces-s.length)+s),s=t(r[0],this.thousandSeparator,!1),this.integral)return n+s+i;var a="0";return r.length>1&&(a=r[1]),this.decimalPlaces>0&&r[1].length<this.decimalPlaces&&(a+="0".repeat(this.decimalPlaces-a.length)),this.separateDecimalThousands&&(a=t(r[1],this.thousandSeparator,!0)),n+s+this.decimalSeparator+a+i}deformat(e){let t=e;return this.prefixes.forEach((e=>t.startsWith(e)&&(t=t.slice(e.length)))),this.suffixes.forEach((e=>t.endsWith(e)&&(t=t.slice(0,t.length-e.length)))),this.decimalSeparator&&(t=t.split(this.decimalSeparator).join(".")),this.thousandSeparator&&(t=t.split(this.thousandSeparator).join("")),isNaN(t)?null:(this._checkDomain(+t),+t)}isSupersetOf(e){return e.prefixes.every((e=>this.prefixes.includes(e)))?e.suffixes.every((e=>this.suffixes.includes(e)))?!(e.decimalSeparator&&this.decimalSeparator!==e.decimalSeparator||e.thousandSeparator&&this.thousandSeparator!==e.thousandSeparator):(e.suffixes.filter((e=>!this.suffixes.includes(e))),!1):(e.prefixes.filter((e=>!this.prefixes.includes(e))),!1)}_checkDomain(e){(!this.min||this.min>e)&&(this.min=e),(!this.max||this.max<e)&&(this.max=e)}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSupersetOf(e)&&e.isSupersetOf(this)}isSimilarTo(e){if(!this.isEqualTo(e))return!1;let t=(this.max-this.min)/(e.max-e.min);return.5<t&&t<2}toString(){return this.min?"N{"+this.format(this.min)+"-"+this.format(this.max)+"}":"N{"+this.format(1234567.654321)+"}"}toFormatString(){let e="Number";return this.scientific&&(e+=", scientific"),this.strictlyPositive&&(e+=", strictly positive"),this.decimalSeparator?e+=", decimal":e+=", whole",this.prefixes.length>0&&(e+=", "+(this.prefixPlaceholder??"")+" prefixed"),this.suffixes.length>0&&(e+=", "+(this.suffixPlaceholder??"")+" suffixed"),e}toDebugString(){return"Usetype::Number()"}compatibleTypes=[];compatibleTypes=["number"];type="number";domainType="ordinal";priority=2;static getIdUsetype(){return new x({strictlyPositive:!0},{potentialIds:!0})}}function S(e){let t=s();if(!e||!(e instanceof Array)||0===e.length||e.every((e=>e.match(/^\s*$/))))return{type:"unknown",format:"unknown",domain:[]};if(e.every((e=>t.includes(e))))return{type:"currency",format:"code",domain:[...t]};let n=r();if(e.every((e=>n.includes(e))))return{type:"currency",format:"symbol",domain:[...n]};let i=o(),c=l(),u=[].concat(i,c);if(e.every((e=>u.includes(e))))return{type:"magnitude",format:"symbol",domain:[...u]};let h=a();return e.every((e=>h.includes(e)))?{type:"magnitude",format:"prefix",domain:[...h]}:{type:"unknown",format:"unknown",domain:[]}}const w={not:e=>(...t)=>!e(...t),both:(e,t)=>(...n)=>e(...n)&&t(...n),either:(e,t)=>(...n)=>e(...n)||t(...n),imply:(e,t)=>(...n)=>!e(...n)||t(...n),implied:(e,t)=>(...n)=>e(...n)||!t(...n)},T=(e,t)=>(...n)=>e(...n)===t(...n);w.equal=T;const v=(...e)=>(...t)=>e.every((e=>e(...t)));w.all=v;const _=(...e)=>(...t)=>e.some((e=>e(...t)));w.any=_;function M(e,t){return e-t}function O(e,t){let n=e[0]-t[0];if(0!==n)return n;let i=e[1]-t[1];if(0!==i)return i;let r=(e[2]??0)-(t[2]??0);return 0!==r?r:(e[3]??0)-(t[3]??0)}w.none=(...e)=>!_(...e),w.notAll=(...e)=>!v(...e),w.equal=T;let D=(window.verbose??{}).time;if(console.log("parse.timestamp.js verbosity = ",D),D)var k=window.console;else k={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>k[e]=window.console[e]));function E(e,t){for(let n=0;n<e.length;n++){for(let i of t)null===i.deformat(e[n])&&(i.disabled=!0);let i=t.filter((e=>!e.disabled));if(0===i.length)return k.log("Batch of usetypes nulled during ",e[n],t),[];t=i}return t}function Y(e){for(let t=0;t<e.length;t++){let n=[];for(let i=t+1;i<e.length;i++)e[t].isSupersetOf(e[i])&&n.push(i);e=e.filter(((e,t)=>!n.includes(t)))}return e}var A;const C=["January","February","March","April","May","June","July","August","September","October","November","December"],F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],I=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function N(e){return function(e){if(c(e.filter((e=>Object.values(P).some((t=>t.label===e))))))return!1;let t=e.map((e=>V[e]));return t=t.filter((e=>e)),!c(t.map((e=>P[e].category)))&&!!function(e){function t(...e){return function(t){return e.every((e=>t.some((t=>z(t).category===e))))}}function n(...e){return function(t){let n=t.map((e=>z(e).category));return e.map((e=>n.indexOf(e))).map(((e,t,n)=>t===n.length-1||e<n[t+1])).reduce(((e,t)=>e&&t),!0)}}function i(e,i){return e instanceof Array&&i instanceof Array?function(t){let n=t.map((e=>z(e).category)).filter((e=>e)),r=e.map((e=>n.indexOf(e))).filter((e=>e>=0)),s=i.map((e=>n.indexOf(e))).filter((e=>e>=0));return Math.max(...r)<Math.min(...s)}:w.imply(t(e,i),n(e,i))}e[0]===P.monthShort.label&&e[2]===P.dayShort.label&&(e[4],P.yearFull.label);const r=w.all(w.imply(t(B.Milliseconds),t(B.Seconds)),w.imply(t(B.Meridiem),t(B.Hours)),w.imply(t(B.Era),t(B.Years))),s=w.all(i(B.Hours,B.Minutes),i(B.Minutes,B.Seconds),i(B.Seconds,B.Milliseconds),i(B.Hours,B.Meridiem),i(B.Years,B.Era),i([B.Years,B.Months,B.Days,B.Era,B.DayOfWeek],[B.Hours,B.Minutes,B.Seconds,B.Milliseconds,B.Meridiem]),w.imply(t(B.Years,B.Months,B.Days),w.any(n(B.Years,B.Months,B.Days),n(B.Days,B.Months,B.Years),n(B.Months,B.Days,B.Years))));return(e=>{let n=[B.Years,B.Months,B.Days,B.Hours,B.Minutes,B.Seconds,B.Milliseconds].map((n=>t(n)(e))),i=n.indexOf(!0),r=n.lastIndexOf(!0);return n.slice(i,r).reduce(((e,t)=>e&&t),!0)})(e)&&r(e)&&s(e)&&(e=>{U.NumericLong,U.NumericMedium,U.NumericShort;const t=e=>{let t=z(e);return t.literal?/^[0-9]/.test(e):t.numeric},n=e=>{let t=z(e);return t.literal?/[0-9]$/.test(e):t.numeric};for(let i=0;i<e.length-1;i++)if(n(e[i])&&t(e[i+1]))return!1;return!0})(e)}(e)}(e.formatting)&&"unknown"!==e.type}const B={Years:1,Months:2,Days:3,Hours:4,Minutes:5,Seconds:6,Milliseconds:7,Era:8,Meridiem:9,DayOfWeek:10},U={NumericShort:0,NumericMedium:1,NumericLong:2,WordShort:3,WordLong:4},P={era:{label:"{EE}",regexBit:"(AD|BC)",category:B.Era,numeric:!1,apply:(e,t)=>e.getFullYear()>0&&"BC"===t&&e.setFullYear(-e.getFullYear()),applyTod:(e,t)=>k.warn("ApplyTOD era called, undefined behaviour"),extract:e=>e.getFullYear()>=0?"AD":"BC",extractTod:e=>k.warn("ExtractTOD era called, undefined behaviour")},yearFull:{label:"{YYYY}",regexBit:"([12][0-9]{3,})",category:B.Years,numeric:!0,subtoken:"yearShort",apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>k.warn("ApplyTOD yearFull called, undefined behaviour"),extract:e=>e.getFullYear().toString().padStart(4,"0"),extractTod:e=>k.warn("ExtractTOD yearFull called, undefined behaviour")},yearShort:{label:"{YY}",regexBit:"([0-9]{2})",category:B.Years,numeric:!0,apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>k.warn("ApplyTOD yearShort called, undefined behaviour"),extract:e=>e.getFullYear().toString(),extractTod:e=>k.warn("ExtractTOD yearShort called, undefined behaviour")},monthFull:{label:"{MM}",regexBit:"(0\\d|1[012])",category:B.Months,numeric:!0,subtoken:"monthShort",apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>k.warn("ApplyTOD monthFull called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString().padStart(2,"0"),extractTod:e=>k.warn("ExtractTOD monthFull called, undefined behaviour")},monthShort:{label:"{M}",regexBit:"(0?\\d|1[012])",category:B.Months,numeric:!0,apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>k.warn("ApplyTOD monthShort called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString(),extractTod:e=>k.warn("ExtractTOD monthShort called, undefined behaviour")},monthName:{label:"{MMMM}",regexBit:"("+C.map((e=>"(?:"+e+")")).join("|")+")",category:B.Months,numeric:!1,subtoken:"monthAbbrev",apply:(e,t)=>e.setMonth(C.indexOf(t)),applyTod:(e,t)=>k.warn("ApplyTOD monthName called, undefined behaviour"),extract:e=>C[e.getMonth()],extractTod:e=>k.warn("ExtractTOD monthName called, undefined behaviour")},monthAbbrev:{label:"{MMM}",regexBit:"("+F.map((e=>"(?:"+e+")")).join("|")+")",category:B.Months,numeric:!1,apply:(e,t)=>e.setMonth(F.indexOf(t)),applyTod:(e,t)=>k.warn("ApplyTOD monthAbbrev called, undefined behaviour"),extract:e=>F[e.getMonth()],extractTod:e=>k.warn("ExtractTOD monthAbbrev called, undefined behaviour")},dayFull:{label:"{DD}",regexBit:"(0[1-9]|[12]\\d|3[01])",category:B.Days,numeric:!0,subtoken:"dayShort",apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>k.warn("ApplyTOD dayFull called, undefined behaviour"),extract:e=>e.getDate().toString().padStart(2,"0"),extractTod:e=>k.warn("ExtractTOD dayFull called, undefined behaviour")},dayShort:{label:"{D}",regexBit:"(0?[1-9]|[12]\\d|3[01])",category:B.Days,numeric:!0,apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>k.warn("ApplyTOD dayShort called, undefined behaviour"),extract:e=>e.getDate().toString(),extractTod:e=>k.warn("ExtractTOD dayShort called, undefined behaviour")},dayOfWeekFull:{label:"{DDDD}",category:B.DayOfWeek,numeric:!1,subtoken:"dayOfWeekShort",regexBit:"("+j.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>k.warn("Apply dayOfWeekFull called, undefined behaviour"),applyTod:(e,t)=>k.warn("ApplyTOD dayOfWeekFull called, undefined behaviour"),extract:e=>j[e.getDay()],extractTod:e=>k.warn("ExtractTOD dayOfWeekFull called, undefined behaviour")},dayOfWeekShort:{label:"{DDD}",category:B.DayOfWeek,numeric:!1,regexBit:"("+I.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>k.warn("Apply dayOfWeekShort called, undefined behaviour"),applyTod:(e,t)=>k.warn("ApplyTOD dayOfWeekShort called, undefined behaviour"),extract:e=>I[e.getDay()],extractTod:e=>k.warn("ExtractTOD dayOfWeekShort called, undefined behaviour")},meridiem:{label:"{RR}",regexBit:"(AM|PM)",category:B.Meridiem,numeric:!1,apply:(e,t)=>{let n=e.getHours();"PM"===t&&n<12?e.setHours(n+12):"AM"===t&&12===n&&cate.setHours(0)},applyTod:(e,t)=>k.warn("ApplyTOD meridiem called, undefined behaviour"),extract:e=>e.getHours()<12||0===e.getHours()?"AM":"PM",extractTod:e=>e[0]<12||0===e[0]?"AM":"PM"},hourFull:{label:"{hh}",regexBit:"([01]\\d|2[0-3])",category:B.Hours,numeric:!0,subtoken:"hourShort",apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(P.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(P.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")}},hourShort:{label:"{h}",regexBit:"([01]?\\d|2[0-3])",category:B.Hours,numeric:!0,apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(P.meridiem.label)&&(n%=12),n.toString()},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(P.meridiem.label)&&(n%=12),n.toString()}},minuteFull:{label:"{mm}",regexBit:"([0-5]\\d)",category:B.Minutes,numeric:!0,subtoken:"minuteShort",apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString().padStart(2,"0"),extractTod:e=>e[1].toString().padStart(2,"0")},minuteShort:{label:"{m}",regexBit:"([0-5]?\\d)",category:B.Minutes,numeric:!0,apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString(),extractTod:e=>e[1].toString()},secondFull:{label:"{ss}",regexBit:"([0-5]\\d)",category:B.Seconds,numeric:!0,subtoken:"secondShort",apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString().padStart(2,"0"),extractTod:e=>e[2].toString().padStart(2,"0")},secondShort:{label:"{s}",regexBit:"([0-5]?\\d)",category:B.Seconds,numeric:!0,apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString(),extractTod:e=>e[2].toString()},millisecondFull:{label:"{nnn}",regexBit:"(\\d{3})",category:B.Milliseconds,numeric:!0,subtoken:"millisecondShort",apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString().padStart(3,"0"),extractTod:e=>e[3].toString().padStart(3,"0")},millisecondShort:{label:"{n}",regexBit:"(\\d{,3})",category:B.Milliseconds,numeric:!0,apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString(),extractTod:e=>e[3].toString()}};function z(e){return function(e){return P[e]}(function(e){return V[e]}(e))||{literal:!0}}delete P.yearShort,delete P.millisecondShort;const V=(()=>{let e={};for(let t in P)e[P[t].label]=t;return e})();function H(){return new Date(2e3,3,21,15,20,25,30)}class $ extends t{constructor(e,t){super(t);let n=e.type;n||(n="none");let i="none";e.min&&(this.min=e.min,i=isValidDate(e.min)?"datetime":isValidTimeOfDay(e.min)?"timeofday":"unknown");let r="none";e.max&&(this.max=e.max,r=isValidDate(e.max)?"datetime":isValidTimeOfDay(e.max)?"timeofday":"unknown");let s=[i,r,n,function(e){let t=e.map((e=>V[e]));t=t.filter((e=>e));let n=t.map((e=>P[e].category));const i=[B.Hours,B.Minutes,B.Seconds,B.Milliseconds],r=[B.Years,B.Months,B.Days,B.Era];let s=!1;n.some((e=>r.includes(e)))&&(s=!0);let a=!1;return n.some((e=>i.includes(e)))&&(a=!0),a&&s?"datetime":a?"timeofday":s?"date":"unknown"}(e.formatting)];if(s=s.filter((e=>"none"!==e)),s.every((e=>e===s[0]))||(this.timestampType="unknown"),this.timestampType=s[0],this.formatting=[...e.formatting],!e.skipValidation&&!N(this))return void(this.timestampType="unknown");let a=[],o=[],l=[],c=[],u=[],h="apply",d="extract";"timeofday"===this.timestampType&&(h="applyTod",d="extractTod"),this.formatting.forEach((e=>{if(void 0!==V[e]){let t=z(e);a.push(t.regexBit),o.push(t[h]),l.push(t[d]),c.push(W(e,t[h])),u.push(W(e,t[d]))}else a.push(p(e)),l.push((()=>e))}));let m=new RegExp(a.join(""));this._extractors=l,this._pattern=m,this._appliers=o,this._verboseAppliers=c,this._verboseExtractors=u}min=null;max=null;formatting=null;timestampType="none";pattern=null;replacement=null;type="timestamp";domainType="ordinal";priority=3;toString(){let e="";var t;this.min&&this.max?e=this.format(this.min)+"-"+this.format(this.max):this.min||this.max?e=this.format(this.min?this.min:this.max):"datetime"===this.timestampType||"date"===this.timestampType?e=this.format(H()):"timeofday"===this.timestampType&&(e=this.format([(t=H()).getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]));let n="X";return"date"===this.timestampType?n="D":"datetime"===this.timestampType?n="DT":"timeofday"===this.timestampType&&(n="TOD"),n+"{"+e+"}"}toFormatString(){return"Chronometric ("+this.timestampType+') "'+$.toShortFormatting(this.formatting)+'"'}format(e,t=!1){return t?this._verboseExtractors.map((t=>t(e,this.formatting))).join(""):this._extractors.map((t=>t(e,this.formatting))).join("")}deformat(e,t=!1){let n=null;if("timeofday"===this.timestampType)n=[15,20,25,30];else{if(!["time","date","datetime"].includes(this.timestampType))return t&&k.warn("Timestamp ",this.formatting," deformat(",e,") failed due to invalid type."),n;n=H()}let i=e.match(this._pattern);return i?(t?this._verboseAppliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))):this._appliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))),e!==this.format(n,t)?(t&&k.warn("Timestamp ",this.formatting," deformat(",e,") = ",n," vs consistency check ",this.format(n)),null):(this._checkDomain(n),n)):(t&&k.warn("Timestamp ",this.formatting," deformat(",e,") failed to match to pattern"),null)}isSupersetOf(e){if(this.formatting.length!==e.formatting.length)return!1;for(let t=0,n=this.formatting.length;t<n;t++){let n=z(this.formatting[t]),i=P[n.subtoken],r=z(e.formatting[t]);if(n.literal){if(!r.literal)return!1;if(this.formatting[t]!==e.formatting[t])return!1}else if(r!==n&&r!==i)return!1}return!0}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}_checkDomain(e){let t;if("timeofday"===this.timestampType)t=O;else{if("datetime"!==this.timestampType&&"date"!==this.timestampType)return;t=M}(!this.min||t(this.min,e)>0)&&(this.min=e),(!this.max||t(this.max,e)<0)&&(this.max=e)}static fromShortFormatting(e){let t=[];for(let e in P)t.push(P[e].label.slice(1,-1));let n=e,i=[];for(;n.length>0;){let e=t.filter((e=>n.startsWith(e)));if(e.length>0){let t=e.reduce(((e,t)=>e.length<t.length?t:e),"");i.push("{"+t+"}"),n=n.slice(t.length)}else i.push(n[0]),n=n.slice(1)}return i[0]=[i[0]],i=i.reduce(((e,t)=>e[e.length-1].endsWith("}")||t.startsWith("{")?(e.push(t),e):(e[e.length-1]=e[e.length-1]+t,e))),new $({formatting:i})}static toShortFormatting(e){return e.map((e=>e.replace(/\{(.*)\}/,"$1"))).join("")}}function W(e,t){return function(n,i){k.log("Function ",e,"(",n,i,") => ");let r=t(n,i);return k.log(n),r}}let L=(window.verbose??{}).enum;if(console.log("parse.enum.js verbosity = ",L),L)var q=window.console;else q={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>q[e]=window.console[e]));class R extends t{domain=[];constructor({domain:e=[]},t){super(t),e&&(this.domain=e)}format(e){return this.domain.includes(e)?e:void 0}deformat(e){return this.domain.includes(e)?e:void 0}isSubsetOf(e){return this.domain.every((t=>e.domain.includes(t)))}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}size(){return this.domain.length}toString(){return`E{[${this.domain}]}`}toFormatString(){return"Categorical"}toDebugString(){return`Usetype.Enum([${this.domain}])`}compatibleTypes=["string"];type="string";domainType="nominal";priority=1}let J=(window.verbose??{}).string;if(console.log("parse.string.js verbosity = ",J),J)var K=window.console;else K={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>K[e]=window.console[e]));class Q extends t{constructor(e){super(e),e.potentialIds&&(this.unique=!0),e.constant&&(this.constant=!0,this.constantValue=e.constant),e.type&&(this.kind=e.type)}format(e){return e.toString()}deformat(e){return e.toString()}isSubsetOf(e){return e.type===this.type||this.type&&!e.type}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}toString(){return this.unique?"SID{"+(this.type??"")+"}":this.constant?"SC("+this.constantValue+"){"+(this.type??"")+"}":"S{"+(this.kind??"")+"}"}compatibleTypes=["string"];type="string";domainType="nominal";priority=0}let G=(window.verbose??{}).parser;if(console.log("parse.main.js verbosity = ",G),G)var X=window.console;else X={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>X[e]=window.console[e]));const Z={skipConstants:!1,sizeHardLimit:50,sampleSize:500};function ee(e,t){t||(t=Object.assign({},Z)),X.groupCollapsed(`detemineType(${e.length>0?e[0]+"...":[]})`),X.log("args = ",t);let n=[],i=function(e,t){if(!t.sizeHardLimit)return!0;let n=e.every((e=>e.length<t.sizeHardLimit));return n||(t.limitExceeded=!0),n}(e,t),r=[];if(i&&([e,r]=function(e,t){let n=function(e,t){if(!e||0===e.length)return[];let n={};for(let t in e)n[e[t]]||(n[e[t]]=[]),n[e[t]].push(t);let i=[];for(let e in n)i.push([e,n[e].length]);if(i=i.sort(((e,t)=>e[1]-t[1])),1===i.length)return t.isConstant=!0,t.constantVal=i[0][0],[];if(i.length===e.length)return t.potentialIds=!0,t.ambiguousSets=[],[];let r=[];for(let e in n)n[e].length>1&&r.push(n[e]);return t.ambiguousSets=r,e.length/i.length>.5&&i[0][1]>=2&&i.length>2?[new R({domain:i.map((e=>e[0]))},{ambiguousSets:r})]:i[i.length-1][1]/i[i.length-2][1]>2&&i[i.length-2][1]>0?(t.hasNoval=!0,t.novalVal=i[i.length-1][0],[]):[]}(e,t);return console.log("preprocessEnumlikeness",n),t.hasNoval&&(X.log("NOVAL detected as ",t.novalVal),e=e.filter((e=>e!==t.novalVal))),t.isConstant&&(X.log("CONSTANT detected as ",t.constant),e=[e[0]]),console.log("args after enum ",t),[e,n]}(e,t),n.push(...r)),(!t.skipConstants||!t.isConstant)&&i){let i=performance.now(),r=function(e,t){if(!e||0===e.length)return[];let n=[];n=[...e].sort().slice(0,5),f.log("recognizeNum -- initial batch = ",n);let i=g(n,t);f.log("extractedNumUsetypes",i);let r=i.map((()=>0));for(let n=0,s=e.length;n<s;n++){let s,a=e[n];for(let e=0,n=i.length;e<n;e++)if(!i[e].disabled){let n=i[e].deformat(a);if(n)r[e]++,i[e].max<n&&(i[e].max=n),i[e].min>n&&(i[e].min=n);else{f.log("Matching",i[e],"against",a,"failed, disabling potential format."),f.log("Trying to recover expanded number usetype..."),s?f.log("Using pre-extracted potential usetypes ",s):(s=g([a],t),f.log("Extracting potential expanding usetypes ",s));let n=!1;for(let t=0,r=s.length;t<r;t++)if(s[t].isSupersetOf(i[e])){f.log("Found fitting expansion. Replacing old ",i[e],"with new ",s[t]),n=!0,i[e]=s[t],s.splice(t,1);break}n||(i[e].disabled=!0)}}if(0===i.length)return[]}return i.forEach(((t,n)=>t.confidence=r[n]/e.length)),i=i.filter((e=>!e.disabled)),i}(e,t);X.log("determineType -- recognizeNumbers -- took ",performance.now()-i),X.log("NumberUsetypes detected: ",r),n.push(...r);let s=performance.now(),a=function(e,t){let n=performance.now(),i=function(e){return A||function(){let e=[];const t=[["{YYYY}","{MM}","{DD}"],["--","{MM}","{DD}"]];e=e.concat(t);const n=[["{YYYY}","-","{MM}","-","{DD}"],["{YYYY}","-","{MM}"],["--","{MM}","-","{DD}"]];e=e.concat(n);const i=[["T","{hh}","{mm}","{ss}",".","{nnn}"],["T","{hh}","{mm}","{ss}"],["T","{hh}","{mm}"],["T","{hh}"]];e=e.concat(i);let r=[];for(let e of t)for(let t of i)r.push(e.concat(t));e=e.concat(r);const s=[["{hh}",":","{mm}",":","{ss}",".","{nnn}"],["{hh}",":","{mm}",":","{ss}"],["{hh}",":","{mm}"]];e=e.concat(s);let a=[];for(let e of n)for(let t of s)a.push(e.concat(["T"],t));e=e.concat(a);const o=[".","-","/"],l=[":","."],c=[" ","\t"],u=[["{DD}","{MM}","{YYYY}"],["{DD}","{MM}","{YY}"],["{MM}","{DD}","{YYYY}"],["{MM}","{DD}","{YY}"],["{YYYY}","{MM}","{DD}"]],h=[["{hh}","{mm}","{ss}","{nnn}"],["{hh}","{mm}","{ss}"],["{hh}","{mm}"]];let p=[];for(let e of u)for(let t of o)p.push(d(e,t));e=e.concat(p);let m=[];for(let e of h)for(let t of l)m.push(d(e,t));e=e.concat(m);let f=[];for(let e of p)for(let t of m)f=f.concat(c.map((n=>[].concat(e,[n],t))));e=e.concat(f),A=e}(),A.map((t=>new $({formatting:t,skipValidation:!0},e)))}(t);if(i=E(e,i),i=Y(i),i.length>0)return k.log("recognizeTimestamp -- expected usetypes found."),i;k.log("recognizeTimestamp -- expectedUsetypes -- took ",performance.now()-n),n=performance.now();let r=function(e,t){let n=[],i={},r={},s=Object.keys(P);for(let t of e)a(t).forEach((e=>{r[e]||(r[e]=!0,n.push(e))}));return n.map((e=>new $({formatting:e},t)));function a(e,t=[],n=0){if(""===e)return[[]];if(i[[e,"|",t]])return i[[e,"|",t]];let r=[];for(let i=n,o=s.length;i<o;i++){let n=P[s[i]];if(t.includes(n.category))continue;let o=new RegExp(n.regexBit),l=e.match(o);if(l){let i=[n.category,...t],s=e.split(l[1]),o=s[0],c=s.slice(1).join(l[1]),u=a(o,i);for(let e of u){let t=e.map((e=>z(e).category)).filter((e=>e)),s=a(c,[].concat(i,t));for(let t of s){let i=[].concat(e,[n.label],t);r.push(i)}}}}return r.length>0?(i[[e,"|",t]]=r,r):(i[[e,"|",t]]=[[e]],[[e]])}}(e.slice(0,5),t);return k.log("recognizeTimestamp -- extractedUsetypes === ",r),k.log("recognizeTimestamp -- extractTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=r.filter(N),k.log("recognizeTimestamp -- extractedUsetypes === ",r),k.log("recognizeTimestamp -- filterInvalidUsetypes -- took ",performance.now()-n),n=performance.now(),r=E(e,r),k.log("recognizeTimestamp -- extractedUsetypes === ",r),k.log("recognizeTimestamp -- filterTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=Y(r),k.log("recognizeTimestamp -- extractedUsetypes === ",r),k.log("recognizeTimestamp -- filterDuplicatesAndSubtypes -- took ",performance.now()-n),n=performance.now(),r}(e,t);X.log("determineType -- recognizeTimestamps -- took ",performance.now()-s),X.log("TimestampUsetypes detected: ",a),n.push(...a)}if(0===n.length){let i=performance.now(),r=function(e,t){console.log("recognizeStrings...");let n=Object.assign({},t);return e.slice(0,10).every((e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)))&&(n.type="url"),[new Q(n)]}(e,t);X.log("detemineType -- recognizeSTrings -- took ",performance.now()-i),X.log("StringUsetypes detected: ",r),n=r}return X.groupEnd(),n}function te(e){if(0===e.length)return!1;if(1===e.length)return e[0].every((e=>1===e.length));let t=e[0],n=e.slice(1);for(let e=0;e<t.length;e++){let i=t[e],r=[];for(let s=0;s<t[e].length;s++){let e=i[s],t=[];for(let i=0;i<n.length;i++){let r=n[i];for(let s=0;s<n[i].length;s++){let n=r[s].indexOf(e);if(-1!==n){t.push([s,n]);break}}}r.push(t)}for(let e=0;e<i.length;e++)if(r.map((t=>t[e])).filter((e=>void 0!==e)).some((e=>c(e.filter((e=>void 0!==e))))))return!1}return!0}let ne;function ie(e,t,n){console.log("getAppropriateChartTypes",n),n.keys.map((e=>t[e])),n.keys.map((e=>t[e]));let i=[];for(let e in ne){let r=ne[e],s=!0,a=r.constraints;if(a){console.log("Enforcing constraints for ",e);let i=a.xAxis;i&&(re(i,0,t,n.keys)||(s=!1));let r=a.yAxis;r&&(re(r,0,t,n.values)||(s=!1))}s&&i.push(r.type)}return i.length>1&&console.warn("Multiple potential chart types determined for ",n," as ",i),console.log("getAppropriateChartTypes returns ",i),i}function re(e,t,n,i,r=!1){if(console.log("checkConstraints ",e,i),!e||0===e.length||!i||0===i.length)return!1;if(!r&&e.length!==i.length)return!1;if(r&&1!==e.length)return!1;for(let t in i){let s=e[0];r||(s=e[t]);let a=n[i[t]];if(s.domainType&&s.domainType!==a.domainType)return console.log("domainType discrepancy ",s,a),!1;if(s.type&&s.type!==a.type)return console.log("type discrepancy ",s,a),!1;s.range&&s.range}return!0}const se=[[255,99,132],[255,159,64],[255,205,86],[75,192,192],[54,162,235],[153,102,255],[201,203,207]];function ae(e){let t;if(e<se.length)t=se[e];else{let n=Math.floor(e/se.length);t=function(...e){return[Math.floor(e.map((e=>e[0])).reduce(((e,t)=>e+t))/e.length),Math.floor(e.map((e=>e[1])).reduce(((e,t)=>e+t))/e.length),Math.floor(e.map((e=>e[2])).reduce(((e,t)=>e+t))/e.length)]}(se[n],se[e%se.length])}return"rgba("+t.join(", ")+")"}class oe{_head=[];_headValid=!1;get head(){return this._headValid||this._checkHeaderValidity(),this._head}_data=[];get height(){return this._data.length}get width(){return(this._data[0]??[]).length}get length(){return this.height*this.width}get data(){return this._data}row(e){return this._data[e]}col(e){return this._data.map((t=>t[e]))}_usetypes=[];get usetypes(){return 0===this._usetypes.length&&this._auto&&this._determineUsetypes(),this._usetypes}_meta={};get meta(){return this._meta}_dataErr=[];get errors(){return this._dataErr}_bindings=[];get size(){return this._bindings.length}get bindings(){return 0===this._bindings.length&&this._auto&&this._createBindings(),this._bindings}_keySets=[];get keySets(){return 0===this._keySets.length&&this._generateKeySets(),this._keySets}_valueSets=[];get valueSets(){return 0===this._valueSets.length&&this._generateValueSets(),this._valueSets}constructor({auto:e=!0}={}){this._auto=e}_reset(){this._head=[],this._data=[],this._dataErr=[],this._meta={},this._usetypes=[],this._keySets=[],this._valueSets=[],this._bindings=[];for(let e in Chart.instances)Chart.instances[e].destroy()}setAutomatic(e){this._auto=e}setData(e){this._reset();let t=e.data;1===t[t.length-1].length&&""===t[t.length-1][0]&&t.splice(-1),t.every((e=>0===e[e.length-1].trim().length))&&(t=t.map((e=>e.slice(0,-1))));let n=t.slice(0,20),i=t.slice(t.length-20,t.length),r=n.concat(i).map((e=>e.length)).reduce(((e,t)=>(e[t]?e[t]++:e[t]=1,e)),{});r=function(e){let t=[];for(let n in e)t.push([n,e[n]]);return t}(r),r.sort(((e,t)=>t[1]-e[1]));let s=r[0][0],a=0;for(;t[a++].length!=s;);for(t.splice(0,a-1),a=t.length-1;t[a--].length!=s;);t.splice(a+1,t.length-a),this._head=t[0],this._data=t.slice(1),this._meta=e.meta,this._dataErr=e.errors,this.triggerEvent(ce.sourceChange,e)}loadFromUrl(e,t){Papa.parse(e,{encoding:"utf8",download:!0,skipEmptyFiles:!0,complete:e=>this.setData(e)})}loadFromLocal(e,t){Papa.parse(e,{encoding:"utf8",skipEmptyFiles:!0,complete:e=>this.setData(e)})}setUsetypes(e){this._auto||(this._usetypes=e)}_determineUsetypes(){this._usetypes=[],this._allUsetypes=[];for(let e=0,t=this.width;e<t;e++){let t=ee(this.col(e));this._allUsetypes.push(t),1===t.length||(t.filter((e=>"timestamp"===e.type)).length>1&&(console.log("Filtering single-valued timestamps",t),t=t.filter((e=>"timestamp"!==e.type))),t.sort(((e,t)=>t.priority-e.priority))),this._usetypes[e]=t[0]}this._checkHeaderValidity()}_checkHeaderValidity(){this._headValid=!1;for(let e=0;e<this._head.length;e++){let t=this.usetypes[e];t.hasNoval&&(t.novalVal,this._head[e]),console.log(e),console.log(t),null===t.deformat(this._head[e])&&(this._headValid=!0)}this._headValid||(console.warn("Header seems not to be present, appending usetype information instead..."),this._data=[this._head,...this._data],this._head=this._usetypes.map((e=>e.toString())),this._headValid=!0)}createBindings(e){if(!this._auto)throw new Error("Not implemented");return this._createBindings(),this._bindings}_createBindings(){this._bindings=[];for(let e of this.keySets)for(let t of this.valueSets){console.log("for sets",e,t);let n=h(e,t);if(n.length>0){if(n.length===e.length||n.length===t.length)continue;t=t.filter((e=>!n.includes(e)))}let i=ie(this.data,this.usetypes,{keys:e,values:t}).map((n=>new le(this,{keyIdxs:e,valueIdxs:t,chartType:n})));this._bindings=this._bindings.concat(i)}}_generateKeySets(){let e=this.usetypes,t=[...Array(this.usetypes.length).keys()],n=t.filter((t=>e[t].potentialIds)),i=(t.filter((t=>e[t].isConstant)),e.filter((e=>!e.potentialIds&&!e.isConstant&&!e.ignored))),r=t.filter((t=>!e[t].potentialIds&&!e[t].isConstant)),s=(o=i.map((e=>e.ambiguousSets)),function(e){let t=[...Array(e.length).keys()].reduce(((e,t)=>e.concat(e.map((e=>[t,...e])))),[[]]),n=t.map((()=>!1)),i=[];for(let r in t){if(n[r])continue;let s=t[r];te(e.filter(((e,t)=>s.includes(t))))&&(i.push(s),n=n.map(((e,n)=>e||u(s,t[n]))))}return i}(o)).map((e=>e.map((e=>r[e])))),a=function(e){let t=[];for(let n=0;n<e.length;n++){let i=!0;for(let t=0;t<e.length;t++)if(n!==t&&u(e[t],e[n])){i=!1;break}i&&t.push(e[n])}return t}(s);var o;a.length!==s.length&&(s=a),this._keySets=n.map((e=>[e])).concat(s),0===this._keySets.length&&(this._keySets=[[-1]],this._usetypes[-1]=x.getIdUsetype(),this._data.forEach(((e,t)=>e[-1]=t)))}_generateValueSets(){let e=[];this.usetypes.forEach(((t,n)=>{"ordinal"===t.domainType&&e.push(n)}));let t=e.map((e=>this.usetypes[e])),n=t.filter((e=>"number"===e.type)).reduce(r,[]).map((e=>e.map((e=>this.usetypes.indexOf(e))))),i=t.filter((e=>"timestamp"===e.type)).reduce(r,[]).map((e=>e.map((e=>this.usetypes.indexOf(e)))));function r(e,t){let n=!1;for(let i of e){let r=[];for(let e of i)e.isSimilarTo(t)&&r.push(e);r.push(t),r.length-1===i.length?(i.push(t),n=!0):r.length>1&&(e.push(r),n=!0)}return n||e.push([t]),e}this._valueSets=n.concat(i)}setBindingElementId(e,t){this._bindings[e].boundElementId=t}drawBinding(e){this._drawBinding(this._bindings[e])}_drawBinding(e){!function(e,t,n,i){if(i.type||(i.type=ie(0,n,i)[0]),i.head||(i.head=[...Object.keys(Array(n.length))]),"bubble"===i.type)return function(e,t,n,i){let r,s=[],a=i.keys[0],o=n[a],l=i.header[a],c=i.keys[1],u=n[c],h=i.header[c],d=i.values[0],p=n[d],m=i.header[d],f=0;for(let e of t){let t=o.deformat(e[a]),n=u.deformat(e[c]),i=p.deformat(e[d]);s.push({x:t,y:n,r:i}),f=Math.max(f,i)}if(f>10){r=Math.floor(Math.log10(f)),console.log(f,r);for(let e of s)console.log(e.r),e.r/=10**r,console.log(e.r)}let g={type:i.type,data:{datasets:[{label:"("+l+")x("+h+") => "+m+(r?"(e"+r+")":""),data:s,borderColor:ae(0),backgroundColor:ae(1)}]}};return new Chart(document.getElementById(e),g)}(e,t,n,i);if("pie"===i.type||"doughnut"===i.type)return function(e,t,n,i){let r=i.keys[0],s=n[r],a=(i.header[r],i.values[0]),o=n[a],l=i.header[a],c=[],u=[];for(let e of t)c.push(s.deformat(e[r])),u.push(o.deformat(e[a]));let h={type:i.type,data:{labels:c,datasets:[{label:l,data:u,backgroundColor:t.map(((e,t)=>ae(t)))}]}};return new Chart(document.getElementById(e),h)}(e,t,n,i);let r=[],s=[],a=i.keys.map((e=>i.header[e])).join(", "),o=i.values.map((e=>i.header[e])),l=i.keys.map((e=>n[e])),c=i.values.map((e=>n[e]));for(let e of t){let t=i.keys.map((t=>e[t])).join(", ");s.push(t);let n={};n.x=t;for(let t=0;t<c.length;t++)n["y"+t]=c[t].deformat(e[i.values[t]]);r.push(n)}let u=[];for(let e=0;e<c.length;e++){let t={label:o[e],data:r,parsing:{yAxisKey:"y"+e},borderColor:ae(e),backgroundColor:ae(e)};u.push(t)}let h,d,p={labels:s,datasets:u};c[0].min&&(h=Math.min(...c.map((e=>e.min))),d=Math.max(...c.map((e=>e.max))));let m={scales:{}};m.scales.x={display:!0,title:{display:!0,labelString:a}},1===l.length&&"timestamp"===l[0].type&&(m.scales.x.type="time"),1===l.length&&l[0].min&&(m.scales.x.min=l[0].min,m.scales.x.max=l[0].max);for(let e=0;e<c.length;e++)m.scales["y"+e]={display:!0,title:{display:!0,labelString:o[e]}},"timestamp"===c[e].type&&(m.scales["y"+e]={type:"time"}),c[e].min&&(m.scales["y"+e]=m.scales["y"+e]??{},m.scales["y"+e].min=h,m.scales["y"+e].max=d);let f={type:i.type,data:p,options:m};new Chart(document.getElementById(e),f)}(e.boundElementId,this.data,this.usetypes,{keys:e.keyIdxs,values:e.valueIdxs,header:this.head,type:e.chartType})}_getUsetypedData(e){let t=e._bindOrder;console.log("getUsetypedData ",t);let n=new google.visualization.DataTable;for(let e=0;e<t.length;e++)n.addColumn(this._usetypes[t[e]][0].type,this._head[t[e]]);for(let e=0;e<this._data.length;e++){let i=[];for(let n=0;n<t.length;n++){let r=this._usetypes[t[n]][0].deformat(this._data[e][t[n]]);if(!r&&0!==r)return console.error("In column ",this._head[t[n]]," Could not parse value ",this._data[e][t[n]]," into type ",this._usetypes[t[n]][0]),null;i.push(r)}n.addRow(i)}return n}}class le{_catalogue;_keyIdxs;get keyIdxs(){return this._keyIdxs}_valueIdxs;get valueIdxs(){return this._valueIdxs}_boundElementId;get boundElementId(){return this._boundElementId}set boundElementId(e){this._boundElementId?console.warn("Binding.boundElementId setter called while already having elId set to ",this._boundElementId):this._boundElementId=e}get usedFeatures(){return[this._keyIdxs,this._valueIdxs]}_chartType;get chartType(){return this._chartType}constructor(e,{keyIdxs:t=[],valueIdxs:n=[],chartType:i="",boundElementId:r=null}){this._catalogue=e,this._chartType=i,this._keyIdxs=t,this._valueIdxs=n,r&&(this._boundElementId=r)}}const ce={sourceChange:"dataChanged",usetypeChange:"usetypesChanged",bindingChange:"bindingsChanged"};var ue,he;ue=oe,he=Object.values(ce),e.events=ue.prototype.events??{},he.forEach((t=>e.events[t]=[])),Object.assign(ue.prototype,e),console.log("Loaded core/Main.js"),window.Catalogue=oe,window.Init=function(e){fetch("https://raw.githubusercontent.com/SaNuelson/DataChartRenderer/master/src/json/chart.js.json").then((e=>e.json())).then((t=>{!function(e){if(ne)console.error("Chart.js integration template data already defined.");else{ne={};for(let t of e.ChartTypes)ne[t.label]=t}}(t),e.onChartTemplatesLoaded&&e.onChartTemplatesLoaded()})).catch((e=>console.error(e)))}})();