(()=>{"use strict";let e;console.log("Loaded core/Template.");const t={loadChartTemplates(t){if(e)throw new"Template data already defined.";e=t},all:()=>e,charts:()=>e.ChartTypes,chart:t=>e.ChartTypes.find((e=>e.name===t)),hasChart:t=>e.ChartTypes.some((e=>e.name===t)),chartNames:()=>e.ChartTypes.map((e=>e.name)),chartRole:(t,n)=>e.ChartTypes.find((e=>e.name===t)).roles.find((e=>e.name===n)),roles:()=>e.RoleDetails,role:t=>e.RoleDetails.find((e=>e.name===t)),hasRole:t=>e.RoleDetails.some((e=>e.name===t)),roleNames:()=>e.RoleDetails.map((e=>e.name))},n=function(e,t){a.events=e.prototype.events??{},t.forEach((e=>a.events[e]=[])),Object.assign(e.prototype,a)},a={events:{},addEventListener(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):(console.warn(`${this.constructor.name} added event listener for ${e} despite not being pre-defined.`),this.events[e]=[t])},addEventListeners(e){for(const t in e)this.addEventListener(t,e[t])},on(e,t){return this.addEventListener(e,t),this},triggerEvent(e,...t){if(this.events.hasOwnProperty(e))for(let n of this.events[e])n(...t);else console.warn(`${this.constructor.name} triggered unknown event ${e} with args ${t}`)}};class r{constructor(e){if(this.constructor===r)throw new Error("Cannot instantiate base Usetype class.");e.hasNoval&&(this.hasNoval=!0,this.novalVal=e.novalVal),e.isConstant&&(this.isConstant=e.isConstant,this.constantVal=e.constantVal),e.potentialIds&&(this.potentialIds=!0),e.ambiguous&&(this.ambiguousSets=e.ambiguous)}format(e){throw new Error("Abstract baseclass Usetype.format() called.")}deformat(e){throw new Error("Abstract base class Usetype.deformat() called.")}toString(){return"U{undefined}"}toFormatString(){return""}toDebugString(){return"Usetype::Base()"}compatibleTypes=[];type="undefined"}const s={countries:{url:"https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-abbreviation.json",extract:e=>{s.countries.names=e.map((e=>e.country)),s.countries.codes=e.map((e=>e.abbreviation))}},currencies:{url:"https://gist.githubusercontent.com/Fluidbyte/2973986/raw/8bb35718d0c90fdacb388961c98b8d56abc392c9/Common-Currency.json",extract:e=>{let t=Object.keys(e);s.currencies.codes=t,s.currencies.symbols=t.map((t=>e[t].symbol)),s.currencies.nativeSymbols=t.map((t=>e[t].symbol_native))}},cities:{url:"https://raw.githubusercontent.com/lutangar/cities.json/master/cities.json",extract:e=>{s.cities.names=e.map((e=>e.name)),s.cities.codes=e.map((e=>e.country))}}};let i=!1;!function(){if(!i){for(let e in s){let t;fetch(s[e].url).then((e=>e.json())).then((t=>s[e].extract(t))).catch((n=>(console.error("parse.constants.js fetch item",e,"failed with err",n),t.text())))}i=!0}}();const o=function(){let e=s.currencies;return e&&e.symbols?e.symbols:[]},l=function(){let e=s.currencies;return e&&e.abbreviations?e.abbreviations:[]},h=function(e){return["yotta","zetta","exa","peta","tera","giga","mega","kilo","hecto","deca","","deci","centi","milli","micro","nano","pico","femto","atto","zepto","yocto"]},u=function(e){return["Y","Z","E","P","T","G","M","k","h","da","","d","c","m","μ","n","p","f","a","z","y"]},c=function(e){return["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td"]};function d(e){return new Set(e).size!==e.length}function p(e,t,n=!1,a=!1){let r=e.map((e=>[e,t])).flat(1);return n&&r.splice(0,0,t),a||r.splice(-1,1),r}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}p(["a",["b","c"],"d",{e:!0},()=>{}],"X",!0,!0);let f=(window.verbose??{}).number;if(console.log("parse.num.js verbosity = ",f),f)var g=window.console;else g={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>g[e]=window.console[e]));function y(e,t){const n=(t,n)=>{g.warn(`Number Recognizer (CSV line ${t} = ${e[t]}): ${n}`)},a=[".",","," "," "],r=[".",","],s=(i=a.concat(r),[...new Set(i)]);var i;const o=new RegExp("^["+s.join("")+"\\d]+$");let l=[],h=[],u=!1,c=!1,d=!1,p=!1,m=!1,f=[];for(let t=0,i=e.length;t<i;t++){let i=e[t],g="",y=i.match(/^[^0-9]*[^0-9+-]/);y&&(g=y[0],i=i.replace(y[0],""));let _="",x=i.match(/[^.0-9][^0-9]*$/);x&&(_=x[0],i=i.replace(x[0],""));let S=!1,v=i.match(/e[0-9]+$/);v&&(S=!0,i=i.replace(v[0],""));let D=!1,T=!1,C=i.match(/^[-+]/);if(C&&("+"===C[0]&&(T=!0),D=!0,i=i.replace(C[0],"")),!i.match(o)){n(t,`Stripped sample ${i} not in pure numeric form .`),window.purePat=o;continue}let O=a.filter((e=>i.includes(e))),M=r.filter((e=>i.includes(e))),E=[],N=s.filter((e=>i.includes(e)));if(0!==i.length){if(0===N.length)E.push(["",""]);else if(1===N.length){let e=N[0];b(i,e)&&E.push([e,""]),w(i,e)&&E.push(["",e])}else{let e=!1;for(let t of O)for(let n of M){if(t===n)continue;if(!b(i,t))continue;if(!w(i,n))continue;let a=i.split(t).join("").split(ds).join(".");isNaN(parseFloat(a))||(E.push([t,n]),console.error("ALSEP",[t,n]),e=!0)}if(!e){n(t,`Failed to parse ${i} using parseFloat with any combination of separators.`);continue}}g&&l.push(g),_&&h.push(_),u&=D,c&=T,d=!1,p=!1,m&=S,f=f.concat(E)}else n(t,`Sample ${e[t]} empty after stripping process.`)}let y=[];for(let e of f){let n=new _({prefixes:l,suffixes:h,separators:e,integral:!e[1],scientific:m,explicitSign:c},t);y.push(n)}let x=!0;for(;x;){x=!1;for(let e=0;e<y.length;e++){for(let t=0;t<y.length&&(e===t||(y[e].isEqualTo(y[t])||y[e].isSupersetOf(y[t])?(y.splice(t),x=!0):y[t].isSupersetOf(y[e])&&(y.splice(e),x=!0),!x));t++);if(x)break}}return y}function b(e,t){let n=e.split(t);return!(n[0].length>3)&&(3===n[n.length-1].length||!n[n.length-1].match(/^[0-9]+$/))&&n.slice(1,-1).every((e=>3===e.length||e.match(/\D/)))}function w(e,t){let n=e.match(new RegExp(m(t),"g"));return n&&1===n.length}class _ extends r{constructor({separators:e=[],prefixes:t=[],suffixes:n=[],scientific:a=!1,strictlyPositive:r=!1,explicitSign:s=!1},i){super(i),e.length>0&&""!==e[0]&&(this.thousandSeparator=e[0]),e.length>1&&""!==e[1]?this.decimalSeparator=e[1]:this.integral=!0,e.length>2&&e[2]===e[0]&&(this.separateDecimalThousands=!0),a&&(this.scientific=!0),r&&(this.strictlyPositive=!0),s&&(this.explicit=!0),this.prefixes=t;let o=x(this.prefixes);"unknown"!==o.type&&(this.prefixes=o.domain,this.prefixPlaceholder=o.type),this.suffixes=n;let l=x(this.suffixes);"unknown"!==l.type&&(this.suffixes=l.domain,this.suffixPlaceholder=l.type)}prefixes=[];suffixes=[];decimalSeparator="";thousandSeparator="";separateDecimalThousands=!1;scientific=!1;explicit=!1;format(e){function t(e,t,n){return(n?e.match(/.{1,3}/g):e.match(/.{1,3}(?=(.{3})*$)/g)).join(t)}let n=this.prefixPlaceholder??this.prefixes,a=this.suffixPlaceholder??this.suffixes;if(this.scientific){let t=e.toFixed(1).indexOf(".")-1;e/=10**t,suffix="e"+t+suffix}this.explicit&&e>=0&&(prefix+="+");var r=(this.decimalPlaces?e.toFixed(this.decimalPlaces):e.toString()).split("."),s=r[0];if(this.integerPlaces>0&&r[0].length<this.integerPlaces&&(s="0".repeat(this.integerPlaces-s.length)+s),s=t(r[0],this.thousandSeparator,!1),this.integral)return n+s+a;var i="0";return r.length>1&&(i=r[1]),this.decimalPlaces>0&&r[1].length<this.decimalPlaces&&(i+="0".repeat(this.decimalPlaces-i.length)),this.separateDecimalThousands&&(i=t(r[1],this.thousandSeparator,!0)),n+s+this.decimalSeparator+i+a}deformat(e){let t=e;return this.prefixes.forEach((e=>t.startsWith(e)&&(t=t.slice(e.length)))),this.suffixes.forEach((e=>t.endsWith(e)&&(t=t.slice(0,t.length-e.length)))),this.decimalSeparator&&(t=t.split(this.decimalSeparator).join(".")),this.thousandSeparator&&(t=t.split(this.thousandSeparator).join("")),isNaN(t)?null:+t}isSupersetOf(e){if(!e.prefixes.every((e=>this.prefixes.includes(e)))){let t=e.prefixes.filter((e=>!this.prefixes.includes(e)));return g.warn("isSupersetOf() incompatible prefix sets",this.prefixes,e.prefixes," -> ",t),!1}if(!e.suffixes.every((e=>this.suffixes.includes(e)))){let t=e.suffixes.filter((e=>!this.suffixes.includes(e)));return g.warn("isSupersetOf() incompatible suffix sets",this.suffixes,e.suffixes," -> ",t),!1}return e.decimalSeparator&&this.decimalSeparator!==e.decimalSeparator?(g.warn("isSupersetOf() incompatible decimal separators ",this.decimalSeparator,e.decimalSeparator),!1):!e.thousandSeparator||this.thousandSeparator===e.thousandSeparator||(g.warn("isSupersetOf() incompatible thousand separators ",this.thousandSeparator,e.thousandSeparator),!1)}isEqualTo(e){return this.isSupersetOf(e)&&e.isSupersetOf(this)}toString(){return this.min&&this.max?"N{"+this.format(this.min)+"-"+this.format(this.max)+"}":this.min?"N{"+this.format(this.min)+"}":this.max?"N{"+this.format(this.max)+"}":"N{"+this.format(1234567.654321)+"}"}toFormatString(){return""}toDebugString(){return"Usetype::Number()"}compatibleTypes=[];compatibleTypes=["number"];type="number"}function x(e){let t=l();if(!e||!(e instanceof Array)||0===e.length||e.every((e=>e.match(/^\s*$/))))return{type:"unknown",format:"unknown",domain:[]};if(e.every((e=>t.includes(e))))return{type:"currency",format:"code",domain:[...t]};let n=o();if(e.every((e=>n.includes(e))))return{type:"currency",format:"symbol",domain:[...n]};let a=u(),r=c(),s=[].concat(a,r);if(e.every((e=>s.includes(e))))return{type:"magnitude",format:"symbol",domain:[...s]};let i=h();return e.every((e=>i.includes(e)))?{type:"magnitude",format:"prefix",domain:[...i]}:{type:"unknown",format:"unknown",domain:[]}}const S={not:e=>(...t)=>!e(...t),both:(e,t)=>(...n)=>e(...n)&&t(...n),either:(e,t)=>(...n)=>e(...n)||t(...n),imply:(e,t)=>(...n)=>!e(...n)||t(...n),implied:(e,t)=>(...n)=>e(...n)||!t(...n)},v=(e,t)=>(...n)=>e(...n)===t(...n);S.equal=v;const D=(...e)=>(...t)=>e.every((e=>e(...t)));S.all=D;const T=(...e)=>(...t)=>e.some((e=>e(...t)));S.any=T;S.none=(...e)=>!T(...e),S.notAll=(...e)=>!D(...e),S.equal=v;let C=(window.verbose??{}).time;if(console.log("parse.timestamp.js verbosity = ",C),C)var O=window.console;else O={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>O[e]=window.console[e]));function M(e,t){for(let n=0;n<e.length;n++){for(let a of t)null===a.deformat(e[n])&&(a.disabled=!0);let a=t.filter((e=>!e.disabled));if(0===a.length)return O.log("Batch of usetypes nulled during ",e[n],t),[];t=a}return t}function E(e){for(let t=0;t<e.length;t++){let n=[];for(let a=t+1;a<e.length;a++)e[t].isSupersetOf(e[a])&&n.push(a);e=e.filter(((e,t)=>!n.includes(t)))}return e}var N;const R=["January","February","March","April","May","June","July","August","September","October","November","December"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Y(e){return function(e){if(d(e.filter((e=>Object.values(j).some((t=>t.label===e))))))return!1;let t=e.map((e=>U[e]));return t=t.filter((e=>e)),!d(t.map((e=>j[e].category)))&&!!function(e){function t(...e){return function(t){return e.every((e=>t.some((t=>A(t).category===e))))}}function n(...e){return function(t){let n=t.map((e=>A(e).category));return e.map((e=>n.indexOf(e))).map(((e,t,n)=>t===n.length-1||e<n[t+1])).reduce(((e,t)=>e&&t),!0)}}function a(e,a){return e instanceof Array&&a instanceof Array?function(t){let n=t.map((e=>A(e).category)).filter((e=>e)),r=e.map((e=>n.indexOf(e))).filter((e=>e>=0)),s=a.map((e=>n.indexOf(e))).filter((e=>e>=0));return Math.max(...r)<Math.min(...s)}:S.imply(t(e,a),n(e,a))}e[0]===j.monthShort.label&&e[2]===j.dayShort.label&&(e[4],j.yearFull.label);const r=S.all(S.imply(t(I.Milliseconds),t(I.Seconds)),S.imply(t(I.Meridiem),t(I.Hours)),S.imply(t(I.Era),t(I.Years))),s=S.all(a(I.Hours,I.Minutes),a(I.Minutes,I.Seconds),a(I.Seconds,I.Milliseconds),a(I.Hours,I.Meridiem),a(I.Years,I.Era),a([I.Years,I.Months,I.Days,I.Era,I.DayOfWeek],[I.Hours,I.Minutes,I.Seconds,I.Milliseconds,I.Meridiem]),S.imply(t(I.Years,I.Months,I.Days),S.any(n(I.Years,I.Months,I.Days),n(I.Days,I.Months,I.Years),n(I.Months,I.Days,I.Years))));return(e=>{let n=[I.Years,I.Months,I.Days,I.Hours,I.Minutes,I.Seconds,I.Milliseconds].map((n=>t(n)(e))),a=n.indexOf(!0),r=n.lastIndexOf(!0);return n.slice(a,r).reduce(((e,t)=>e&&t),!0)})(e)&&r(e)&&s(e)&&(e=>{$.NumericLong,$.NumericMedium,$.NumericShort;const t=e=>{let t=A(e);return t.literal?/^[0-9]/.test(e):t.numeric},n=e=>{let t=A(e);return t.literal?/[0-9]$/.test(e):t.numeric};for(let a=0;a<e.length-1;a++)if(n(e[a])&&t(e[a+1]))return!1;return!0})(e)}(e)}(e.formatting)&&"unknown"!==e.type}const I={Years:1,Months:2,Days:3,Hours:4,Minutes:5,Seconds:6,Milliseconds:7,Era:8,Meridiem:9,DayOfWeek:10},$={NumericShort:0,NumericMedium:1,NumericLong:2,WordShort:3,WordLong:4},j={era:{label:"{EE}",regexBit:"(AD|BC)",category:I.Era,numeric:!1,apply:(e,t)=>e.getFullYear()>0&&"BC"===t&&e.setFullYear(-e.getFullYear()),applyTod:(e,t)=>O.warn("ApplyTOD era called, undefined behaviour"),extract:e=>e.getFullYear()>=0?"AD":"BC",extractTod:e=>O.warn("ExtractTOD era called, undefined behaviour")},yearFull:{label:"{YYYY}",regexBit:"([12][0-9]{3,})",category:I.Years,numeric:!0,subtoken:"yearShort",apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>O.warn("ApplyTOD yearFull called, undefined behaviour"),extract:e=>e.getFullYear().toString().padStart(4,"0"),extractTod:e=>O.warn("ExtractTOD yearFull called, undefined behaviour")},yearShort:{label:"{YY}",regexBit:"([0-9]{2})",category:I.Years,numeric:!0,apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>O.warn("ApplyTOD yearShort called, undefined behaviour"),extract:e=>e.getFullYear().toString(),extractTod:e=>O.warn("ExtractTOD yearShort called, undefined behaviour")},monthFull:{label:"{MM}",regexBit:"(0\\d|1[012])",category:I.Months,numeric:!0,subtoken:"monthShort",apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>O.warn("ApplyTOD monthFull called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString().padStart(2,"0"),extractTod:e=>O.warn("ExtractTOD monthFull called, undefined behaviour")},monthShort:{label:"{M}",regexBit:"(0?\\d|1[012])",category:I.Months,numeric:!0,apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>O.warn("ApplyTOD monthShort called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString(),extractTod:e=>O.warn("ExtractTOD monthShort called, undefined behaviour")},monthName:{label:"{MMMM}",regexBit:"("+R.map((e=>"(?:"+e+")")).join("|")+")",category:I.Months,numeric:!1,subtoken:"monthAbbrev",apply:(e,t)=>e.setMonth(R.indexOf(t)),applyTod:(e,t)=>O.warn("ApplyTOD monthName called, undefined behaviour"),extract:e=>R[e.getMonth()],extractTod:e=>O.warn("ExtractTOD monthName called, undefined behaviour")},monthAbbrev:{label:"{MMM}",regexBit:"("+k.map((e=>"(?:"+e+")")).join("|")+")",category:I.Months,numeric:!1,apply:(e,t)=>e.setMonth(k.indexOf(t)),applyTod:(e,t)=>O.warn("ApplyTOD monthAbbrev called, undefined behaviour"),extract:e=>k[e.getMonth()],extractTod:e=>O.warn("ExtractTOD monthAbbrev called, undefined behaviour")},dayFull:{label:"{DD}",regexBit:"(0[1-9]|[12]\\d|3[01])",category:I.Days,numeric:!0,subtoken:"dayShort",apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>O.warn("ApplyTOD dayFull called, undefined behaviour"),extract:e=>e.getDate().toString().padStart(2,"0"),extractTod:e=>O.warn("ExtractTOD dayFull called, undefined behaviour")},dayShort:{label:"{D}",regexBit:"(0?[1-9]|[12]\\d|3[01])",category:I.Days,numeric:!0,apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>O.warn("ApplyTOD dayShort called, undefined behaviour"),extract:e=>e.getDate().toString(),extractTod:e=>O.warn("ExtractTOD dayShort called, undefined behaviour")},dayOfWeekFull:{label:"{DDDD}",category:I.DayOfWeek,numeric:!1,subtoken:"dayOfWeekShort",regexBit:"("+F.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>O.warn("Apply dayOfWeekFull called, undefined behaviour"),applyTod:(e,t)=>O.warn("ApplyTOD dayOfWeekFull called, undefined behaviour"),extract:e=>F[e.getDay()],extractTod:e=>O.warn("ExtractTOD dayOfWeekFull called, undefined behaviour")},dayOfWeekShort:{label:"{DDD}",category:I.DayOfWeek,numeric:!1,regexBit:"("+B.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>O.warn("Apply dayOfWeekShort called, undefined behaviour"),applyTod:(e,t)=>O.warn("ApplyTOD dayOfWeekShort called, undefined behaviour"),extract:e=>B[e.getDay()],extractTod:e=>O.warn("ExtractTOD dayOfWeekShort called, undefined behaviour")},meridiem:{label:"{RR}",regexBit:"(AM|PM)",category:I.Meridiem,numeric:!1,apply:(e,t)=>{let n=e.getHours();"PM"===t&&n<12?e.setHours(n+12):"AM"===t&&12===n&&cate.setHours(0)},applyTod:(e,t)=>O.warn("ApplyTOD meridiem called, undefined behaviour"),extract:e=>e.getHours()<12||0===e.getHours()?"AM":"PM",extractTod:e=>e[0]<12||0===e[0]?"AM":"PM"},hourFull:{label:"{hh}",regexBit:"([01]\\d|2[0-3])",category:I.Hours,numeric:!0,subtoken:"hourShort",apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(j.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(j.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")}},hourShort:{label:"{h}",regexBit:"([01]?\\d|2[0-3])",category:I.Hours,numeric:!0,apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(j.meridiem.label)&&(n%=12),n.toString()},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(j.meridiem.label)&&(n%=12),n.toString()}},minuteFull:{label:"{mm}",regexBit:"([0-5]\\d)",category:I.Minutes,numeric:!0,subtoken:"minuteShort",apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString().padStart(2,"0"),extractTod:e=>e[1].toString().padStart(2,"0")},minuteShort:{label:"{m}",regexBit:"([0-5]?\\d)",category:I.Minutes,numeric:!0,apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString(),extractTod:e=>e[1].toString()},secondFull:{label:"{ss}",regexBit:"([0-5]\\d)",category:I.Seconds,numeric:!0,subtoken:"secondShort",apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString().padStart(2,"0"),extractTod:e=>e[2].toString().padStart(2,"0")},secondShort:{label:"{s}",regexBit:"([0-5]?\\d)",category:I.Seconds,numeric:!0,apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString(),extractTod:e=>e[2].toString()},millisecondFull:{label:"{nnn}",regexBit:"(\\d{3})",category:I.Milliseconds,numeric:!0,subtoken:"millisecondShort",apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString().padStart(3,"0"),extractTod:e=>e[3].toString().padStart(3,"0")},millisecondShort:{label:"{n}",regexBit:"(\\d{,3})",category:I.Milliseconds,numeric:!0,apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString(),extractTod:e=>e[3].toString()}};function A(e){return function(e){return j[e]}(function(e){return U[e]}(e))||{literal:!0}}delete j.yearShort,delete j.millisecondShort;const U=(()=>{let e={};for(let t in j)e[j[t].label]=t;return e})();function z(){return new Date(2e3,3,21,15,20,25,30)}class P extends r{constructor(e){super(e);let t=e.type;t||(t="none");let n="none";e.min&&(this.min=e.min,n=isValidDate(e.min)?"datetime":isValidTimeOfDay(e.min)?"timeofday":"unknown");let a="none";e.max&&(this.max=e.max,a=isValidDate(e.max)?"datetime":isValidTimeOfDay(e.max)?"timeofday":"unknown");let r=[n,a,t,function(e){let t=e.map((e=>U[e]));t=t.filter((e=>e));let n=t.map((e=>j[e].category));const a=[I.Hours,I.Minutes,I.Seconds,I.Milliseconds],r=[I.Years,I.Months,I.Days,I.Era];let s=!1;n.some((e=>r.includes(e)))&&(s=!0);let i=!1;return n.some((e=>a.includes(e)))&&(i=!0),i&&s?"datetime":i?"timeofday":s?"date":"unknown"}(e.formatting)];if(r=r.filter((e=>"none"!==e)),r.every((e=>e===r[0]))||(this.type="unknown"),this.type=r[0],this.formatting=[...e.formatting],!e.skipValidation&&!Y(this))return void(this.type="unknown");let s=[],i=[],o=[],l=[],h=[],u="apply",c="extract";"timeofday"===this.type&&(u="applyTod",c="extractTod"),this.formatting.forEach((e=>{if(void 0!==U[e]){let t=A(e);s.push(t.regexBit),i.push(t[u]),o.push(t[c]),l.push(W(e,t[u])),h.push(W(e,t[c]))}else s.push(m(e)),o.push((()=>e))}));let d=new RegExp(s.join(""));this._extractors=o,this._pattern=d,this._appliers=i,this._verboseAppliers=l,this._verboseExtractors=h}min=null;max=null;formatting=null;type="none";pattern=null;replacement=null;type="timestamp";toString(){let e="";var t;this.min&&this.max?e=this.format(this.min)+"-"+this.format(this.max):this.min||this.max?e=this.format(this.min?this.min:this.max):"datetime"===this.type||"date"===this.type?e=this.format(z()):"timeofday"===this.type&&(e=this.format([(t=z()).getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]));let n="X";return"date"===this.type?n="D":"datetime"===this.type?n="DT":"timeofday"===this.type&&(n="TOD"),n+"{"+e+"}"}format(e,t=!1){return t?this._verboseExtractors.map((t=>t(e,this.formatting))).join(""):this._extractors.map((t=>t(e,this.formatting))).join("")}deformat(e,t=!1){let n=null;if("timeofday"===this.type)n=[15,20,25,30];else{if(!["time","date","datetime"].includes(this.type))return t&&O.warn("Timestamp ",this.formatting," deformat(",e,") failed due to invalid type."),n;n=z()}let a=e.match(this._pattern);return a?(t?this._verboseAppliers.forEach(((e,t)=>e(n,a[t+1],this.formatting))):this._appliers.forEach(((e,t)=>e(n,a[t+1],this.formatting))),e!==this.format(n,t)?(t&&O.warn("Timestamp ",this.formatting," deformat(",e,") = ",n," vs consistency check ",this.format(n)),null):n):(t&&O.warn("Timestamp ",this.formatting," deformat(",e,") failed to match to pattern"),null)}isSupersetOf(e){if(this.formatting.length!==e.formatting.length)return!1;for(let t=0,n=this.formatting.length;t<n;t++){let n=A(this.formatting[t]),a=j[n.subtoken],r=A(e.formatting[t]);if(n.literal){if(!r.literal)return!1;if(this.formatting[t]!==e.formatting[t])return!1}else if(r!==n&&r!==a)return!1}return!0}isImplicitSupersetOf(e){}static fromShortFormatting(e){let t=[];for(let e in j)t.push(j[e].label.slice(1,-1));let n=e,a=[];for(;n.length>0;){let e=t.filter((e=>n.startsWith(e)));if(e.length>0){let t=e.reduce(((e,t)=>e.length<t.length?t:e),"");a.push("{"+t+"}"),n=n.slice(t.length)}else a.push(n[0]),n=n.slice(1)}return a[0]=[a[0]],a=a.reduce(((e,t)=>e[e.length-1].endsWith("}")||t.startsWith("{")?(e.push(t),e):(e[e.length-1]=e[e.length-1]+t,e))),new P({formatting:a})}}function W(e,t){return function(n,a){O.log("Function ",e,"(",n,a,") => ");let r=t(n,a);return O.log(n),r}}let H=(window.verbose??{}).enum;if(console.log("parse.enum.js verbosity = ",H),H)var L=window.console;else L={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>L[e]=window.console[e]));class V extends r{domain=[];constructor(e){super(e),e.domain&&(this.domain=e.domain)}format(e){return this.domain.includes(e)?e:void 0}deformat(e){return this.domain.includes(e)?e:void 0}size(){return this.domain.length}toString(){return`E{[${this.domain}]}`}toDebugString(){return`Usetype.Enum([${this.domain}])`}compatibleTypes=["string"];type="string"}let q=(window.verbose??{}).string;if(console.log("parse.string.js verbosity = ",q),q)var J=window.console;else J={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>J[e]=window.console[e]));class G extends r{constructor(e){super(e),e.potentialIds&&(this.unique=!0),e.constant&&(this.constant=!0,this.constantValue=e.constant),e.type&&(this.type=e.type)}format(e){return e.toString()}deformat(e){return e.toString()}toString(){return this.unique?"SID{"+(this.type??"")+"}":this.constant?"SC("+this.constantValue+"){"+(this.type??"")+"}":"S{"+(this.type??"")+"}"}compatibleTypes=["string"];type="string"}let Q=(window.verbose??{}).parser;if(console.log("parse.main.js verbosity = ",Q),Q)var X=window.console;else X={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>X[e]=window.console[e]));const K={skipConstants:!1};function Z(e,t){t||(t=Object.assign({},K)),X.groupCollapsed(`detemineType(${e.length>0?e[0]+"...":[]})`),X.log("args = ",t);let n,a=[];if([e,n,t]=function(e,t){let n=function(e){if(!e||0===e.length)return[];let t={};for(let n in e)t[e[n]]||(t[e[n]]=[]),t[e[n]].push(n);let n=[];for(let e in t)n.push([e,t[e].length]);if(n=n.sort(((e,t)=>e[1]-t[1])),1===n.length)return[{isConstant:!0,constantVal:n[0][0]}];if(n.length===e.length)return[{potentialIds:!0}];if(e.length/n.length>.5&&n[0][1]>=2&&n.length>2)return[new V({domain:n.map((e=>e[0]))})];if(n[n.length-1][1]/n[n.length-2][1]>2&&counts[n.length-2][1]>0)return[{hasNoval:!0,novalVal:n[n.length-1][0]}];let a=[];for(let e in t)t[e].length>1&&a.push(t[e]);return[{ambiguous:a}]}(e);console.log("preprocessEnumlikeness",n);let a=n[0];return a?a.hasNoval?(X.log("NOVAL detected as ",a.noval),t.hasNoval=!0,t.novalValue=a.novalVal,e=e.filter((e=>e!==t.noval)),n=[]):a.isConstant?(X.log("CONSTANT detected as ",a.constant),t.isConstant=!0,t.constantVal=a.constantVal,e=[e[0]],n=[]):a.potentialIds?(X.log("POTENTIAL ID column found"),t.potentialIds=!0,n=[]):a.ambiguous?(t.ambiguousSets=a.ambiguous,n=[]):X.log("Enum usetype detected as ",a):n=[],[e,n,t]}(e,t),a.push(...n),!t.skipConstants||!t.isConstant){let n=performance.now(),r=function(e,t){if(!e||0===e.length)return[];let n=[];n=[...e].sort().slice(0,5),g.log("recognizeNum -- initial batch = ",n);let a=y(n,t);g.log("extractedNumUsetypes",a);let r=a.map((()=>0));for(let n=0,s=e.length;n<s;n++){let s,i=e[n];for(let e=0,n=a.length;e<n;e++)if(!a[e].disabled){let n=a[e].deformat(i);if(n)r[e]++,a[e].max<n&&(a[e].max=n),a[e].min>n&&(a[e].min=n);else{g.log("Matching",a[e],"against",i,"failed, disabling potential format."),g.log("Trying to recover expanded number usetype..."),s?g.log("Using pre-extracted potential usetypes ",s):(s=y([i],t),g.log("Extracting potential expanding usetypes ",s));let n=!1;for(let t=0,r=s.length;t<r;t++)if(s[t].isSupersetOf(a[e])){g.log("Found fitting expansion. Replacing old ",a[e],"with new ",s[t]),n=!0,a[e]=s[t],s.splice(t,1);break}n||(a[e].disabled=!0)}}if(0===a.length)return[]}return a.forEach(((t,n)=>t.confidence=r[n]/e.length)),a=a.filter((e=>!e.disabled)),a}(e,t);X.log("determineType -- recognizeNumbers -- took ",performance.now()-n),X.log("NumberUsetypes detected: ",r),a.push(...r);let s=performance.now(),i=function(e,t){let n=performance.now(),a=(N||function(){let e=[];const t=[["{YYYY}","{MM}","{DD}"],["--","{MM}","{DD}"]];e=e.concat(t);const n=[["{YYYY}","-","{MM}","-","{DD}"],["{YYYY}","-","{MM}"],["--","{MM}","-","{DD}"]];e=e.concat(n);const a=[["T","{hh}","{mm}","{ss}",".","{nnn}"],["T","{hh}","{mm}","{ss}"],["T","{hh}","{mm}"],["T","{hh}"]];e=e.concat(a);let r=[];for(let e of t)for(let t of a)r.push(e.concat(t));e=e.concat(r);const s=[["{hh}",":","{mm}",":","{ss}",".","{nnn}"],["{hh}",":","{mm}",":","{ss}"],["{hh}",":","{mm}"]];e=e.concat(s);let i=[];for(let e of n)for(let t of s)i.push(e.concat(["T"],t));e=e.concat(i);const o=[".","-","/"],l=[":","."],h=[" ","\t"],u=[["{DD}","{MM}","{YYYY}"],["{DD}","{MM}","{YY}"],["{MM}","{DD}","{YYYY}"],["{MM}","{DD}","{YY}"],["{YYYY}","{MM}","{DD}"]],c=[["{hh}","{mm}","{ss}","{nnn}"],["{hh}","{mm}","{ss}"],["{hh}","{mm}"]];let d=[];for(let e of u)for(let t of o)d.push(p(e,t));e=e.concat(d);let m=[];for(let e of c)for(let t of l)m.push(p(e,t));e=e.concat(m);let f=[];for(let e of d)for(let t of m)f=f.concat(h.map((n=>[].concat(e,[n],t))));e=e.concat(f),N=e}(),N.map((e=>new P({formatting:e,skipValidation:!0}))));if(a=M(e,a),a=E(a),a.length>0)return O.log("recognizeTimestamp -- expected usetypes found."),a;O.log("recognizeTimestamp -- expectedUsetypes -- took ",performance.now()-n),n=performance.now();let r=function(e){let t=[],n={},a={},r=Object.keys(j);for(let n of e)s(n).forEach((e=>{a[e]||(a[e]=!0,t.push(e))}));return t.map((e=>new P({formatting:e})));function s(e,t=[],a=0){if(""===e)return[[]];if(n[[e,"|",t]])return n[[e,"|",t]];let i=[];for(let n=a,o=r.length;n<o;n++){let a=j[r[n]];if(t.includes(a.category))continue;let o=new RegExp(a.regexBit),l=e.match(o);if(l){let n=[a.category,...t],r=e.split(l[1]),o=r[0],h=r.slice(1).join(l[1]),u=s(o,n);for(let e of u){let t=e.map((e=>A(e).category)).filter((e=>e)),r=s(h,[].concat(n,t));for(let t of r){let n=[].concat(e,[a.label],t);i.push(n)}}}}return i.length>0?(n[[e,"|",t]]=i,i):(n[[e,"|",t]]=[[e]],[[e]])}}(e.slice(0,5));return O.log("recognizeTimestamp -- extractedUsetypes === ",r),O.log("recognizeTimestamp -- extractTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=r.filter(Y),O.log("recognizeTimestamp -- extractedUsetypes === ",r),O.log("recognizeTimestamp -- filterInvalidUsetypes -- took ",performance.now()-n),n=performance.now(),r=M(e,r),O.log("recognizeTimestamp -- extractedUsetypes === ",r),O.log("recognizeTimestamp -- filterTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=E(r),O.log("recognizeTimestamp -- extractedUsetypes === ",r),O.log("recognizeTimestamp -- filterDuplicatesAndSubtypes -- took ",performance.now()-n),n=performance.now(),r}(e);X.log("determineType -- recognizeTimestamps -- took ",performance.now()-s),X.log("TimestampUsetypes detected: ",i),a.push(...i)}if(0===a.length){let n=performance.now(),r=function(e,t){console.log("recognizeStrings...");let n=Object.assign({},t);return e.slice(0,10).every((e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)))&&(n.type="url"),[new G(n)]}(e,t);X.log("detemineType -- recognizeSTrings -- took ",performance.now()-n),X.log("StringUsetypes detected: ",r),a=r}return X.groupEnd(),a}console.log("Loaded SourceData.js");const ee=[",",";","\t"];class te{constructor(e){e.match(/^\s*$/)||this.parseData(e)}static Empty=new te("");_head=[];_data=[];_usetypes=[];get head(){return this._head}header(e){return this._head[e]}get size(){return this._data.length*this._data[0].length??0}get width(){return this._data[0].length??0}get height(){return this._data.length??0}col(e){return this._data.map((t=>t[e]))}cols(...e){let t=this._data.map((t=>t.filter(((t,n)=>e.includes(n)))));return t[0].map(((e,n)=>t.map((e=>e[n]))))}colr(e,t){if(e>t){var n=!0;[e,t]=[t,e]}let a=this._data.map((n=>n.slice(e,t))),r=a[0].map(((e,t)=>a.map((e=>e[t]))));return n?r.reverse():r}row(e){return this._data[e]}rows(...e){return this._data.filter(((t,n)=>e.includes(n)))}rowr(e,t){if(e>t){var n=!0;[e,t]=[t,e]}let a=this._data.slice(e,t);return n?a.reverse():a}usetype(e){return e<0&&(e=this.width-1),this._usetypes.length<this.width&&this.determineUsetypes(),this._usetypes[e]}usetypes(...e){return e=e.map((e=>e<0?this.width-1:e)),this._usetypes.length<this.width&&this.determineUsetypes(),this._usetypes.filter(((t,n)=>e.includes(n)))}usetyper(e=0,t=-1){if(e<0&&(e=this.width-e),t<0&&(t=this.width-t),e>t){var n=!0;[e,t]=[t,e]}this._usetypes.length<this.width&&this.determineUsetypes();let a=this._usetypes.slice(e,t);return n?a.reverse():a}parseData(e){let t=e.trim().split(/\r?\n/);const n=e=>ee.filter((t=>e.replace(/"[^"]"/,"").match(t)));{let e=n(t[0]);if(e||(e=n(t[1])),1!==e.length)throw new Error(`Multiple (or no) valid delimiters encountered (${e})`);var a=e[0]}let r=new RegExp(`(?<=^|${a})("[^"]*")|[^${a}"]+(?=${a}|$)`,"g");this._head=t[0].match(r).map((e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e));for(let e=1;e<t.length;e++){let n=t[e].match(r).map((e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e));this._data.push(n)}this.triggerEvent(ne.dataParsed,this)}determineUsetypes(){this._usetypes=[];for(let e=0,t=this.width;e<t;e++)this._usetypes[e]=Z(this.col(e))}getChartData(e,t,n){console.log("GetChartData ",e,t,n);let a=new google.visualization.DataTable;for(let n=0;n<e.length;n++)a.addColumn(t[n],this._head[e[n]]);for(let r=0;r<this._data.length;r++){let s=[];for(let a=0;a<e.length;a++){let i=tryParse(this._data[r][e[a]],t[a],n[a]);if(null==i)throw"In column "+this._head[e[a]]+" Could not parse value "+this._data[r][e[a]]+" into type "+t[a]+" using format "+n[a];s.push(i)}a.addRow(s)}return a}getUsetypedData(e){console.log("getUsetypedData ",e);let t=new google.visualization.DataTable;for(let n=0;n<e.length;n++)t.addColumn(this._usetypes[e[n]][0].type,this._head[e[n]]);for(let n=0;n<this._data.length;n++){let a=[];for(let t=0;t<e.length;t++){let r=this._usetypes[e[t]][0].deformat(this._data[n][e[t]]);if(!r&&0!==r)return console.error("In column ",this._head[e[t]]," Could not parse value ",this._data[n][e[t]]," into type ",this._usetypes[e[t]][0]),null;a.push(r)}t.addRow(a)}return t}}const ne={dataParsed:"onDataParsed"};function ae(e,t,n){n||(n=(e,t)=>e.some((e=>t.includes(e))));let a=(e,t)=>{if(e.length,t.length,0===t.length)return[];let r=t[0],s=e.filter((e=>n(e,r)));if(0!==s.length)for(let n of s){let r=e.filter((e=>e!==n)),s=t.slice(1),i=a(r,s);if(i)return[n,...i]}},r=a(e,t);return r?r.map((t=>e.indexOf(t))):void 0}n(te,Object.values(ne));class re{_head=[];get head(){return this._head}_data=[];get height(){return this._data.length}get width(){return(this._data[0]??[]).length}get length(){return this.height()*this.width()}get data(){return this._data}row(e){return this._data[e]}col(e){return this._data.map((t=>t[e]))}_usetypes=[];get usetypes(){return 0===this._usetypes.length&&this._auto&&this._determineUsetypes(),this._usetypes}_meta={};get meta(){return this._meta}_dataErr=[];get errors(){return this._dataErr}_bindings=[];get size(){return this._bindings.length}get bindings(){return 0===this._bindings.length&&this._auto&&this._createBindings(),this._bindings}constructor({auto:e=!0}={}){this._auto=e}_reset(){this._head=[],this._data=[],this._dataErr=[],this._meta={},this._usetypes=[],this._bindings=[]}setAutomatic(e){this._auto=e}setData(e){this._reset();let t=e.data;1===t[t.length-1].length&&""===t[t.length-1][0]&&(console.log("Removing last empty row..."),t.splice(-1)),t.every((e=>0===e[e.length-1].trim().length))&&(console.log("Remving last empty column..."),t=t.map((e=>e.slice(0,-1)))),this._head=t[0],this._data=t.slice(1),this._meta=e.meta,this._dataErr=e.errors,this.triggerEvent(oe.sourceChange,e)}loadFromUrl(e,t){Papa.parse(e,{encoding:"utf8",download:!0,skipEmptyFiles:!0,complete:e=>this.setData(e)})}loadFromLocal(e,t){Papa.parse(e,{encoding:"utf8",skipEmptyFiles:!0,complete:e=>this.setData(e)})}setUsetypes(e){this._auto||(this._usetypes=e)}_determineUsetypes(){this._usetypes=[];for(let e=0,t=this.width;e<t;e++)this._usetypes[e]=Z(this.col(e))}createBinding(e){if(!this._auto)throw new Error("Not implemented")}_createBindings(){var e=this._usetypes,n=t.all().ChartTypes;this._bindings=[];for(let t of n){let n=ae(e,t.roles,se);if(n){console.log(n);let e=n.map((e=>this._usetypes[e][0]));console.log("new Binding ",e,t.name,n,null),this._bindings.push(new ie(this,{usetypes:e,chartType:t.name,bindOrder:n,boundElementId:null}))}}}setBindingElementId(e,t){this._bindings[e].setBoundElementId(t)}drawBinding(e){this._drawBinding(this._bindings[e])}_drawBinding(e){let n=this._getUsetypedData(e),a=t.chart(e._chartType);console.log(e._chartType);let r=a["internal-name"]??a.name;new google.visualization[r](document.getElementById(e._boundElementId)).draw(n)}_getUsetypedData(e){let t=e._bindOrder;console.log("getUsetypedData ",t);let n=new google.visualization.DataTable;for(let e=0;e<t.length;e++)n.addColumn(this._usetypes[t[e]][0].type,this._head[t[e]]);for(let e=0;e<this._data.length;e++){let a=[];for(let n=0;n<t.length;n++){let r=this._usetypes[t[n]][0].deformat(this._data[e][t[n]]);if(!r&&0!==r)return console.error("In column ",this._head[t[n]]," Could not parse value ",this._data[e][t[n]]," into type ",this._usetypes[t[n]][0]),null;a.push(r)}n.addRow(a)}return n}}function se(e,n){let a;return a=n.types?n.types:t.role(n.role).types,e.some((e=>a.some((t=>e.compatibleTypes.includes(t)))))}class ie{_catalogue;_usetypes;_boundElementId;constructor(e,{usetypes:t=[],chartType:n="",bindOrder:a=[],boundElementId:r=null}){this._catalogue=e,this._usetypes=t,this._chartType=n,this._bindOrder=a,r&&(this._boundElementId=r)}setBoundElementId(e){this._boundElementId=e}get usedFeatures(){return this._bindOrder}}const oe={sourceChange:"dataChanged",usetypeChange:"usetypesChanged",bindingChange:"bindingsChanged"};n(re,Object.values(oe)),console.log("Loaded core/Chart.js");const le={sourceChange:"dataChanged",boundElementChange:"boundElementChanged",typeChange:"chartTypeChanged"};n(class{_debugArgs={};constructor(e){this.verbose=(e??{}).verbose}_sourceData;get SourceData(){return this._sourceData&&null!=this._sourceData?this._sourceData:te.Empty}set SourceData(e){let t=this._sourceData;this._sourceData=e,this.triggerEvent(le.sourceChange,this,t)}_roles=[];get Roles(){return this._roles}set Roles(e){this._roles=e}_chartBoundElement;get ChartBoundElement(){return this._chartBoundElement}set ChartBoundElement(e){let t=this._chartBoundElement;this._chartBoundElement=e,this.triggerEvent(le.boundElementChange,this,t)}_internalName;get InternalName(){return this._internalName?this._internalName:this._name}set InternalName(e){this._internalName=e}_name;get Name(){return this._name}set Name(e){this._name=e}formattedData;options;loadDataFromUrl(e){return console.log(`loadDataFromUrl(${e})`),fetch(e).then((e=>e.text())).then((e=>{this.SourceData=new te(e)}))}loadDataFromRaw(e){e||console.err("No data provided for new data source."),this.SourceData=new te(e)}setContainer(e){if(e){var t=document.getElementById(e);t&&"DIV"==t.tagName.toUpperCase()?this.ChartBoundElement=t:console.error(`Element of id ${e} doesn't exist or is not a div. No change...`)}else console.error("No element id provided. No change...")}setType(e){if(!t.hasChart(e))throw"Please provide a valid chart type name from getChartTypes. Aborting operation...";{let n=t.chart(e),a=this.Name;this.Name=e,this.InternalName=n["internal-name"],this.Roles=he.createListByMixedContent(n.roles,this),this.triggerEvent(le.typeChange,this,a)}}draw(e=!0){if(this.SourceData){if(google.visualization[this.InternalName]){var t=new google.visualization.DataTable,n=[],a=[],r=[];for(let s of this.Roles){if(!s.Column){if(s.Optional){e&&console.warn(`Undefined optional role ${s.Name}, skipping.`);continue}if(e)throw new Error(`Role ${s.Name} has no column selected despite being mandatory.`);return}if(!this.SourceData.head.includes(s.Column)){if(e)throw new Error(`Role ${s.Name} has invalid selected column ${s.Column}. Internal error.`);return}if(s.Optional){if(s.Disabled)continue;t.addColumn({type:s.Type,role:s.Role})}else t.addColumn(s.Type,s.Name);n.push(this.SourceData.head.indexOf(s.Column)),a.push(s.Type),r.push(s.Format);for(let i of s.Subroles)i.Column&&(this.SourceData.head.includes(i.Column)||e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`),i.Disabled||(t.addColumn({type:i.Type,role:i.Role}),n.push(this.SourceData.head.indexOf(i.Column)),a.push(i.Type),r.push(i.Format)));if(s.Repeatable)for(let i of s.Copies)if(i.Column)if(this.SourceData.head.includes(i.Column)){if(s.Optional){if(s.Disabled)continue;t.addColumn({type:i.Type,role:i.Role})}else t.addColumn(i.Type,i.Name);n.push(this.SourceData.head.indexOf(i.column)),a.push(i.Type),r.push(i.Format);for(let i of s.Subroles)i.Column&&(this.SourceData.head.includes(i.Column)||e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`),t.addColumn({type:i.Type,role:i.Role}),n.push(this.SourceData.head.indexOf(i.Column)),a.push(i.Type),r.push(i.Format))}else e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`)}var s=this.SourceData.getChartData(n,a,r),i=new google.visualization[this.InternalName](this.ChartBoundElement);console.log("Formatted data: ",s),this.formattedData=s,i.draw(s,this.options)}else if(e)throw new Error(`Invalid chart type ${this.Name}. Internal error.`)}else if(e)throw new Error("No source data set, can't draw chart.")}redraw(){this.formattedData&&new google.visualization[this.InternalName](this.ChartBoundElement).draw(this.formattedData,this.options)}saveConfigData(){let e={Name:this.Name,Roles:[]};for(let t of this.Roles)e.Roles.push(t.saveConfigData());return e}loadConfigData(e){this.setType(e.Name);for(let t of e.Roles)this.Roles.find((e=>e.Name==t.name)).loadConfigData(t)}},Object.values(le)),console.log("Loaded Role.js");class he{_name;get Name(){return this._name?this._name:"name.unset"}set Name(e){this._name=e}_caption;get Caption(){return this._caption?this._caption:this.Name.replace(/\{1\}/,this.RepeatIndex).trim()}set Caption(e){this._caption=e}_types=[];get Types(){return this._types}set Types(e){this._types=e}_defval;get Defval(){return this._defval}set Defval(e){this._defval=e}_role;get Role(){return this._role}set Role(e){this._role=e}_subroles=[];get Subroles(){return this._subroles}set Subroles(e){this._subroles=e}_optional=!1;get Optional(){return this._optional}set Optional(e){this._optional=e}_disabled=!1;get Disabled(){return this._disabled}set Disabled(e){this._disabled=e}_repeatable=!1;get Repeatable(){return this._repeatable}set Repeatable(e){this._repeatable=e}_copies=[];get Copies(){return this._copies}set Copies(e){this._copies=e}_owner;get Owner(){return this._owner}set Owner(e){this._owner=e}_repeatIndex=1;get RepeatIndex(){return this._repeatIndex}set RepeatIndex(e){this._repeatIndex=e}_column;get Column(){return this._column}set Column(e){let t=this._column;this._column=e,this.triggerHandler("columnChange",t)}_type;get Type(){return this._type}set Type(e){let t=this._type;this._type=e,this.triggerHandler("typeChange",t)}_format;get Format(){return this._format}set Format(e){let t=this._format;this._format=e,this.triggerHandler("formatChange",t)}_chart;get Chart(){return this._chart}set Chart(e){this._chart=e}constructor(e,t){if(this.Chart=t,e.name&&(this.Name=e.name),e.caption&&(this._caption=e.caption),e.types&&(this.Types=e.types,this.Type=this.Types[0]),e.default&&(this.Defval=e.default),e.optional&&(this.Optional=e.optional),e.repeatable&&(this.Repeatable=e.repeatable),e.subrolenames)for(var n of(this.Subroles=[],e.subrolenames))this.Subroles.push(he.createByRole(n,t));this.Column="",this.Format="",t||(console.error("chart not defined for a Role in:"),console.log(this))}static createByRole(e,n){let a=t.role(e);if(!a)return console.log(`Role ${e} not found`),null;var r=new he(a,n);return r.Role=e,r}static createByData(e,t){return e?new he(e,t):(console.log("Invalid data provided for Role factory:"),console.log(e),null)}static createListByMixedContent(e,t){var n=[];for(let a of e)a.role?n.push(he.createByRole(a.role,t)):n.push(he.createByData(a,t));return n}getRepeatCopy(){if(!this.Repeatable)throw"getRepeatCopy called on a non-repeatable chart role. Internal error.";var e=new he(t.chartRole(this.Chart.Name,this.Name),this.Chart);return e.Owner=this,e.RepeatIndex=this.getFreeRepeatIndex(),this.Copies.push(e),e.Optional=!0,e}getFreeRepeatIndex(){let e=1;for(;this.Copies.some((t=>t.RepeatIndex===e));)e++;return e}detach(){if(!this.Owner)throw"Cannot remove a non-repeated role.";this.Owner.Copies=this.Owner.Copies.splice(this.Owner.Copies.indexOf(this)),this.Owner=null}saveConfigData(){return{name:this.Name,owner:this.Owner,column:this.Column,type:this.Type,format:this.Format,disabled:this.Disabled}}loadConfigData(e){if(this.Name!=e.name)throw`Incompatible role config of ${e.name} for role of name ${this.Name}.`;e.column||console.warn(`Unset column for role ${this.Name}.`),this.Column=e.column,e.format||console.warn(`Unset format for role ${this.Name}.`),this.Format=e.format,e.type||console.warn(`Unset type for role ${this.Name}.`),this.Type=e.type,this.Optional||console.warn(`Disabled non-optional role ${this.Name}.`),this.Disabled=e.disabled,e.owner&&(this.Repeatable||console.warn(`Copy of non-repeatable role ${this.Name}.`),this.Owner=e.owner,this.Owner.Copies.push(this),this.RepeatIndex=this.Owner.getFreeRepeatIndex())}handlers(e){this.params||(this.params={});for(let t in e)this.params[t]=e[t]}triggerHandler(e,...t){console.log("Trying to trigger handler for ",e," with params ",t),this.params&&this.params[e]&&this.params[e](...t)}}console.log("Loaded core/Main.js"),window.Catalogue=re,window.Init=function(e){fetch("https://sanuelson.github.io/DataChartRenderer/src/json/graph_types.json").then((e=>e.json())).then((n=>{t.loadChartTemplates(n),e.onChartTemplatesLoaded&&e.onChartTemplatesLoaded()})).catch((e=>console.error(e))),google.charts.load("current",{packages:["corechart","annotationchart","calendar","sankey","timeline","treemap","wordtree"]}),e.onGoogleChartsLoaded&&google.charts.setOnLoadCallback(e.onGoogleChartsLoaded)}})();