(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ruleAll:()=>w,ruleAny:()=>_,ruleBoth:()=>y,ruleEither:()=>b,ruleEqual:()=>N,ruleIff:()=>C,ruleImpliedBy:()=>v,ruleImplies:()=>x,ruleNone:()=>D,ruleNot:()=>f,ruleNotAll:()=>S});var a={};e.r(a),e.d(a,{parseTimestamp:()=>R,recognizeTimestamp:()=>T});var r={};e.r(r),e.d(r,{Enum:()=>J,Number:()=>V,String:()=>q,Timestamp:()=>X,TimestampNew:()=>G,Usetype:()=>H});var n={};e.r(n),e.d(n,{parseNum:()=>Q,recognizeNum:()=>Z});var s={};e.r(s),e.d(s,{recognizeEnumset:()=>K});var o={};e.r(o),e.d(o,{determineType:()=>te,tryParse:()=>ee});var l={};e.r(l),e.d(l,{bindEventSystemMixin:()=>ae});var h={};e.r(h),e.d(h,{SourceData:()=>se});var u={};e.r(u),e.d(u,{Template:()=>le});var p={};e.r(p),e.d(p,{Role:()=>he});var d={};e.r(d),e.d(d,{Chart:()=>ue,eventHandles:()=>pe});var m={};e.r(m),e.d(m,{Chart:()=>ue,ChartEventHandles:()=>pe,Init:()=>de,Role:()=>he,SourceData:()=>se});var c={};e.r(c);var g={};e.r(g),e.d(g,{Init:()=>me});const f=e=>(...t)=>!e(...t),y=(e,t)=>(...a)=>e(...a)&&t(...a),b=(e,t)=>(...a)=>e(...a)||t(...a),x=(e,t)=>(...a)=>!e(...a)||t(...a),v=(e,t)=>(...a)=>e(...a)||!t(...a),C=(e,t)=>(...a)=>e(...a)===t(...a),w=(...e)=>(...t)=>e.every((e=>e(...t))),_=(...e)=>(...t)=>e.some((e=>e(...t))),D=(...e)=>!_(...e),S=(...e)=>!w(...e),N=(...e)=>_(w(...e),D(...e));function T(e,t){let a=function(e,t){if(0===e.length)return[];let a=[-7],r=[-6],n=[-5],s=[-4],i=[-3],o=[-2],l=[-1],h=e[0].match(E);if(t.noval){let a=0;for(;e[a++]===t.noval;);h=e[a].match(E)}for(let e in h){let t=h[e];parseInt(t)||!M.includes(t)&&!O.includes(t)?(1970<=t&&t<=9999&&a.push(e),1<=t&&t<=12&&r.push(e),1<=t&&t<=31&&n.push(e),0<=t&&t<=23&&s.push(e),0<=t&&t<=59&&i.push(e),0<=t&&t<=59&&o.push(e),0<=t&&t<=999&&l.push(e)):(r.push(e),t=h[e]=M.indexOf(t)?M.indexOf(t)+1:O.indexOf(t)+1)}let u=function(e,...t){if(!t)return[];if(e.sturdy&&e.callback){let a=t[0],r=0;for(;++r<t.length;)a=a.flatMap((e=>t[r].filter((t=>e.includes?!e.includes(t):e!==t)).map((t=>[e,t].flat())))).filter(e.callback);return a}{let a=t.reduce(((e,t)=>e.flatMap((e=>t.filter((t=>e.includes?!e.includes(t):e!==t)).map((t=>[e,t].flat()))))));return e.callback?a.filter(e.callback):a}}({sturdy:!0,callback:w(x(F("D"),F("M")),x(F("q"),F("s")),x(F("m"),F("h")),x(F("s","h"),F("m")),x(F("s","q"),I("s","q")),x(F("m","s"),I("m","s")),x(F("h","m"),I("h","m")),x(F("D","M"),I("D","M")),x(F("D","M","Y"),_(I("D","Y"),I("M","Y"))),k())},a,r,n,s,i,o,l);console.log(u);let p=Math.max(5,e.length/1e3),d=-1;for(;++d<=6;){const a=e=>e.reduce(((e,t)=>t<0?++e:e),0);let r=u.filter((e=>a(e)===d)),n=r.map((e=>0));if(0!==r.length){for(let a=1;a<e.length;a++){if(t.noval&&e[a]===t.noval)continue;let s=e[a].match(E).map(P);for(let e=0;e<r.length;e++)j(s,r[e])||n[e]++;r=r.filter(((e,t)=>n[t]<p))}if(r.length>0)return r}}return[]}(e,t);return function(e){const t=_(F("Y"),F("M"),F("D")),a=_(F("h"),F("m"),F("s"),F("q"));let r=[];for(let n of e){let e=t(n),s=a(n);e&&s?r.push("datetime"):e?r.push("date"):s&&r.push("timeofday")}}(a),a.map((e=>function(e){let t=["","","","","","",""];return e[0]>=0&&(t[e[0]]="Y"),e[1]>=0&&(t[e[1]]="M"),e[2]>=0&&(t[e[2]]="D"),e[3]>=0&&(t[e[3]]="h"),e[4]>=0&&(t[e[4]]="m"),e[5]>=0&&(t[e[5]]="s"),e[6]>=0&&(t[e[6]]="n"),t.join("")}(e))).map((e=>new X(e)))}function R(e,t){return t.match(/Y|M|D/)?function(e,t){let a=e.split(/[^0-9]/),r=0,n=1,s=1,i=0,o=0,l=0,h=0;for(let e=0;e<t.length;e++)switch(t[e]){case"Y":r=parseInt(a[e]);break;case"M":n=parseInt(a[e]);break;case"D":s=parseInt(a[e]);break;case"h":i=parseInt(a[e]);break;case"m":o=parseInt(a[e]);break;case"s":l=parseInt(a[e]);break;case"q":h=parseInt(a[e])}return new Date(r,n,s,i,o,l,h)}(e,t):function(e,t){let a=e.split(/[^0-9]/),r=0,n=0,s=0,i=0;for(let e=0;e<t.length;e++)switch(t[e]){case"h":r=parseInt(a[e]);break;case"m":n=parseInt(a[e]);break;case"s":s=parseInt(a[e]);break;case"q":i=parseInt(a[e])}return[r,n,s,i]}(e,t)}var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Sep","Oct","Nov","Dec"],M=["January","February","March","April","May","June","July","September","October","November","December"],B=["Y","M","D","h","m","s","q"];const E=/((?:[A-Za-z]+)|(?:[0-9]+))/g,F=(...e)=>t=>e.every((e=>t[B.indexOf(e)]>=0)),I=(...e)=>function(t){let a=e.map((e=>t[B.indexOf(e)])),[r,n]=[Math.min(...a),Math.max(...a)];return t.map((e=>a.includes(e)?1:e<=r?2:e>=n?3:0)),t.every((e=>a.includes(e)|e<=r|e>=n))},k=()=>function(e){let t=!1,a=!1;for(let r=0;r<e.length;r++)if(e[r]>=0&&!t)t=!0;else if(e[r]<0&&t)a=!0;else if(e[r]>=0&&a)return!1;return!0},j=(e,t)=>(t[0]<0||1970<=e[t[0]]&&e[t[0]]<=9999)&&(t[1]<0||1<=e[t[1]]&&e[t[1]]<=12)&&(t[2]<0||1<=e[t[2]]&&e[t[2]]<=31)&&(t[3]<0||0<=e[t[3]]&&e[t[3]]<=23)&&(t[4]<0||0<=e[t[4]]&&e[t[4]]<=59)&&(t[5]<0||0<=e[t[5]]&&e[t[5]]<=59)&&(t[6]<0||0<=e[t[6]]&&e[t[6]]<=999),P=e=>{let t=parseInt(e);if(t||0===t)return t;let a=O.indexOf(e);if(a>=0)return a+1;let r=M.indexOf(e);return r>=0?r+1:void 0},A=["January","February","March","April","May","June","July","August","September","October","November","December"],U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],L=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],W={era:{label:"{EE}",regexBit:"((?:AD)|(?:BC))",category:8,apply:(e,t)=>e.getFullYear()>0&&"BC"===t&&e.setFullYear(-e.getFullYear()),extract:e=>e.getFullYear()>=0?"AD":"BC"},yearFull:{label:"{YYYY}",regexBit:"([0-9]{4,})",category:1,apply:(e,t)=>e.setFullYear(+t),extract:e=>e.getFullYear().toString().padStart(4,"0")},yearShort:{label:"{YY}",regexBit:"([0-9]{2})",category:1,apply:(e,t)=>e.setFullYear(+t+1900),extract:e=>e.getFullYear().toString()},monthFull:{label:"{MM}",regexBit:"([0-9]{2})",category:2,apply:(e,t)=>e.setMonth(+t),extract:e=>e.getMonth().toString().padStart(2,"0")},monthShort:{label:"{M}",regexBit:"([0-9]{,2})",category:2,apply:(e,t)=>e.setMonth(+t),extract:e=>e.getMonth().toString()},monthName:{label:"{NN}",regexBit:"("+A.map((e=>"(?:"+e+")")).join("|")+")",category:2,apply:(e,t)=>e.setMonth(A.indexOf(+t)),extract:e=>A[e.getMonth()]},monthAbbrev:{label:"{N}",regexBit:"("+U.map((e=>"(?:"+e+")")).join("|")+")",category:2,apply:(e,t)=>e.setMonth(U.indexOf(+t)),extract:e=>U[e.getMonth()]},dayFull:{label:"{DD}",regexBit:"([0-9]{2}",category:3,apply:(e,t)=>e.setDate(+t),extract:e=>e.getDate().toString().padStart(2,"0")},dayShort:{label:"{D}",regexBit:"([0-9]{,2}",category:3,apply:(e,t)=>e.setDate(+t),extract:e=>e.getDate().toString()},dayOfWeekFull:{label:"{WW}",regexBit:"("+Y.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>console.warn("Apply dayOfWeekFull called, undefined behaviour"),extract:e=>Y[e.getDay()]},dayOfWeekShort:{label:"{W}",regexBit:"("+L.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>console.warn("Apply dayOfWeekFull called, undefined behaviour"),extract:e=>L[e.getDay()]},meridiem:{label:"{RR}",regexBit:"((?:AM)(?:PM))",category:9,apply:(e,t)=>{let a=e.getHours();"PM"===t&&a<12?e.setHours(a+12):"AM"===t&&12===a&&cate.setHours(0)},extract:e=>e.getHours()<12||0===e.getHours()?"AM":"PM"},hourFull:{label:"{hh}",regexBit:"([0-9]{2})",category:4,apply:(e,t)=>e.setHours(t),extract:e=>e.getHours().toString().padStart(2,"0")},hourShort:{label:"{h}",regexBit:"([0-9]{,2}",category:4,apply:(e,t)=>e.setHours(t),extract:e=>e.getHours().toString()},minuteFull:{label:"{mm}",regexBit:"([0-9]{2})",category:5,apply:(e,t)=>e.setMinutes(t),extract:e=>e.getMinutes().toString().padStart(2,"0")},minuteShort:{label:"{m}",regexBit:"([0-9]{,2}",category:5,apply:(e,t)=>e.setMinutes(t),extract:e=>e.getMinutes().toString()},secondFull:{label:"{ss}",regexBit:"([0-9]{2})",category:6,apply:(e,t)=>e.setSeconds(t),extract:e=>e.getSeconds().toString().padStart(2,"0")},secondShort:{label:"s",regexBit:"([0-9]{,2})",category:6,apply:(e,t)=>e.setSeconds(t),extract:e=>e.getSeconds().toString()},millisecondFull:{label:"{nnn}",regexBit:"([0-9]{3})",category:7,apply:(e,t)=>e.setMilliseconds(t),extract:e=>e.getMilliseconds().toString().padStart(3,"0")},millisecondShort:{label:"n",regexBit:"([0-9]{,3})",category:7,apply:(e,t)=>e.setMilliseconds(t),extract:e=>e.getMilliseconds().toString()}},z=(()=>{let e={};for(let t in W)e[W[t].label]=t;return e})();class H{constructor(e){}format=e=>e;deformat=e=>e;toString=()=>"{undefined}";toFormatString=()=>"";toDebugString=()=>"Usetype.Base()";compatibleTypes=[];type="undefined"}class q extends H{constructor(e){super()}format=e=>e;deformat=e=>e;toString=()=>"{string}";toFormatString=()=>"";toDebugString=()=>"Usetype.Base()";compatibleTypes=["string"];type="string"}class J extends H{domain=[];constructor(e){super(),this.domain=e.domain??[]}format=e=>this.domain.includes(e)?e:void 0;deformat=e=>this.domain.includes(e)?e:void 0;size=()=>domain.length;toString=()=>`{[${this.domain}]}`;toDebugString=()=>`Usetype.Enum([${this.domain}])`;compatibleTypes=["string"];type="string"}class V extends H{constructor({min:e=null,max:t=null,sample:a=null,decimalSeparator:r=".",thousandSeparator:n="",prefix:s="",suffix:i="",integerPlaces:o=0,decimalPlaces:l=0,integral:h=!0}){super(),this.min=e,this.max=t,e||t||(this.min=a),this.decimalSeparator=r,this.thousandSeparator=n,this.prefix=s,this.suffix=i,this.integerPlaces=o,this.decimalPlaces=l,this.integral=h}min=null;max=null;prefix="";suffix="";decimalSeparator=".";thousandSeparator="";separateDecimalThousands=!1;decimalPlaces=0;integerPlaces=0;integral=!0;toString=()=>null!==this.min&&null!==this.max?`{[${this.format(this.min)}][${this.format(this.max)}]}`:null!==this.min||null!==this.max?`{${this.format(this.min?this.min:this.max)}}`:this.toFormatString();toFormatString=()=>{let e=this.max?this.max:this.min?this.min:12345.6789,t=this.format(e).split(this.decimalSeparator);return 1===t.length?t[0].replace(/[0-9]/g,"X"):t[0].replace(/[0-9]/g,"X")+this.decimalSeparator+t[1].replace(/[0-9]/g,"x")};format=e=>{var t=e.toFixed(this.decimalPlaces).split("."),a=t[0];if(this.integerPlaces>0&&t[0].length<this.integerPlaces&&(a="0".repeat(this.integerPlaces-a.length)+a),a=this._addSeparator(t[0],this.thousandSeparator,!1),this.integral)return this.prefix+a+this.suffix;var r="0";return t.length>1&&(r=t[1]),this.decimalPlaces>0&&t[1].length<this.decimalPlaces&&(r+="0".repeat(this.decimalPlaces-r.length)),this.separateDecimalThousands&&(r=this._addSeparator(t[1],this.thousandSeparator,!0)),this.prefix+a+this.decimalSeparator+r+this.suffix};deformat=e=>{let t=e;return this.prefix.forEach((e=>{t.startsWith(e)&&(t=t.slice(e.length))})),this.suffix.forEach((e=>{t.endsWith(e)&&(t=t.slice(-e.length))})),this.thousandSeparator&&(t=t.split(this.thousandSeparator).join("")),this.decimalSeparator&&(t=t.split(this.decimalSeparator).join(".")),isNaN(t)?null:+t};_addSeparator=(e,t,a)=>(a?e.match(/.{1,3}/g):e.match(/.{1,3}(?=(.{3})*$)/g)).join(t);compatibleTypes=["number"];type="number"}class G extends H{constructor(e){super();var t=0;if(e.min){if(e.min instanceof Date)t=1;else{if(!(e.min instanceof Array&&e.min.length<5))throw"Timestamp ctor @ min "+e.min+"unrecognized type";t=2}this.min=e.min}if(e.max){if(e.max instanceof Date){if(2===t)throw`Timestamp ctor, max (${e.max}) of type Date, min (${e.min}) of type Timeofday.`;t=1}else if(e.max instanceof Array&&e.max.length<5){if(1===t)throw`Timestamp ctor, max (${e.max}) of type Timeofday, min (${e.min}) of type Date.`;t=2}this.max=e.max}this.formatting=e.formatting;let a=[],r=[],n=[];this.formatting.forEach((e=>{if(z[e]){let t=W[z[e]];a.push(t.regexBit),r.push(t.apply),n.push(t.extract)}else a.push(str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),n.push((()=>str))}));let s=new RegExp(a.join(""));this.format=e=>n.map((t=>t(e))).join(""),this.deformat=e=>{let t=new Date,a=e.match(s);return a?(r.forEach(((e,r)=>e(t,a[i+1]))),t):null}}min=null;max=null;formatting=null;type="none";pattern=null;replacement=null;type="timestamp";toString(){let e="";return e=this.min&&this.max?this.deformat(this.min)+"-"+this.deformat(this.max):this.min||this.max?this.deformat(this.min?this.min:this.max):this.deformat(Date.now()),"{"+e+"}"}format(e){throw"Timestamp format not rewritten."}deformat(e){throw"Timestamp deformat not rewritten."}}class X extends H{constructor(e){super(),this.formatting=e;let t=e.match(/[hmsq]/),a=e.match(/[DMY]/);if(t&&a)this.type="datetime";else if(t)this.type="timeofday";else{if(!a)throw"Invalid format of dummy Timestamp "+e;this.type="date"}}formatting="none";format=e=>e.toString();deformat=e=>R(e,this.formatting);toString=()=>"{"+this.formatting+"}";compatibleTypes=["timeofday","time","date","datetime"]}function Z(e){if(!e||0===e.length)return[];let t=function(e){const t=(t,a)=>{console.warn(`Number Recognizer (CSV line ${t} = ${e[t]}): ${a}`)},a=function({letters:e=!1,punctuations:t=!1,symbols:a=!1,numbers:r=!1,separators:n=!1,rest:s=!1,matchall:i=!0}){let o=[];if(e&&o.push({name:"letters",val:["\\p{L}","\\p{M}"]}),t&&o.push({name:"punctuations",val:["\\p{P}"]}),a&&o.push({name:"symbols",val:["\\p{S}"]}),r&&o.push({name:"numbers",val:["\\p{N}"]}),n&&o.push({name:"separators",val:["\\p{Z}","\\s"]}),s&&o.length>0){let e=["^",...o.map((e=>e.val))].flat();o.push({name:"rest",val:e})}else 0==o.length&&o.push({name:"rest",val:["."]});let l=o.map((e=>{let t=["("];return i&&t.push("?<",e.name,">"),e.val.length>1?t.push("[",...e.val,"]+)"):t.push(e.val[0],"+)"),t.join("")})).join("|");return new RegExp(l,"gus")}({numbers:!0,rest:!0});let r={prefixes:[],suffixes:[],delims:[],validCtr:0,addPrefix:function(e){this.prefixes[e]?this.prefixes[e]+=1:this.prefixes[e]=1},addSuffix:function(e){this.suffixes[e]?this.suffixes[e]+=1:this.suffixes[e]=1},addDelims:function(e,t,a){let r=e+"|"+t+"|"+a;this.delims[r]?this.delims[r]+=1:this.delims[r]=1},addValid:function(){this.validCtr++},addNum:function(e){this.minVal=Math.min(this.minVal,e),this.maxVal=Math.max(this.maxVal,e)}};for(let n=0,s=e.length;n<s;n++){let s=[...e[n].trim().matchAll(a)].map((e=>e.groups));if(s.every((e=>!e.numbers))){t(n,"String contains no digits");continue}s[0].rest&&(r.addPrefix(s[0].rest),s.splice(0,1)),s[s.length-1].rest&&(r.addSuffix(s[s.length-1].rest),s.splice(-1,1));let i=s.filter((e=>e.rest)).map((e=>e.rest));if(console.log(e[n],s,i),0===i.length)r.addValid(),r.addDelims("","","");else if(1===i.length)r.addValid(),r.addDelims("",i[0],""),3===s[2].numbers.length&&r.addDelims(i[0],"","");else{let e=i.reduce(((e,t)=>(e[t]?e[t]+=1:e[t]=1,e)),{}),a=Object.keys(e);if(2!==a.length){t(n,`Too many unique delimiters ${a}`);continue}if(e[a[0]]>1&&e[a[1]]>1){t(n,`No delimiter ${a} recognized as decimal`);continue}if(1===e[a[0]]&&1===e[a[1]]){if(3!==s[2].numbers.length){t(n,`Between delimiters ${a}, there should be 3 digits`);continue}r.addValid(),r.addDelims(s[1].rest,s[3].rest,""),r.addDelims("",s[1].rest,s[3].rest)}else{for(let e=2,a=s.length-2;e<a;e+=2)3===s[e].numbers.length||t(n,`Number sequence ${s[e].numbers} has invalid length`);if(s[0].numbers.length>3){t(n,"First digit sequence is longer than 3");continue}let i,o;if(1===e[a[0]]?(i=a[0],o=a[1]):1===e[a[1]]&&(i=a[1],o=a[0]),s[s.length-2].rest===i)r.addValid(),r.addDelims(o,i);else{if(s[s.length-1].numbers.length>3&&s[s.length-2].rest!==i){t(n,"Last digit sequence is longer than 3 while using mili-delimiter");continue}r.addValid(),r.addDelims(o,i,o)}}}}let n=[];for(let e in r.delims){let t=e.split("|");console.log(t,""===t[1]),n.push(new V({prefix:Object.keys(r.prefixes),suffix:Object.keys(r.suffixes),thousandSeparator:t[0],decimalSeparator:t[1],separateDecimalThousands:""!==t[2],integral:""===t[1]}))}return n}(e.slice(0,5)),a=t.map((()=>0)),r=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];for(let e=0,i=t.length;e<i;e++)if(!t[e].disabled){let i=t[e].deformat(s);i?(a[e]++,t[e].max<i&&(t[e].max=i),t[e].min>i&&(t[e].min=i)):a[e]<.95*(n+1)&&(t[e].disabled=!0,r++)}if(r===t.length)return[]}return t=t.filter((e=>!e.disabled)),t}function Q(e,t){return e.length?e.map(t.deformat):t.deformat(e)}function K(e){if(!e||0===e.length)return[];let t=e.reduce(((e,t)=>(e[t]?e[t]++:e[t]=1,e)),{});return t=function(e){let t=[];for(let a in e)t.push([a,e[a]]);return t}(t),t=t.sort(((e,t)=>e[1]-t[1])),e.length/t.length>.5&&t[0][1]>=2?[new J({domain:t.map((e=>e[0]))})]:t[t.length-1][1]/t[t.length-2][1]>2?[new J({domain:t[t.length-1][0]})]:[]}function ee(e,t,a){switch(t){case"string":return e;case"number":let r=Q(e.replace(/\s/g,""));return isNaN(r)?(console.error("Unparsable number in tryParse - ",e),null):r;case"date":case"datetime":case"timeofday":return R(e,a);default:return console.warn("Unknown type in tryParse - ",t),null}}function te(e){let t=window.app.manager._debugArgs.verbose;t&&console.groupCollapsed(`detemineType(${e.length>0?e[0]+"...":[]})`);let a={},r=K(e);t&&console.log("detemineEnumset = ",r),r.length>0&&1===r[0].domain.length&&(a.noval=r[0].domain[0],EnumUsetypeArgs=[]);let n=Z(e);t&&console.log("recognizeNum = ",n);let s=T(e,a);t&&console.log("timestampUsetypes = ",s),t&&console.groupEnd();let i=[].concat(r,n,s);return 0===i.length?[new q]:i}const ae=function(e,t){re.events=e.prototype.events??{},t.forEach((e=>re.events[e]=[])),Object.assign(e.prototype,re)},re={events:{},addEventListener(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):(console.warn(`${this.constructor.name} added event listener for ${e} despite not being pre-defined.`),this.events[e]=[t])},addEventListeners(e){for(const t in e)this.addEventListener(t,e[t])},on(e,t){return this.addEventListener(e,t),this},triggerEvent(e,...t){if(this.events.hasOwnProperty(e))for(let a of this.events[e])a(...t);else console.warn(`${this.constructor.name} triggered unknown event ${e} with args ${t}`)}};console.log("Loaded SourceData.js");const ne=[",",";","\t"];class se{constructor(e){e.match(/^\s*$/)||this.parseData(e)}static Empty=new se("");_head=[];_data=[];_usetypes=[];get head(){return this._head}header(e){return this._head[e]}get size(){return this._data.length*this._data[0].length??0}get width(){return this._data[0].length??0}get height(){return this._data.length??0}col(e){return this._data.map((t=>t[e]))}cols(...e){let t=this._data.map((t=>t.filter(((t,a)=>e.includes(a)))));return t[0].map(((e,a)=>t.map((e=>e[a]))))}colr(e,t){if(e>t){var a=!0;[e,t]=[t,e]}let r=this._data.map((a=>a.slice(e,t))),n=r[0].map(((e,t)=>r.map((e=>e[t]))));return a?n.reverse():n}row(e){return this._data[e]}rows(...e){return this._data.filter(((t,a)=>e.includes(a)))}rowr(e,t){if(e>t){var a=!0;[e,t]=[t,e]}let r=this._data.slice(e,t);return a?r.reverse():r}usetype(e){return e<0&&(e=this.width-1),this._usetypes.length<this.width&&this.determineUsetypes(),this._usetypes[e]}usetypes(...e){return e=e.map((e=>e<0?this.width-1:e)),this._usetypes.length<this.width&&this.determineUsetypes(),this._usetypes.filter(((t,a)=>e.includes(a)))}usetyper(e=0,t=-1){if(e<0&&(e=this.width-e),t<0&&(t=this.width-t),e>t){var a=!0;[e,t]=[t,e]}this._usetypes.length<this.width&&this.determineUsetypes();let r=this._usetypes.slice(e,t);return a?r.reverse():r}parseData(e){let t=e.trim().split(/\r?\n/);const a=e=>ne.filter((t=>e.replace(/"[^"]"/,"").match(t)));{let e=a(t[0]);if(e||(e=a(t[1])),1!==e.length)throw new Error("Multiple (or no) valid delimiters encountered ("+e+")");var r=e[0]}let n=new RegExp(`(?<=^|,)("[^"]*")|[^${r}]+(?=${r}|$)`,"g");this._head=t[0].match(n).map((e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e));for(let e=1;e<t.length;e++){let a=t[e].match(n).map((e=>e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e));this._data.push(a)}this.triggerEvent(ie.dataParsed,this)}determineUsetypes(){this._usetypes=[];for(let e=0,t=this.width;e<t;e++)this._usetypes[e]=te(this.col(e))}getChartData(e,t,a){console.log("GetChartData ",e,t,a);let r=new google.visualization.DataTable;for(let a=0;a<e.length;a++)r.addColumn(t[a],this._head[e[a]]);for(let n=0;n<this._data.length;n++){let s=[];for(let r=0;r<e.length;r++){let i=ee(this._data[n][e[r]],t[r],a[r]);if(null==i)throw"In column "+this._head[e[r]]+" Could not parse value "+this._data[n][e[r]]+" into type "+t[r]+" using format "+a[r];s.push(i)}r.addRow(s)}return r}getUsetypedData(e){console.log("getUsetypedData ",e);let t=new google.visualization.DataTable;for(let a=0;a<e.length;a++)t.addColumn(this._usetypes[e[a]][0].type,this._head[e[a]]);for(let a=0;a<this._data.length;a++){let r=[];for(let t=0;t<e.length;t++){let n=this._usetypes[e[t]][0].deformat(this._data[a][e[t]]);if(!n&&0!==n)throw"In column "+this._head[e[t]]+" Could not parse value "+this._data[a][e[t]]+" into type "+types[t]+" using format "+formats[t];r.push(n)}t.addRow(r)}return t}}const ie={dataParsed:"onDataParsed"};let oe;ae(se,Object.values(ie)),console.log("Loaded core/Template.");const le={loadChartTemplates(e){if(oe)throw new"Template data already defined.";oe=e},all:()=>oe,charts:()=>oe.ChartTypes,chart:e=>oe.ChartTypes.find((t=>t.name===e)),hasChart:e=>oe.ChartTypes.some((t=>t.name===e)),chartNames:()=>oe.ChartTypes.map((e=>e.name)),chartRole:(e,t)=>oe.ChartTypes.find((t=>t.name===e)).roles.find((e=>e.name===t)),roles:()=>oe.RoleDetails,role:e=>oe.RoleDetails.find((t=>t.name===e)),hasRole:e=>oe.RoleDetails.some((t=>t.name===e)),roleNames:()=>oe.RoleDetails.map((e=>e.name))};console.log("Loaded Role.js");class he{_name;get Name(){return this._name?this._name:"name.unset"}set Name(e){this._name=e}_caption;get Caption(){return this._caption?this._caption:this.Name.replace(/\{1\}/,this.RepeatIndex).trim()}set Caption(e){this._caption=e}_types=[];get Types(){return this._types}set Types(e){this._types=e}_defval;get Defval(){return this._defval}set Defval(e){this._defval=e}_role;get Role(){return this._role}set Role(e){this._role=e}_subroles=[];get Subroles(){return this._subroles}set Subroles(e){this._subroles=e}_optional=!1;get Optional(){return this._optional}set Optional(e){this._optional=e}_disabled=!1;get Disabled(){return this._disabled}set Disabled(e){this._disabled=e}_repeatable=!1;get Repeatable(){return this._repeatable}set Repeatable(e){this._repeatable=e}_copies=[];get Copies(){return this._copies}set Copies(e){this._copies=e}_owner;get Owner(){return this._owner}set Owner(e){this._owner=e}_repeatIndex=1;get RepeatIndex(){return this._repeatIndex}set RepeatIndex(e){this._repeatIndex=e}_column;get Column(){return this._column}set Column(e){let t=this._column;this._column=e,this.triggerHandler("columnChange",t)}_type;get Type(){return this._type}set Type(e){let t=this._type;this._type=e,this.triggerHandler("typeChange",t)}_format;get Format(){return this._format}set Format(e){let t=this._format;this._format=e,this.triggerHandler("formatChange",t)}_chart;get Chart(){return this._chart}set Chart(e){this._chart=e}constructor(e,t){if(this.Chart=t,e.name&&(this.Name=e.name),e.caption&&(this._caption=e.caption),e.types&&(this.Types=e.types,this.Type=this.Types[0]),e.default&&(this.Defval=e.default),e.optional&&(this.Optional=e.optional),e.repeatable&&(this.Repeatable=e.repeatable),e.subrolenames)for(var a of(this.Subroles=[],e.subrolenames))this.Subroles.push(he.createByRole(a,t));this.Column="",this.Format="",t||(console.error("chart not defined for a Role in:"),console.log(this))}static createByRole(e,t){let a=le.role(e);if(!a)return console.log(`Role ${e} not found`),null;var r=new he(a,t);return r.Role=e,r}static createByData(e,t){return e?new he(e,t):(console.log("Invalid data provided for Role factory:"),console.log(e),null)}static createListByMixedContent(e,t){var a=[];for(let r of e)r.role?a.push(he.createByRole(r.role,t)):a.push(he.createByData(r,t));return a}getRepeatCopy(){if(!this.Repeatable)throw"getRepeatCopy called on a non-repeatable chart role. Internal error.";var e=new he(le.chartRole(this.Chart.Name,this.Name),this.Chart);return e.Owner=this,e.RepeatIndex=this.getFreeRepeatIndex(),this.Copies.push(e),e.Optional=!0,e}getFreeRepeatIndex(){let e=1;for(;this.Copies.some((t=>t.RepeatIndex===e));)e++;return e}detach(){if(!this.Owner)throw"Cannot remove a non-repeated role.";this.Owner.Copies=this.Owner.Copies.splice(this.Owner.Copies.indexOf(this)),this.Owner=null}saveConfigData(){return{name:this.Name,owner:this.Owner,column:this.Column,type:this.Type,format:this.Format,disabled:this.Disabled}}loadConfigData(e){if(this.Name!=e.name)throw`Incompatible role config of ${e.name} for role of name ${this.Name}.`;e.column||console.warn(`Unset column for role ${this.Name}.`),this.Column=e.column,e.format||console.warn(`Unset format for role ${this.Name}.`),this.Format=e.format,e.type||console.warn(`Unset type for role ${this.Name}.`),this.Type=e.type,this.Optional||console.warn(`Disabled non-optional role ${this.Name}.`),this.Disabled=e.disabled,e.owner&&(this.Repeatable||console.warn(`Copy of non-repeatable role ${this.Name}.`),this.Owner=e.owner,this.Owner.Copies.push(this),this.RepeatIndex=this.Owner.getFreeRepeatIndex())}handlers(e){this.params||(this.params={});for(let t in e)this.params[t]=e[t]}triggerHandler(e,...t){console.log("Trying to trigger handler for ",e," with params ",t),this.params&&this.params[e]&&this.params[e](...t)}}console.log("Loaded core/Chart.js");class ue{_debugArgs={};constructor(e){this._debugArgs=e}_sourceData;get SourceData(){return this._sourceData&&null!=this._sourceData?this._sourceData:se.Empty}set SourceData(e){let t=this._sourceData;this._sourceData=e,this.triggerEvent(pe.sourceChange,this,t)}_roles=[];get Roles(){return this._roles}set Roles(e){this._roles=e}_chartBoundElement;get ChartBoundElement(){return this._chartBoundElement}set ChartBoundElement(e){let t=this._chartBoundElement;this._chartBoundElement=e,this.triggerEvent(pe.boundElementChange,this,t)}_internalName;get InternalName(){return this._internalName?this._internalName:this._name}set InternalName(e){this._internalName=e}_name;get Name(){return this._name}set Name(e){this._name=e}formattedData;options;loadDataFromUrl(e){return console.log(`loadDataFromUrl(${e})`),fetch(e).then((e=>e.text())).then((e=>{this.SourceData=new se(e)}))}loadDataFromRaw(e){e||console.err("No data provided for new data source."),this.SourceData=new se(e)}setContainer(e){if(e){var t=document.getElementById(e);t&&"DIV"==t.tagName.toUpperCase()?this.ChartBoundElement=t:console.error(`Element of id ${e} doesn't exist or is not a div. No change...`)}else console.error("No element id provided. No change...")}setType(e){if(!le.hasChart(e))throw"Please provide a valid chart type name from getChartTypes. Aborting operation...";{let t=le.chart(e),a=this.Name;this.Name=e,this.InternalName=t["internal-name"],this.Roles=he.createListByMixedContent(t.roles,this),this.triggerEvent(pe.typeChange,this,a)}}draw(e=!0){if(this.SourceData){if(google.visualization[this.InternalName]){var t=new google.visualization.DataTable,a=[],r=[],n=[];for(let s of this.Roles){if(!s.Column){if(s.Optional){e&&console.warn(`Undefined optional role ${s.Name}, skipping.`);continue}if(e)throw new Error(`Role ${s.Name} has no column selected despite being mandatory.`);return}if(!this.SourceData.head.includes(s.Column)){if(e)throw new Error(`Role ${s.Name} has invalid selected column ${s.Column}. Internal error.`);return}if(s.Optional){if(s.Disabled)continue;t.addColumn({type:s.Type,role:s.Role})}else t.addColumn(s.Type,s.Name);a.push(this.SourceData.head.indexOf(s.Column)),r.push(s.Type),n.push(s.Format);for(let i of s.Subroles)i.Column&&(this.SourceData.head.includes(i.Column)||e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`),i.Disabled||(t.addColumn({type:i.Type,role:i.Role}),a.push(this.SourceData.head.indexOf(i.Column)),r.push(i.Type),n.push(i.Format)));if(s.Repeatable)for(let i of s.Copies)if(i.Column)if(this.SourceData.head.includes(i.Column)){if(s.Optional){if(s.Disabled)continue;t.addColumn({type:i.Type,role:i.Role})}else t.addColumn(i.Type,i.Name);a.push(this.SourceData.head.indexOf(i.column)),r.push(i.Type),n.push(i.Format);for(let i of s.Subroles)i.Column&&(this.SourceData.head.includes(i.Column)||e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`),t.addColumn({type:i.Type,role:i.Role}),a.push(this.SourceData.head.indexOf(i.Column)),r.push(i.Type),n.push(i.Format))}else e&&console.warn(`Role ${i.Name} has invalid selected column ${i.Column}, skipping.`)}var s=this.SourceData.getChartData(a,r,n),i=new google.visualization[this.InternalName](this.ChartBoundElement);console.log("Formatted data: ",s),this.formattedData=s,i.draw(s,this.options)}else if(e)throw new Error(`Invalid chart type ${this.Name}. Internal error.`)}else if(e)throw new Error("No source data set, can't draw chart.")}redraw(){this.formattedData&&new google.visualization[this.InternalName](this.ChartBoundElement).draw(this.formattedData,this.options)}saveConfigData(){let e={Name:this.Name,Roles:[]};for(let t of this.Roles)e.Roles.push(t.saveConfigData());return e}loadConfigData(e){this.setType(e.Name);for(let t of e.Roles)this.Roles.find((e=>e.Name==t.name)).loadConfigData(t)}}const pe={sourceChange:"dataChanged",boundElementChange:"boundElementChanged",typeChange:"chartTypeChanged"};function de(e){fetch("/src/json/graph_types.json").then((e=>e.json())).then((t=>{le.loadChartTemplates(t),e.onChartTemplatesLoaded&&e.onChartTemplatesLoaded()})).catch((e=>console.error(e))),google.charts.load("current",{packages:["corechart","annotationchart","calendar","sankey","timeline","treemap","wordtree"]}),e.onGoogleChartsLoaded&&google.charts.setOnLoadCallback(e.onGoogleChartsLoaded)}function me(e){const t={getColumnSelector(e="Select Column"){let t=this,a=$("<option></option>").prop("disabled",!0).prop("selected",!0).prop("value",null).text(e),r=$("<select></select>").append(a).fillWithOptions(t.Chart.SourceData.head).on("change",(function(e){t.Column=e.target.value}));return t.handlers({columnChange:()=>r.prop("value",t.Column)}),t.Chart.handlers({sourceChange:()=>{console.log("abrakadabra"),r.empty().append(a).fillWithOptions(t.Chart.SourceData.head)}}),r},getTypeSelector(){let e=this,t=$("<select></select>").prop("disabled",!(e.Types.length>1)).fillWithOptions(e.Types).on("change",(function(t){e.Type=t.target.value}));return e.handlers({typeChange:()=>t.prop("value",e.Type)}),e.Chart.handlers({sourceChange:()=>t.empty().fillWithOptions(e.Types)}),t},getFormatInput(e="Data Format Here"){let t=this,a=$("<input></input>").prop("placeholder",e).on("change",(function(e){t.Format=e.target.value}));return t.handlers({formatChange:()=>{a.prop("value",t.Format)}}),t.Chart.handlers({sourceChange:()=>{a.prop("value","")}}),a},getRepeatButton(e){if(!this.Repeatable)throw"Role.prototype.getRepeatButton called on a non-repeatable chart role.";let t=this,a=$("<button></button>").text("+").on("click",(function(a){e(t.getRepeatCopy())}));return t.handlers({copy:t=>e(t)}),a},getCopyDeleteButton(e){if(!this.Owner)throw"Role.prototype.getCopyDeleteButton called on a non-copied chart role.";let t=this,a=$("<button></button>").text("-").on("click",(function(a){e&&e(t),t.detach()}));return t.handlers({remove:()=>e()}),a}};Object.assign(he.prototype,t),e.onUiGenLoaded&&e.onUiGenLoaded()}ae(ue,Object.values(pe)),console.log("Loaded core/Main.js"),console.log("Loaded uigen.js"),jQuery.fn.extend({fillWithOptions:function(e,t=!1){return t&&this.empty(),$.each(e,((e,t)=>this.append($("<option></option>").prop("value",t).text(t)))),this}}),window.debug={core:{chart:d,main:m,role:p,sourcedata:h,template:u},parse:{enum:s,experiment:c,main:o,num:n,timestamp:a,usetype:r},uigen:{main:g},utils:{events:l,logic:t}}})();