(()=>{"use strict";const e={events:{},addEventListener(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):(console.warn(`${this.constructor.name} added event listener for ${e} despite not being pre-defined.`),this.events[e]=[t])},addEventListeners(e){for(const t in e)this.addEventListener(t,e[t])},on(e,t){return this.addEventListener(e,t),this},triggerEvent(e,...t){if(this.events.hasOwnProperty(e))for(let n of this.events[e])n(...t);else console.warn(`${this.constructor.name} triggered unknown event ${e} with args ${t}`)}};class t{constructor(e){if(this.constructor===t)throw new Error("Cannot instantiate base Usetype class.");e.hasNoval&&(this.hasNoval=!0,this.novalVal=e.novalVal),e.isConstant&&(this.isConstant=e.isConstant,this.constantVal=e.constantVal),e.potentialIds&&(this.potentialIds=!0),e.ambiguousSets&&(this.ambiguousSets=e.ambiguousSets)}format(e){throw new Error("Abstract baseclass Usetype.format() called.")}deformat(e){throw new Error("Abstract base class Usetype.deformat() called.")}toString(){return"U{undefined}"}toFormatString(){return""}toDebugString(){return"Usetype::Base()"}isSubsetOf(e){throw new Error("Abstract base class Usetype.isSubsetOf() called.")}isSupersetOf(e){throw new Error("Abstract base class Usetype.isSupersetOf() called.")}isEqualTo(e){throw new Error("Abstract base class Usetype.isEqualTo() called.")}isSimilarTo(e){throw new Error("Abstract base class Usetype.isSimilarTo() called.")}compatibleTypes=[];type="undefined";domainType="none";priority=-1}const n={countries:{url:"https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-abbreviation.json",extract:e=>{n.countries.names=e.map((e=>e.country)),n.countries.codes=e.map((e=>e.abbreviation))}},currencies:{url:"https://gist.githubusercontent.com/Fluidbyte/2973986/raw/8bb35718d0c90fdacb388961c98b8d56abc392c9/Common-Currency.json",extract:e=>{let t=Object.keys(e);n.currencies.codes=t,n.currencies.symbols=t.map((t=>e[t].symbol)),n.currencies.nativeSymbols=t.map((t=>e[t].symbol_native))}},cities:{url:"https://raw.githubusercontent.com/lutangar/cities.json/master/cities.json",extract:e=>{n.cities.names=e.map((e=>e.name)),n.cities.codes=e.map((e=>e.country))}}};let i=!1;!function(){if(!i){for(let e in n){let t;fetch(n[e].url).then((e=>e.json())).then((t=>n[e].extract(t))).catch((n=>(console.error("parse.constants.js fetch item",e,"failed with err",n),t.text())))}i=!0}}();const r=function(){let e=n.currencies;return e&&e.symbols?e.symbols:[]},s=function(){let e=n.currencies;return e&&e.abbreviations?e.abbreviations:[]},a=function(e){return["yotta","zetta","exa","peta","tera","giga","mega","kilo","hecto","deca","","deci","centi","milli","micro","nano","pico","femto","atto","zepto","yocto"]},o=function(e){return["Y","Z","E","P","T","G","M","k","h","da","","d","c","m","μ","n","p","f","a","z","y"]},l=function(e){return["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td"]};function u(e){return new Set(e).size!==e.length}function c(e,t){return e.every((e=>t.includes(e)))}function h(e,t){return e.filter((e=>t.includes(e)))}function d(e,t,n=!1,i=!1){let r=e.map((e=>[e,t])).flat(1);return n&&r.splice(0,0,t),i||r.splice(-1,1),r}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let m=(window.verbose??{}).number;if(console.log("parse.num.js verbosity = ",m),m)var f=window.console;else f={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>f[e]=window.console[e]));function g(e,t){const n=(t,n)=>{f.warn(`Number Recognizer (CSV line ${t} = ${e[t]}): ${n}`)},i=[".",","," "," "],r=[".",","],s=(a=i.concat(r),[...new Set(a)]);var a;const o=new RegExp("^["+s.join("")+"\\d]+$");let l=[],u=[],c=!1,h=!1,d=!1,p=!1,m=!1,g=[];for(let t=0,a=e.length;t<a;t++){let a=e[t],f="",S=a.match(/^[^0-9]*[^0-9+-]/);S&&(f=S[0],a=a.replace(S[0],""));let x="",w=a.match(/[^.0-9][^0-9]*$/);w&&(x=w[0],a=a.replace(w[0],""));let T=!1,v=a.match(/e[0-9]+$/);v&&(T=!0,a=a.replace(v[0],""));let _=!1,O=!1,M=a.match(/^[-+]/);if(M&&("+"===M[0]&&(O=!0),_=!0,a=a.replace(M[0],"")),!a.match(o)){n(t,`Stripped sample ${a} not in pure numeric form .`),window.purePat=o;continue}let D=i.filter((e=>a.includes(e))),k=r.filter((e=>a.includes(e))),E=[],Y=s.filter((e=>a.includes(e)));if(0!==a.length){if(0===Y.length)E.push(["",""]);else if(1===Y.length){let e=Y[0];y(a,e)&&E.push([e,""]),b(a,e)&&E.push(["",e])}else{let e=!1;for(let t of D)for(let n of k){if(t===n)continue;if(!y(a,t))continue;if(!b(a,n))continue;let i=a.split(t).join("").split(n).join(".");isNaN(parseFloat(i))||(E.push([t,n]),console.error("ALSEP",[t,n]),e=!0)}if(!e){n(t,`Failed to parse ${a} using parseFloat with any combination of separators.`);continue}}f&&l.push(f),x&&u.push(x),c&=_,h&=O,d=!1,p=!1,m&=T,g=g.concat(E)}else n(t,`Sample ${e[t]} empty after stripping process.`)}let x=[];for(let e of g){let n=new S({prefixes:l,suffixes:u,separators:e,integral:!e[1],scientific:m,explicitSign:h},t);x.push(n)}let w=!0;for(;w;){w=!1;for(let e=0;e<x.length;e++){for(let t=0;t<x.length&&(e===t||(x[e].isEqualTo(x[t])||x[e].isSupersetOf(x[t])?(x.splice(t),w=!0):x[t].isSupersetOf(x[e])&&(x.splice(e),w=!0),!w));t++);if(w)break}}return x}function y(e,t){let n=e.split(t);return!(n[0].length>3)&&(3===n[n.length-1].length||!n[n.length-1].match(/^[0-9]+$/))&&n.slice(1,-1).every((e=>3===e.length||e.match(/\D/)))}function b(e,t){let n=e.match(new RegExp(p(t),"g"));return n&&1===n.length}class S extends t{constructor({separators:e=[],prefixes:t=[],suffixes:n=[],scientific:i=!1,strictlyPositive:r=!1,explicitSign:s=!1},a){super(a),e.length>0&&""!==e[0]&&(this.thousandSeparator=e[0]),e.length>1&&""!==e[1]?this.decimalSeparator=e[1]:this.integral=!0,e.length>2&&e[2]===e[0]&&(this.separateDecimalThousands=!0),i&&(this.scientific=!0),r&&(this.strictlyPositive=!0),s&&(this.explicit=!0),this.prefixes=t;let o=x(this.prefixes);"unknown"!==o.type&&(this.prefixes=o.domain,this.prefixPlaceholder=o.type),this.suffixes=n;let l=x(this.suffixes);"unknown"!==l.type&&(this.suffixes=l.domain,this.suffixPlaceholder=l.type)}prefixes=[];suffixes=[];decimalSeparator="";thousandSeparator="";separateDecimalThousands=!1;scientific=!1;explicit=!1;format(e){function t(e,t,n){return(n?e.match(/.{1,3}/g):e.match(/.{1,3}(?=(.{3})*$)/g)).join(t)}let n=this.prefixPlaceholder??this.prefixes,i=this.suffixPlaceholder??this.suffixes;if(this.scientific){let t=e.toFixed(1).indexOf(".")-1;e/=10**t,suffix="e"+t+suffix}this.explicit&&e>=0&&(prefix+="+");var r=(this.decimalPlaces?e.toFixed(this.decimalPlaces):e.toString()).split("."),s=r[0];if(this.integerPlaces>0&&r[0].length<this.integerPlaces&&(s="0".repeat(this.integerPlaces-s.length)+s),s=t(r[0],this.thousandSeparator,!1),this.integral)return n+s+i;var a="0";return r.length>1&&(a=r[1]),this.decimalPlaces>0&&r[1].length<this.decimalPlaces&&(a+="0".repeat(this.decimalPlaces-a.length)),this.separateDecimalThousands&&(a=t(r[1],this.thousandSeparator,!0)),n+s+this.decimalSeparator+a+i}deformat(e){let t=e;return this.prefixes.forEach((e=>t.startsWith(e)&&(t=t.slice(e.length)))),this.suffixes.forEach((e=>t.endsWith(e)&&(t=t.slice(0,t.length-e.length)))),this.decimalSeparator&&(t=t.split(this.decimalSeparator).join(".")),this.thousandSeparator&&(t=t.split(this.thousandSeparator).join("")),isNaN(t)?null:+t}isSupersetOf(e){if(!e.prefixes.every((e=>this.prefixes.includes(e)))){let t=e.prefixes.filter((e=>!this.prefixes.includes(e)));return f.warn("isSupersetOf() incompatible prefix sets",this.prefixes,e.prefixes," -> ",t),!1}if(!e.suffixes.every((e=>this.suffixes.includes(e)))){let t=e.suffixes.filter((e=>!this.suffixes.includes(e)));return f.warn("isSupersetOf() incompatible suffix sets",this.suffixes,e.suffixes," -> ",t),!1}return e.decimalSeparator&&this.decimalSeparator!==e.decimalSeparator?(f.warn("isSupersetOf() incompatible decimal separators ",this.decimalSeparator,e.decimalSeparator),!1):!e.thousandSeparator||this.thousandSeparator===e.thousandSeparator||(f.warn("isSupersetOf() incompatible thousand separators ",this.thousandSeparator,e.thousandSeparator),!1)}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSupersetOf(e)&&e.isSupersetOf(this)}isSimilarTo(e){return this.isSupersetOf(e)||this.isSubsetOf(e)}toString(){return this.min&&this.max?"N{"+this.format(this.min)+"-"+this.format(this.max)+"}":this.min?"N{"+this.format(this.min)+"}":this.max?"N{"+this.format(this.max)+"}":"N{"+this.format(1234567.654321)+"}"}toFormatString(){return""}toDebugString(){return"Usetype::Number()"}compatibleTypes=[];compatibleTypes=["number"];type="number";domainType="ordinal";priority=2}function x(e){let t=s();if(!e||!(e instanceof Array)||0===e.length||e.every((e=>e.match(/^\s*$/))))return{type:"unknown",format:"unknown",domain:[]};if(e.every((e=>t.includes(e))))return{type:"currency",format:"code",domain:[...t]};let n=r();if(e.every((e=>n.includes(e))))return{type:"currency",format:"symbol",domain:[...n]};let i=o(),u=l(),c=[].concat(i,u);if(e.every((e=>c.includes(e))))return{type:"magnitude",format:"symbol",domain:[...c]};let h=a();return e.every((e=>h.includes(e)))?{type:"magnitude",format:"prefix",domain:[...h]}:{type:"unknown",format:"unknown",domain:[]}}const w={not:e=>(...t)=>!e(...t),both:(e,t)=>(...n)=>e(...n)&&t(...n),either:(e,t)=>(...n)=>e(...n)||t(...n),imply:(e,t)=>(...n)=>!e(...n)||t(...n),implied:(e,t)=>(...n)=>e(...n)||!t(...n)},T=(e,t)=>(...n)=>e(...n)===t(...n);w.equal=T;const v=(...e)=>(...t)=>e.every((e=>e(...t)));w.all=v;const _=(...e)=>(...t)=>e.some((e=>e(...t)));w.any=_;w.none=(...e)=>!_(...e),w.notAll=(...e)=>!v(...e),w.equal=T;let O=(window.verbose??{}).time;if(console.log("parse.timestamp.js verbosity = ",O),O)var M=window.console;else M={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>M[e]=window.console[e]));function D(e,t){for(let n=0;n<e.length;n++){for(let i of t)null===i.deformat(e[n])&&(i.disabled=!0);let i=t.filter((e=>!e.disabled));if(0===i.length)return M.log("Batch of usetypes nulled during ",e[n],t),[];t=i}return t}function k(e){for(let t=0;t<e.length;t++){let n=[];for(let i=t+1;i<e.length;i++)e[t].isSupersetOf(e[i])&&n.push(i);e=e.filter(((e,t)=>!n.includes(t)))}return e}var E;const Y=["January","February","March","April","May","June","July","August","September","October","November","December"],A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],I=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function F(e){return function(e){if(u(e.filter((e=>Object.values(B).some((t=>t.label===e))))))return!1;let t=e.map((e=>P[e]));return t=t.filter((e=>e)),!u(t.map((e=>B[e].category)))&&!!function(e){function t(...e){return function(t){return e.every((e=>t.some((t=>U(t).category===e))))}}function n(...e){return function(t){let n=t.map((e=>U(e).category));return e.map((e=>n.indexOf(e))).map(((e,t,n)=>t===n.length-1||e<n[t+1])).reduce(((e,t)=>e&&t),!0)}}function i(e,i){return e instanceof Array&&i instanceof Array?function(t){let n=t.map((e=>U(e).category)).filter((e=>e)),r=e.map((e=>n.indexOf(e))).filter((e=>e>=0)),s=i.map((e=>n.indexOf(e))).filter((e=>e>=0));return Math.max(...r)<Math.min(...s)}:w.imply(t(e,i),n(e,i))}e[0]===B.monthShort.label&&e[2]===B.dayShort.label&&(e[4],B.yearFull.label);const r=w.all(w.imply(t(N.Milliseconds),t(N.Seconds)),w.imply(t(N.Meridiem),t(N.Hours)),w.imply(t(N.Era),t(N.Years))),s=w.all(i(N.Hours,N.Minutes),i(N.Minutes,N.Seconds),i(N.Seconds,N.Milliseconds),i(N.Hours,N.Meridiem),i(N.Years,N.Era),i([N.Years,N.Months,N.Days,N.Era,N.DayOfWeek],[N.Hours,N.Minutes,N.Seconds,N.Milliseconds,N.Meridiem]),w.imply(t(N.Years,N.Months,N.Days),w.any(n(N.Years,N.Months,N.Days),n(N.Days,N.Months,N.Years),n(N.Months,N.Days,N.Years))));return(e=>{let n=[N.Years,N.Months,N.Days,N.Hours,N.Minutes,N.Seconds,N.Milliseconds].map((n=>t(n)(e))),i=n.indexOf(!0),r=n.lastIndexOf(!0);return n.slice(i,r).reduce(((e,t)=>e&&t),!0)})(e)&&r(e)&&s(e)&&(e=>{C.NumericLong,C.NumericMedium,C.NumericShort;const t=e=>{let t=U(e);return t.literal?/^[0-9]/.test(e):t.numeric},n=e=>{let t=U(e);return t.literal?/[0-9]$/.test(e):t.numeric};for(let i=0;i<e.length-1;i++)if(n(e[i])&&t(e[i+1]))return!1;return!0})(e)}(e)}(e.formatting)&&"unknown"!==e.type}const N={Years:1,Months:2,Days:3,Hours:4,Minutes:5,Seconds:6,Milliseconds:7,Era:8,Meridiem:9,DayOfWeek:10},C={NumericShort:0,NumericMedium:1,NumericLong:2,WordShort:3,WordLong:4},B={era:{label:"{EE}",regexBit:"(AD|BC)",category:N.Era,numeric:!1,apply:(e,t)=>e.getFullYear()>0&&"BC"===t&&e.setFullYear(-e.getFullYear()),applyTod:(e,t)=>M.warn("ApplyTOD era called, undefined behaviour"),extract:e=>e.getFullYear()>=0?"AD":"BC",extractTod:e=>M.warn("ExtractTOD era called, undefined behaviour")},yearFull:{label:"{YYYY}",regexBit:"([12][0-9]{3,})",category:N.Years,numeric:!0,subtoken:"yearShort",apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>M.warn("ApplyTOD yearFull called, undefined behaviour"),extract:e=>e.getFullYear().toString().padStart(4,"0"),extractTod:e=>M.warn("ExtractTOD yearFull called, undefined behaviour")},yearShort:{label:"{YY}",regexBit:"([0-9]{2})",category:N.Years,numeric:!0,apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>M.warn("ApplyTOD yearShort called, undefined behaviour"),extract:e=>e.getFullYear().toString(),extractTod:e=>M.warn("ExtractTOD yearShort called, undefined behaviour")},monthFull:{label:"{MM}",regexBit:"(0\\d|1[012])",category:N.Months,numeric:!0,subtoken:"monthShort",apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>M.warn("ApplyTOD monthFull called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString().padStart(2,"0"),extractTod:e=>M.warn("ExtractTOD monthFull called, undefined behaviour")},monthShort:{label:"{M}",regexBit:"(0?\\d|1[012])",category:N.Months,numeric:!0,apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>M.warn("ApplyTOD monthShort called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString(),extractTod:e=>M.warn("ExtractTOD monthShort called, undefined behaviour")},monthName:{label:"{MMMM}",regexBit:"("+Y.map((e=>"(?:"+e+")")).join("|")+")",category:N.Months,numeric:!1,subtoken:"monthAbbrev",apply:(e,t)=>e.setMonth(Y.indexOf(t)),applyTod:(e,t)=>M.warn("ApplyTOD monthName called, undefined behaviour"),extract:e=>Y[e.getMonth()],extractTod:e=>M.warn("ExtractTOD monthName called, undefined behaviour")},monthAbbrev:{label:"{MMM}",regexBit:"("+A.map((e=>"(?:"+e+")")).join("|")+")",category:N.Months,numeric:!1,apply:(e,t)=>e.setMonth(A.indexOf(t)),applyTod:(e,t)=>M.warn("ApplyTOD monthAbbrev called, undefined behaviour"),extract:e=>A[e.getMonth()],extractTod:e=>M.warn("ExtractTOD monthAbbrev called, undefined behaviour")},dayFull:{label:"{DD}",regexBit:"(0[1-9]|[12]\\d|3[01])",category:N.Days,numeric:!0,subtoken:"dayShort",apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>M.warn("ApplyTOD dayFull called, undefined behaviour"),extract:e=>e.getDate().toString().padStart(2,"0"),extractTod:e=>M.warn("ExtractTOD dayFull called, undefined behaviour")},dayShort:{label:"{D}",regexBit:"(0?[1-9]|[12]\\d|3[01])",category:N.Days,numeric:!0,apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>M.warn("ApplyTOD dayShort called, undefined behaviour"),extract:e=>e.getDate().toString(),extractTod:e=>M.warn("ExtractTOD dayShort called, undefined behaviour")},dayOfWeekFull:{label:"{DDDD}",category:N.DayOfWeek,numeric:!1,subtoken:"dayOfWeekShort",regexBit:"("+I.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>M.warn("Apply dayOfWeekFull called, undefined behaviour"),applyTod:(e,t)=>M.warn("ApplyTOD dayOfWeekFull called, undefined behaviour"),extract:e=>I[e.getDay()],extractTod:e=>M.warn("ExtractTOD dayOfWeekFull called, undefined behaviour")},dayOfWeekShort:{label:"{DDD}",category:N.DayOfWeek,numeric:!1,regexBit:"("+j.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>M.warn("Apply dayOfWeekShort called, undefined behaviour"),applyTod:(e,t)=>M.warn("ApplyTOD dayOfWeekShort called, undefined behaviour"),extract:e=>j[e.getDay()],extractTod:e=>M.warn("ExtractTOD dayOfWeekShort called, undefined behaviour")},meridiem:{label:"{RR}",regexBit:"(AM|PM)",category:N.Meridiem,numeric:!1,apply:(e,t)=>{let n=e.getHours();"PM"===t&&n<12?e.setHours(n+12):"AM"===t&&12===n&&cate.setHours(0)},applyTod:(e,t)=>M.warn("ApplyTOD meridiem called, undefined behaviour"),extract:e=>e.getHours()<12||0===e.getHours()?"AM":"PM",extractTod:e=>e[0]<12||0===e[0]?"AM":"PM"},hourFull:{label:"{hh}",regexBit:"([01]\\d|2[0-3])",category:N.Hours,numeric:!0,subtoken:"hourShort",apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(B.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(B.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")}},hourShort:{label:"{h}",regexBit:"([01]?\\d|2[0-3])",category:N.Hours,numeric:!0,apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(B.meridiem.label)&&(n%=12),n.toString()},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(B.meridiem.label)&&(n%=12),n.toString()}},minuteFull:{label:"{mm}",regexBit:"([0-5]\\d)",category:N.Minutes,numeric:!0,subtoken:"minuteShort",apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString().padStart(2,"0"),extractTod:e=>e[1].toString().padStart(2,"0")},minuteShort:{label:"{m}",regexBit:"([0-5]?\\d)",category:N.Minutes,numeric:!0,apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString(),extractTod:e=>e[1].toString()},secondFull:{label:"{ss}",regexBit:"([0-5]\\d)",category:N.Seconds,numeric:!0,subtoken:"secondShort",apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString().padStart(2,"0"),extractTod:e=>e[2].toString().padStart(2,"0")},secondShort:{label:"{s}",regexBit:"([0-5]?\\d)",category:N.Seconds,numeric:!0,apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString(),extractTod:e=>e[2].toString()},millisecondFull:{label:"{nnn}",regexBit:"(\\d{3})",category:N.Milliseconds,numeric:!0,subtoken:"millisecondShort",apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString().padStart(3,"0"),extractTod:e=>e[3].toString().padStart(3,"0")},millisecondShort:{label:"{n}",regexBit:"(\\d{,3})",category:N.Milliseconds,numeric:!0,apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString(),extractTod:e=>e[3].toString()}};function U(e){return function(e){return B[e]}(function(e){return P[e]}(e))||{literal:!0}}delete B.yearShort,delete B.millisecondShort;const P=(()=>{let e={};for(let t in B)e[B[t].label]=t;return e})();function V(){return new Date(2e3,3,21,15,20,25,30)}class z extends t{constructor(e,t){super(t);let n=e.type;n||(n="none");let i="none";e.min&&(this.min=e.min,i=isValidDate(e.min)?"datetime":isValidTimeOfDay(e.min)?"timeofday":"unknown");let r="none";e.max&&(this.max=e.max,r=isValidDate(e.max)?"datetime":isValidTimeOfDay(e.max)?"timeofday":"unknown");let s=[i,r,n,function(e){let t=e.map((e=>P[e]));t=t.filter((e=>e));let n=t.map((e=>B[e].category));const i=[N.Hours,N.Minutes,N.Seconds,N.Milliseconds],r=[N.Years,N.Months,N.Days,N.Era];let s=!1;n.some((e=>r.includes(e)))&&(s=!0);let a=!1;return n.some((e=>i.includes(e)))&&(a=!0),a&&s?"datetime":a?"timeofday":s?"date":"unknown"}(e.formatting)];if(s=s.filter((e=>"none"!==e)),s.every((e=>e===s[0]))||(this.timestampType="unknown"),this.timestampType=s[0],this.formatting=[...e.formatting],!e.skipValidation&&!F(this))return void(this.timestampType="unknown");let a=[],o=[],l=[],u=[],c=[],h="apply",d="extract";"timeofday"===this.timestampType&&(h="applyTod",d="extractTod"),this.formatting.forEach((e=>{if(void 0!==P[e]){let t=U(e);a.push(t.regexBit),o.push(t[h]),l.push(t[d]),u.push(H(e,t[h])),c.push(H(e,t[d]))}else a.push(p(e)),l.push((()=>e))}));let m=new RegExp(a.join(""));this._extractors=l,this._pattern=m,this._appliers=o,this._verboseAppliers=u,this._verboseExtractors=c}min=null;max=null;formatting=null;timestampType="none";pattern=null;replacement=null;type="timestamp";domainType="ordinal";priority=3;toString(){let e="";var t;this.min&&this.max?e=this.format(this.min)+"-"+this.format(this.max):this.min||this.max?e=this.format(this.min?this.min:this.max):"datetime"===this.timestampType||"date"===this.timestampType?e=this.format(V()):"timeofday"===this.timestampType&&(e=this.format([(t=V()).getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]));let n="X";return"date"===this.timestampType?n="D":"datetime"===this.timestampType?n="DT":"timeofday"===this.timestampType&&(n="TOD"),n+"{"+e+"}"}format(e,t=!1){return t?this._verboseExtractors.map((t=>t(e,this.formatting))).join(""):this._extractors.map((t=>t(e,this.formatting))).join("")}deformat(e,t=!1){let n=null;if("timeofday"===this.timestampType)n=[15,20,25,30];else{if(!["time","date","datetime"].includes(this.timestampType))return t&&M.warn("Timestamp ",this.formatting," deformat(",e,") failed due to invalid type."),n;n=V()}let i=e.match(this._pattern);return i?(t?this._verboseAppliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))):this._appliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))),e!==this.format(n,t)?(t&&M.warn("Timestamp ",this.formatting," deformat(",e,") = ",n," vs consistency check ",this.format(n)),null):n):(t&&M.warn("Timestamp ",this.formatting," deformat(",e,") failed to match to pattern"),null)}isSupersetOf(e){if(this.formatting.length!==e.formatting.length)return!1;for(let t=0,n=this.formatting.length;t<n;t++){let n=U(this.formatting[t]),i=B[n.subtoken],r=U(e.formatting[t]);if(n.literal){if(!r.literal)return!1;if(this.formatting[t]!==e.formatting[t])return!1}else if(r!==n&&r!==i)return!1}return!0}isImplicitSupersetOf(e){}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}static fromShortFormatting(e){let t=[];for(let e in B)t.push(B[e].label.slice(1,-1));let n=e,i=[];for(;n.length>0;){let e=t.filter((e=>n.startsWith(e)));if(e.length>0){let t=e.reduce(((e,t)=>e.length<t.length?t:e),"");i.push("{"+t+"}"),n=n.slice(t.length)}else i.push(n[0]),n=n.slice(1)}return i[0]=[i[0]],i=i.reduce(((e,t)=>e[e.length-1].endsWith("}")||t.startsWith("{")?(e.push(t),e):(e[e.length-1]=e[e.length-1]+t,e))),new z({formatting:i})}}function H(e,t){return function(n,i){M.log("Function ",e,"(",n,i,") => ");let r=t(n,i);return M.log(n),r}}let $=(window.verbose??{}).enum;if(console.log("parse.enum.js verbosity = ",$),$)var W=window.console;else W={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>W[e]=window.console[e]));class R extends t{domain=[];constructor({domain:e=[]},t){super(t),e&&(this.domain=e)}format(e){return this.domain.includes(e)?e:void 0}deformat(e){return this.domain.includes(e)?e:void 0}isSubsetOf(e){return this.domain.every((t=>e.domain.includes(t)))}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}size(){return this.domain.length}toString(){return`E{[${this.domain}]}`}toDebugString(){return`Usetype.Enum([${this.domain}])`}compatibleTypes=["string"];type="string";domainType="nominal";priority=1}let L=(window.verbose??{}).string;if(console.log("parse.string.js verbosity = ",L),L)var q=window.console;else q={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>q[e]=window.console[e]));class J extends t{constructor(e){super(e),e.potentialIds&&(this.unique=!0),e.constant&&(this.constant=!0,this.constantValue=e.constant),e.type&&(this.kind=e.type)}format(e){return e.toString()}deformat(e){return e.toString()}isSubsetOf(e){return e.type===this.type||this.type&&!e.type}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}toString(){return this.unique?"SID{"+(this.type??"")+"}":this.constant?"SC("+this.constantValue+"){"+(this.type??"")+"}":"S{"+(this.kind??"")+"}"}compatibleTypes=["string"];type="string";domainType="nominal";priority=0}let K=(window.verbose??{}).parser;if(console.log("parse.main.js verbosity = ",K),K)var G=window.console;else G={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>G[e]=window.console[e]));const Q={skipConstants:!1};function X(e,t){t||(t=Object.assign({},Q)),G.groupCollapsed(`detemineType(${e.length>0?e[0]+"...":[]})`),G.log("args = ",t);let n,i=[];if([e,n,t]=function(e,t){let n=function(e){if(!e||0===e.length)return[];let t={};for(let n in e)t[e[n]]||(t[e[n]]=[]),t[e[n]].push(n);let n=[];for(let e in t)n.push([e,t[e].length]);if(n=n.sort(((e,t)=>e[1]-t[1])),1===n.length)return[{isConstant:!0,constantVal:n[0][0]}];if(n.length===e.length)return[{potentialIds:!0,ambiguousSets:[]}];let i=[];for(let e in t)t[e].length>1&&i.push(t[e]);return e.length/n.length>.5&&n[0][1]>=2&&n.length>2?[new R({domain:n.map((e=>e[0]))},{ambiguousSets:i})]:n[n.length-1][1]/n[n.length-2][1]>2&&n[n.length-2][1]>0?[{hasNoval:!0,novalVal:n[n.length-1][0],ambiguousSets:i}]:[{ambiguousSets:i}]}(e);console.log("preprocessEnumlikeness",n);let i=n[0];return i?i.hasNoval?(G.log("NOVAL detected as ",i.noval),t.hasNoval=!0,t.novalValue=i.novalVal,t.ambiguousSets=i.ambiguousSets,e=e.filter((e=>e!==t.noval)),n=[]):i.isConstant?(G.log("CONSTANT detected as ",i.constant),t.isConstant=!0,t.constantVal=i.constantVal,e=[e[0]],n=[]):i.potentialIds?(G.log("POTENTIAL ID column found"),t.potentialIds=!0,n=[]):i.ambiguousSets?(t.ambiguousSets=i.ambiguousSets,n=[]):(G.log("Enum usetype detected as ",i),t.ambiguousSets=i.ambiguousSets):n=[],console.log("args after enum ",t),[e,n,t]}(e,t),i.push(...n),!t.skipConstants||!t.isConstant){let n=performance.now(),r=function(e,t){if(!e||0===e.length)return[];let n=[];n=[...e].sort().slice(0,5),f.log("recognizeNum -- initial batch = ",n);let i=g(n,t);f.log("extractedNumUsetypes",i);let r=i.map((()=>0));for(let n=0,s=e.length;n<s;n++){let s,a=e[n];for(let e=0,n=i.length;e<n;e++)if(!i[e].disabled){let n=i[e].deformat(a);if(n)r[e]++,i[e].max<n&&(i[e].max=n),i[e].min>n&&(i[e].min=n);else{f.log("Matching",i[e],"against",a,"failed, disabling potential format."),f.log("Trying to recover expanded number usetype..."),s?f.log("Using pre-extracted potential usetypes ",s):(s=g([a],t),f.log("Extracting potential expanding usetypes ",s));let n=!1;for(let t=0,r=s.length;t<r;t++)if(s[t].isSupersetOf(i[e])){f.log("Found fitting expansion. Replacing old ",i[e],"with new ",s[t]),n=!0,i[e]=s[t],s.splice(t,1);break}n||(i[e].disabled=!0)}}if(0===i.length)return[]}return i.forEach(((t,n)=>t.confidence=r[n]/e.length)),i=i.filter((e=>!e.disabled)),i}(e,t);G.log("determineType -- recognizeNumbers -- took ",performance.now()-n),G.log("NumberUsetypes detected: ",r),i.push(...r);let s=performance.now(),a=function(e,t){let n=performance.now(),i=function(e){return E||function(){let e=[];const t=[["{YYYY}","{MM}","{DD}"],["--","{MM}","{DD}"]];e=e.concat(t);const n=[["{YYYY}","-","{MM}","-","{DD}"],["{YYYY}","-","{MM}"],["--","{MM}","-","{DD}"]];e=e.concat(n);const i=[["T","{hh}","{mm}","{ss}",".","{nnn}"],["T","{hh}","{mm}","{ss}"],["T","{hh}","{mm}"],["T","{hh}"]];e=e.concat(i);let r=[];for(let e of t)for(let t of i)r.push(e.concat(t));e=e.concat(r);const s=[["{hh}",":","{mm}",":","{ss}",".","{nnn}"],["{hh}",":","{mm}",":","{ss}"],["{hh}",":","{mm}"]];e=e.concat(s);let a=[];for(let e of n)for(let t of s)a.push(e.concat(["T"],t));e=e.concat(a);const o=[".","-","/"],l=[":","."],u=[" ","\t"],c=[["{DD}","{MM}","{YYYY}"],["{DD}","{MM}","{YY}"],["{MM}","{DD}","{YYYY}"],["{MM}","{DD}","{YY}"],["{YYYY}","{MM}","{DD}"]],h=[["{hh}","{mm}","{ss}","{nnn}"],["{hh}","{mm}","{ss}"],["{hh}","{mm}"]];let p=[];for(let e of c)for(let t of o)p.push(d(e,t));e=e.concat(p);let m=[];for(let e of h)for(let t of l)m.push(d(e,t));e=e.concat(m);let f=[];for(let e of p)for(let t of m)f=f.concat(u.map((n=>[].concat(e,[n],t))));e=e.concat(f),E=e}(),E.map((t=>new z({formatting:t,skipValidation:!0},e)))}(t);if(i=D(e,i),i=k(i),i.length>0)return M.log("recognizeTimestamp -- expected usetypes found."),i;M.log("recognizeTimestamp -- expectedUsetypes -- took ",performance.now()-n),n=performance.now();let r=function(e,t){let n=[],i={},r={},s=Object.keys(B);for(let t of e)a(t).forEach((e=>{r[e]||(r[e]=!0,n.push(e))}));return n.map((e=>new z({formatting:e},t)));function a(e,t=[],n=0){if(""===e)return[[]];if(i[[e,"|",t]])return i[[e,"|",t]];let r=[];for(let i=n,o=s.length;i<o;i++){let n=B[s[i]];if(t.includes(n.category))continue;let o=new RegExp(n.regexBit),l=e.match(o);if(l){let i=[n.category,...t],s=e.split(l[1]),o=s[0],u=s.slice(1).join(l[1]),c=a(o,i);for(let e of c){let t=e.map((e=>U(e).category)).filter((e=>e)),s=a(u,[].concat(i,t));for(let t of s){let i=[].concat(e,[n.label],t);r.push(i)}}}}return r.length>0?(i[[e,"|",t]]=r,r):(i[[e,"|",t]]=[[e]],[[e]])}}(e.slice(0,5),t);return M.log("recognizeTimestamp -- extractedUsetypes === ",r),M.log("recognizeTimestamp -- extractTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=r.filter(F),M.log("recognizeTimestamp -- extractedUsetypes === ",r),M.log("recognizeTimestamp -- filterInvalidUsetypes -- took ",performance.now()-n),n=performance.now(),r=D(e,r),M.log("recognizeTimestamp -- extractedUsetypes === ",r),M.log("recognizeTimestamp -- filterTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),r=k(r),M.log("recognizeTimestamp -- extractedUsetypes === ",r),M.log("recognizeTimestamp -- filterDuplicatesAndSubtypes -- took ",performance.now()-n),n=performance.now(),r}(e,t);G.log("determineType -- recognizeTimestamps -- took ",performance.now()-s),G.log("TimestampUsetypes detected: ",a),i.push(...a)}if(0===i.length){let n=performance.now(),r=function(e,t){console.log("recognizeStrings...");let n=Object.assign({},t);return e.slice(0,10).every((e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)))&&(n.type="url"),[new J(n)]}(e,t);G.log("detemineType -- recognizeSTrings -- took ",performance.now()-n),G.log("StringUsetypes detected: ",r),i=r}return G.groupEnd(),i}function Z(e){if(0===e.length)return!1;if(1===e.length)return e[0].every((e=>1===e.length));let t=e[0],n=e.slice(1);for(let e=0;e<t.length;e++){let i=t[e],r=[];for(let s=0;s<t[e].length;s++){let e=i[s],t=[];for(let i=0;i<n.length;i++){let r=n[i];for(let s=0;s<n[i].length;s++){let n=r[s].indexOf(e);if(-1!==n){t.push([s,n]);break}}}r.push(t.toString())}if(u(r))return!1}return!0}function ee(e,t,n){n||(n=1),t||([e,t]=[0,e]);let i=[];for(let r=e;r<t;r+=n)i.push(r);return i}let te;function ne(e,t,n){console.log("getAppropriateChartTypes",n),n.keys.map((e=>t[e])),n.keys.map((e=>t[e]));let i=[];for(let e in te){let r=te[e],s=!0,a=r.constraints;if(a){let e=a.xAxis;e&&(ie(e,0,t,n.keys)||(s=!1));let i=a.yAxis;i&&(ie(i,0,t,n.values)||(s=!1))}s&&i.push(r.type)}return i.length>1&&console.warn("Multiple potential chart types determined for ",n," as ",i),console.log("getAppropriateChartTypes returns ",i),i}function ie(e,t,n,i,r=!1){if(!e||0===e.length||!i||0===i.length)return!1;if(!r&&e.length!==i.length)return!1;if(r&&1!==e.length)return!1;for(let t in i){let i=e[0];r||(i=e[t]);let s=n[t];if(i.domainType&&i.domainType!==s.domainType)return!1;i.range&&i.range}return!0}function re(e){return["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"][e]}ee(100),ee(0,100,2).map((e=>[e,e+1])),[0,1].map((e=>ee(e,e+99,2))),ee(100).map((e=>[e]));class se{_head=[];_headValid=!1;get head(){return this._headValid||this._checkHeaderValidity(),this._head}_data=[];get height(){return this._data.length}get width(){return(this._data[0]??[]).length}get length(){return this.height*this.width}get data(){return this._data}row(e){return this._data[e]}col(e){return this._data.map((t=>t[e]))}_usetypes=[];get usetypes(){return 0===this._usetypes.length&&this._auto&&this._determineUsetypes(),this._usetypes}_meta={};get meta(){return this._meta}_dataErr=[];get errors(){return this._dataErr}_bindings=[];get size(){return this._bindings.length}get bindings(){return 0===this._bindings.length&&this._auto&&this._createBindings(),this._bindings}_keySets=[];get keySets(){return 0===this._keySets.length&&this._generateKeySets(),this._keySets}_valueSets=[];get valueSets(){return 0===this._valueSets.length&&this._generateValueSets(),this._valueSets}constructor({auto:e=!0}={}){this._auto=e}_reset(){this._head=[],this._data=[],this._dataErr=[],this._meta={},this._usetypes=[],this._keySets=[],this._bindings=[]}setAutomatic(e){this._auto=e}setData(e){this._reset();let t=e.data;1===t[t.length-1].length&&""===t[t.length-1][0]&&(console.log("Removing last empty row..."),t.splice(-1)),t.every((e=>0===e[e.length-1].trim().length))&&(console.log("Remving last empty column..."),t=t.map((e=>e.slice(0,-1))));let n=t.slice(0,20),i=t.slice(t.length-20,t.length),r=n.concat(i).map((e=>e.length)).reduce(((e,t)=>(e[t]?e[t]++:e[t]=1,e)),{});r=function(e){let t=[];for(let n in e)t.push([n,e[n]]);return t}(r),r.sort(((e,t)=>t[1]-e[1]));let s=r[0][0],a=0;for(;t[a++].length!=s;);for(t.splice(0,a-1),a=t.length-1;t[a--].length!=s;);t.splice(a+1,t.length-a),this._head=t[0],this._data=t.slice(1),this._meta=e.meta,this._dataErr=e.errors,this.triggerEvent(oe.sourceChange,e)}loadFromUrl(e,t){Papa.parse(e,{encoding:"utf8",download:!0,skipEmptyFiles:!0,complete:e=>this.setData(e)})}loadFromLocal(e,t){Papa.parse(e,{encoding:"utf8",skipEmptyFiles:!0,complete:e=>this.setData(e)})}setUsetypes(e){this._auto||(this._usetypes=e)}_determineUsetypes(){this._usetypes=[],this._allUsetypes=[];for(let e=0,t=this.width;e<t;e++){let t=X(this.col(e));this._allUsetypes.push(t),1===t.length||t.sort(((e,t)=>e.priority-t.priority)),this._usetypes[e]=t[0]}this._checkHeaderValidity()}_checkHeaderValidity(){this._headValid=!1;for(let e=0;e<this._head.length;e++){let t=this.usetypes[e];console.warn("checkHeaderValidity",this._head[e],t.deformat(this._head[e])),null===t.deformat(this._head[e])&&(this._headValid=!0)}this._headValid||(console.warn("Header seems not to be present, appending usetype information instead..."),this._data=[this._head,...this._data],this._head=this._usetypes.map((e=>e.toString())),this._headValid=!0)}createBindings(e){if(!this._auto)throw new Error("Not implemented");return this._createBindings(),this._bindings}_createBindings(){this._bindings=[];for(let e of this.keySets)for(let t of this.valueSets){if(h(e,t).length>0)continue;let n=ne(this.data,this.usetypes,{keys:e,values:t}),i=n.map((n=>new ae(this,{keyIdxs:e,valueIdxs:t,chartType:n})));console.log("For types ",n,"made bindings ",i),this._bindings=this._bindings.concat(i)}}_generateKeySets(){let e=this.usetypes,t=[...Array(this.usetypes.length).keys()],n=t.filter((t=>e[t].potentialIds)),i=(t.filter((t=>e[t].isConstant)),e.filter((e=>!e.potentialIds&&!e.isConstant))),r=t.filter((t=>!e[t].potentialIds&&!e[t].isConstant)),s=(o=i.map((e=>e.ambiguousSets)),console.log("determinePrimaryKeys(",o,")"),function(e){let t=[...Array(e.length).keys()].reduce(((e,t)=>e.concat(e.map((e=>[t,...e])))),[[]]),n=t.map((()=>!1)),i=[];for(let r in t){if(n[r])continue;let s=t[r];Z(e.filter(((e,t)=>s.includes(t))))&&(i.push(s),n=n.map(((e,n)=>e||c(s,t[n]))))}return i}(o)).map((e=>e.map((e=>r[e])))),a=function(e){let t=[];for(let n=0;n<e.length;n++){let i=!0;for(let t=0;t<e.length;t++)if(n!==t&&c(e[t],e[n])){i=!1;break}i&&t.push(e[n])}return t}(s);var o;a.length!==s.length&&(console.log("minimal keys with respect to inclusion: ",s,a),s=a),this._keySets=n.map((e=>[e])).concat(s),0===this._keySets.length&&(this._keySets=[[-1]])}_generateValueSets(){let e=[];this.usetypes.forEach(((t,n)=>{"ordinal"===t.domainType&&e.push(n)}));let t=e.map((e=>this.usetypes[e])),n=t.filter((e=>"number"===e.type)),i=n.reduce(l,[]),r=i.map((e=>e.map((e=>this.usetypes.indexOf(e))))),s=t.filter((e=>"timestamp"===e.type)),a=s.reduce(l,[]),o=a.map((e=>e.map((e=>this.usetypes.indexOf(e)))));function l(e,t){console.log("aggregateSimilarity",e,t);let n=!1;for(let i of e){let r=[];for(let e of i)e.isSimilarTo(t)&&r.push(e);r.push(t),r.length-1===i.length?(i.push(t),n=!0,console.log("similar to all in group",i)):r.length>1&&(e.push(r),n=!0,console.log("similat to some ",r,"in group",i))}return n||e.push([t]),console.log("->",e),e}console.log("NUMBER SIMILARITY GROUPS",n,i),console.log("TIMESTAMP SIMILARITY gROUPS",s,a),this._valueSets=r.concat(o)}setBindingElementId(e,t){this._bindings[e].boundElementId=t}drawBinding(e){this._drawBinding(this._bindings[e])}_drawBinding(e){!function(e,t,n,i){i.type||(i.type=ne(0,n,i)),i.head||(i.head=[...Object.keys(Array(n.length))]);let r=[],s=[],a=(i.keys.map((e=>i.header[e])).join(", "),i.values.map((e=>i.header[e]))),o=(i.keys.map((e=>n[e])),i.values.map((e=>n[e])));for(let e of t){let t=i.keys.map((t=>e[t])).join(", ");r.push(t);let n=i.values.map((t=>e[t]));n=n.map(((e,t)=>o[t].deformat(e))),s.push(n)}let l=[];for(let e=0;e<i.values.length;e++){let t={label:a[e],data:s.map((t=>t[e])),borderColor:re(e)};l.push(t)}let u={labels:r,datasets:l},c={type:i.type,data:u};console.log("drawChart with opts ",i,"draws with config",c,"from ",s),new Chart(document.getElementById(e),c)}(e.boundElementId,this.data,this.usetypes,{keys:e.keyIdxs,values:e.valueIdxs,header:this.head,type:e.chartType})}_getUsetypedData(e){let t=e._bindOrder;console.log("getUsetypedData ",t);let n=new google.visualization.DataTable;for(let e=0;e<t.length;e++)n.addColumn(this._usetypes[t[e]][0].type,this._head[t[e]]);for(let e=0;e<this._data.length;e++){let i=[];for(let n=0;n<t.length;n++){let r=this._usetypes[t[n]][0].deformat(this._data[e][t[n]]);if(!r&&0!==r)return console.error("In column ",this._head[t[n]]," Could not parse value ",this._data[e][t[n]]," into type ",this._usetypes[t[n]][0]),null;i.push(r)}n.addRow(i)}return n}}class ae{_catalogue;_keyIdxs;get keyIdxs(){return this._keyIdxs}_valueIdxs;get valueIdxs(){return this._valueIdxs}_boundElementId;get boundElementId(){return this._boundElementId}set boundElementId(e){this._boundElementId?console.warn("Binding.boundElementId setter called while already having elId set to ",this._boundElementId):this._boundElementId=e}get usedFeatures(){return this._keyIdxs.concat(this._valueIdxs)}_chartType;get chartType(){return this._chartType}constructor(e,{keyIdxs:t=[],valueIdxs:n=[],chartType:i="",boundElementId:r=null}){this._catalogue=e,this._chartType=i,this._keyIdxs=t,this._valueIdxs=n,r&&(this._boundElementId=r)}}const oe={sourceChange:"dataChanged",usetypeChange:"usetypesChanged",bindingChange:"bindingsChanged"};var le,ue;le=se,ue=Object.values(oe),e.events=le.prototype.events??{},ue.forEach((t=>e.events[t]=[])),Object.assign(le.prototype,e),console.log("Loaded core/Main.js"),window.Catalogue=se,window.Init=function(e){fetch("https://raw.githubusercontent.com/SaNuelson/DataChartRenderer/master/src/json/chart.js.json").then((e=>e.json())).then((t=>{!function(e){if(te)console.error("Chart.js integration template data already defined.");else{te={};for(let t of e.ChartTypes)te[t.label]=t}}(t),e.onChartTemplatesLoaded&&e.onChartTemplatesLoaded()})).catch((e=>console.error(e)))}})();