(()=>{"use strict";const e={events:{},addEventListener(e,t){this.events.hasOwnProperty(e)?this.events[e].push(t):(console.warn(`${this.constructor.name} added event listener for ${e} despite not being pre-defined.`),this.events[e]=[t])},addEventListeners(e){for(const t in e)this.addEventListener(t,e[t])},on(e,t){return this.addEventListener(e,t),this},triggerEvent(e,...t){if(this.events.hasOwnProperty(e))for(let n of this.events[e])n(...t);else console.warn(`${this.constructor.name} triggered unknown event ${e} with args ${t}`)}};class t{constructor(e){if(this.constructor===t)throw new Error("Cannot instantiate base Usetype class.");e.hasNoval&&(this.hasNoval=!0,this.novalVal=e.novalVal),e.isConstant&&(this.isConstant=e.isConstant,this.constantVal=e.constantVal),e.potentialIds&&(this.potentialIds=!0),e.ambiguousSets&&(this.ambiguousSets=e.ambiguousSets),e.limitExceeded&&(this.ignored=!0)}format(e){throw new Error("Abstract baseclass Usetype.format() called.")}deformat(e){throw new Error("Abstract base class Usetype.deformat() called.")}toString(){return"U{undefined}"}toFormatString(){return""}toDebugString(){return"Usetype::Base()"}isSubsetOf(e){throw new Error("Abstract base class Usetype.isSubsetOf() called.")}isSupersetOf(e){throw new Error("Abstract base class Usetype.isSupersetOf() called.")}isEqualTo(e){throw new Error("Abstract base class Usetype.isEqualTo() called.")}isSimilarTo(e){throw new Error("Abstract base class Usetype.isSimilarTo() called.")}compatibleTypes=[];type="undefined";domainType="none";priority=-1}const n={countries:{url:"https://raw.githubusercontent.com/samayo/country-json/master/src/country-by-abbreviation.json",extract:e=>{n.countries.names=e.map((e=>e.country)),n.countries.codes=e.map((e=>e.abbreviation))}},currencies:{url:"https://gist.githubusercontent.com/Fluidbyte/2973986/raw/8bb35718d0c90fdacb388961c98b8d56abc392c9/Common-Currency.json",extract:e=>{let t=Object.keys(e);n.currencies.codes=t,n.currencies.symbols=t.map((t=>e[t].symbol)),n.currencies.nativeSymbols=t.map((t=>e[t].symbol_native))}},cities:{url:"https://raw.githubusercontent.com/lutangar/cities.json/master/cities.json",extract:e=>{n.cities.names=e.map((e=>e.name)),n.cities.codes=e.map((e=>e.country))}}};let i=!1;!function(){if(!i){for(let e in n){let t;fetch(n[e].url).then((e=>e.json())).then((t=>n[e].extract(t))).catch((n=>(console.error("parse.constants.js fetch item",e,"failed with err",n),t.text())))}i=!0}}();const s=function(){let e=n.currencies;return e&&e.symbols?e.symbols:[]},r=function(){let e=n.currencies;return e&&e.abbreviations?e.abbreviations:[]},a=function(e){return["yotta","zetta","exa","peta","tera","giga","mega","kilo","hecto","deca","","deci","centi","milli","micro","nano","pico","femto","atto","zepto","yocto"]},o=function(e){return["Y","Z","E","P","T","G","M","k","h","da","","d","c","m","μ","n","p","f","a","z","y"]},l=function(e){return["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td"]};function u(e){return new Set(e).size!==e.length}function c(e,t){return e.every((e=>t.includes(e)))}function h(e,t){return e.filter((e=>t.includes(e)))}function d(e,t,n=!1,i=!1){let s=e.map((e=>[e,t])).flat(1);return n&&s.splice(0,0,t),i||s.splice(-1,1),s}function p(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let m=(window.verbose??{}).number;if(console.log("parse.num.js verbosity = ",m),m)var f=window.console;else f={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>f[e]=window.console[e]));function g(e,t){const n=(t,n)=>{f.warn(`Number Recognizer (CSV line ${t} = ${e[t]}): ${n}`)},i=[".",","," "," "],s=[".",","],r=(a=i.concat(s),[...new Set(a)]);var a;const o=new RegExp("^["+r.join("")+"\\d]+$");let l=[],u=[],c=!1,h=!1,d=!1,p=!1,m=!1,g=[];for(let t=0,a=e.length;t<a;t++){let a=e[t],f="",x=a.match(/^[^0-9]*[^0-9+-]/);x&&(f=x[0],a=a.replace(x[0],""));let S="",w=a.match(/[^.0-9][^0-9]*$/);w&&(S=w[0],a=a.replace(w[0],""));let T=!1,v=a.match(/e[0-9]+$/);v&&(T=!0,a=a.replace(v[0],""));let _=!1,M=!1,O=a.match(/^[-+]/);if(O&&("+"===O[0]&&(M=!0),_=!0,a=a.replace(O[0],"")),!a.match(o)){n(t,`Stripped sample ${a} not in pure numeric form .`),window.purePat=o;continue}let D=i.filter((e=>a.includes(e))),k=s.filter((e=>a.includes(e))),E=[],A=r.filter((e=>a.includes(e)));if(0!==a.length){if(0===A.length)E.push(["",""]);else if(1===A.length){let e=A[0];y(a,e)&&E.push([e,""]),b(a,e)&&E.push(["",e])}else{let e=!1;for(let t of D)for(let n of k){if(t===n)continue;if(!y(a,t))continue;if(!b(a,n))continue;let i=a.split(t).join("").split(n).join(".");isNaN(parseFloat(i))||(E.push([t,n]),console.error("ALSEP",[t,n]),e=!0)}if(!e){n(t,`Failed to parse ${a} using parseFloat with any combination of separators.`);continue}}f&&l.push(f),S&&u.push(S),c&=_,h&=M,d=!1,p=!1,m&=T,g=g.concat(E)}else n(t,`Sample ${e[t]} empty after stripping process.`)}let S=[];for(let e of g){let n=new x({prefixes:l,suffixes:u,separators:e,integral:!e[1],scientific:m,explicitSign:h},t);S.push(n)}let w=!0;for(;w;){w=!1;for(let e=0;e<S.length;e++){for(let t=0;t<S.length&&(e===t||(S[e].isEqualTo(S[t])||S[e].isSupersetOf(S[t])?(S.splice(t),w=!0):S[t].isSupersetOf(S[e])&&(S.splice(e),w=!0),!w));t++);if(w)break}}return S}function y(e,t){let n=e.split(t);return!(n[0].length>3)&&(3===n[n.length-1].length||!n[n.length-1].match(/^[0-9]+$/))&&n.slice(1,-1).every((e=>3===e.length||e.match(/\D/)))}function b(e,t){let n=e.match(new RegExp(p(t),"g"));return n&&1===n.length}class x extends t{constructor({separators:e=[],prefixes:t=[],suffixes:n=[],scientific:i=!1,strictlyPositive:s=!1,explicitSign:r=!1},a){console.log("Number ctor",a),super(a),e.length>0&&""!==e[0]&&(this.thousandSeparator=e[0]),e.length>1&&""!==e[1]?this.decimalSeparator=e[1]:this.integral=!0,e.length>2&&e[2]===e[0]&&(this.separateDecimalThousands=!0),i&&(this.scientific=!0),s&&(this.strictlyPositive=!0),r&&(this.explicit=!0),this.prefixes=t;let o=S(this.prefixes);"unknown"!==o.type&&(this.prefixes=o.domain,this.prefixPlaceholder=o.type),this.suffixes=n;let l=S(this.suffixes);"unknown"!==l.type&&(this.suffixes=l.domain,this.suffixPlaceholder=l.type)}prefixes=[];suffixes=[];decimalSeparator="";thousandSeparator="";separateDecimalThousands=!1;scientific=!1;explicit=!1;min=void 0;max=void 0;format(e){function t(e,t,n){return(n?e.match(/.{1,3}/g):e.match(/.{1,3}(?=(.{3})*$)/g)).join(t)}let n=this.prefixPlaceholder??this.prefixes,i=this.suffixPlaceholder??this.suffixes;if(this.scientific){let t=e.toFixed(1).indexOf(".")-1;e/=10**t,suffix="e"+t+suffix}this.explicit&&e>=0&&(prefix+="+");var s=(this.decimalPlaces?e.toFixed(this.decimalPlaces):e.toString()).split("."),r=s[0];if(this.integerPlaces>0&&s[0].length<this.integerPlaces&&(r="0".repeat(this.integerPlaces-r.length)+r),r=t(s[0],this.thousandSeparator,!1),this.integral)return n+r+i;var a="0";return s.length>1&&(a=s[1]),this.decimalPlaces>0&&s[1].length<this.decimalPlaces&&(a+="0".repeat(this.decimalPlaces-a.length)),this.separateDecimalThousands&&(a=t(s[1],this.thousandSeparator,!0)),n+r+this.decimalSeparator+a+i}deformat(e){let t=e;return this.prefixes.forEach((e=>t.startsWith(e)&&(t=t.slice(e.length)))),this.suffixes.forEach((e=>t.endsWith(e)&&(t=t.slice(0,t.length-e.length)))),this.decimalSeparator&&(t=t.split(this.decimalSeparator).join(".")),this.thousandSeparator&&(t=t.split(this.thousandSeparator).join("")),isNaN(t)?null:(this._checkDomain(+t),+t)}isSupersetOf(e){return e.prefixes.every((e=>this.prefixes.includes(e)))?e.suffixes.every((e=>this.suffixes.includes(e)))?!(e.decimalSeparator&&this.decimalSeparator!==e.decimalSeparator||e.thousandSeparator&&this.thousandSeparator!==e.thousandSeparator):(e.suffixes.filter((e=>!this.suffixes.includes(e))),!1):(e.prefixes.filter((e=>!this.prefixes.includes(e))),!1)}_checkDomain(e){(!this.min||this.min>e)&&(this.min=e),(!this.max||this.max<e)&&(this.max=e)}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSupersetOf(e)&&e.isSupersetOf(this)}isSimilarTo(e){if(!this.isEqualTo(e))return!1;let t=this.max-this.min,n=e.max-e.min,i=Math.max(t,n);return Math.abs(this.max-e.max)<5*i}toString(){return this.min&&this.max?"N{"+this.format(this.min)+"-"+this.format(this.max)+"}":this.min?"N{"+this.format(this.min)+"}":this.max?"N{"+this.format(this.max)+"}":"N{"+this.format(1234567.654321)+"}"}toFormatString(){return""}toDebugString(){return"Usetype::Number()"}compatibleTypes=[];compatibleTypes=["number"];type="number";domainType="ordinal";priority=2}function S(e){let t=r();if(!e||!(e instanceof Array)||0===e.length||e.every((e=>e.match(/^\s*$/))))return{type:"unknown",format:"unknown",domain:[]};if(e.every((e=>t.includes(e))))return{type:"currency",format:"code",domain:[...t]};let n=s();if(e.every((e=>n.includes(e))))return{type:"currency",format:"symbol",domain:[...n]};let i=o(),u=l(),c=[].concat(i,u);if(e.every((e=>c.includes(e))))return{type:"magnitude",format:"symbol",domain:[...c]};let h=a();return e.every((e=>h.includes(e)))?{type:"magnitude",format:"prefix",domain:[...h]}:{type:"unknown",format:"unknown",domain:[]}}const w={not:e=>(...t)=>!e(...t),both:(e,t)=>(...n)=>e(...n)&&t(...n),either:(e,t)=>(...n)=>e(...n)||t(...n),imply:(e,t)=>(...n)=>!e(...n)||t(...n),implied:(e,t)=>(...n)=>e(...n)||!t(...n)},T=(e,t)=>(...n)=>e(...n)===t(...n);w.equal=T;const v=(...e)=>(...t)=>e.every((e=>e(...t)));w.all=v;const _=(...e)=>(...t)=>e.some((e=>e(...t)));w.any=_;function M(e,t){return e-t}function O(e,t){let n=e[0]-t[0];if(0!==n)return n;let i=e[1]-t[1];if(0!==i)return i;let s=(e[2]??0)-(t[2]??0);return 0!==s?s:(e[3]??0)-(t[3]??0)}w.none=(...e)=>!_(...e),w.notAll=(...e)=>!v(...e),w.equal=T;let D=(window.verbose??{}).time;if(console.log("parse.timestamp.js verbosity = ",D),D)var k=window.console;else k={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>k[e]=window.console[e]));function E(e,t){for(let n=0;n<e.length;n++){for(let i of t)null===i.deformat(e[n])&&(i.disabled=!0);let i=t.filter((e=>!e.disabled));if(0===i.length)return k.log("Batch of usetypes nulled during ",e[n],t),[];t=i}return t}function A(e){for(let t=0;t<e.length;t++){let n=[];for(let i=t+1;i<e.length;i++)e[t].isSupersetOf(e[i])&&n.push(i);e=e.filter(((e,t)=>!n.includes(t)))}return e}var Y;const I=["January","February","March","April","May","June","July","August","September","October","November","December"],j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],C=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function N(e){return function(e){if(u(e.filter((e=>Object.values(V).some((t=>t.label===e))))))return!1;let t=e.map((e=>P[e]));return t=t.filter((e=>e)),!u(t.map((e=>V[e].category)))&&!!function(e){function t(...e){return function(t){return e.every((e=>t.some((t=>z(t).category===e))))}}function n(...e){return function(t){let n=t.map((e=>z(e).category));return e.map((e=>n.indexOf(e))).map(((e,t,n)=>t===n.length-1||e<n[t+1])).reduce(((e,t)=>e&&t),!0)}}function i(e,i){return e instanceof Array&&i instanceof Array?function(t){let n=t.map((e=>z(e).category)).filter((e=>e)),s=e.map((e=>n.indexOf(e))).filter((e=>e>=0)),r=i.map((e=>n.indexOf(e))).filter((e=>e>=0));return Math.max(...s)<Math.min(...r)}:w.imply(t(e,i),n(e,i))}e[0]===V.monthShort.label&&e[2]===V.dayShort.label&&(e[4],V.yearFull.label);const s=w.all(w.imply(t(B.Milliseconds),t(B.Seconds)),w.imply(t(B.Meridiem),t(B.Hours)),w.imply(t(B.Era),t(B.Years))),r=w.all(i(B.Hours,B.Minutes),i(B.Minutes,B.Seconds),i(B.Seconds,B.Milliseconds),i(B.Hours,B.Meridiem),i(B.Years,B.Era),i([B.Years,B.Months,B.Days,B.Era,B.DayOfWeek],[B.Hours,B.Minutes,B.Seconds,B.Milliseconds,B.Meridiem]),w.imply(t(B.Years,B.Months,B.Days),w.any(n(B.Years,B.Months,B.Days),n(B.Days,B.Months,B.Years),n(B.Months,B.Days,B.Years))));return(e=>{let n=[B.Years,B.Months,B.Days,B.Hours,B.Minutes,B.Seconds,B.Milliseconds].map((n=>t(n)(e))),i=n.indexOf(!0),s=n.lastIndexOf(!0);return n.slice(i,s).reduce(((e,t)=>e&&t),!0)})(e)&&s(e)&&r(e)&&(e=>{U.NumericLong,U.NumericMedium,U.NumericShort;const t=e=>{let t=z(e);return t.literal?/^[0-9]/.test(e):t.numeric},n=e=>{let t=z(e);return t.literal?/[0-9]$/.test(e):t.numeric};for(let i=0;i<e.length-1;i++)if(n(e[i])&&t(e[i+1]))return!1;return!0})(e)}(e)}(e.formatting)&&"unknown"!==e.type}const B={Years:1,Months:2,Days:3,Hours:4,Minutes:5,Seconds:6,Milliseconds:7,Era:8,Meridiem:9,DayOfWeek:10},U={NumericShort:0,NumericMedium:1,NumericLong:2,WordShort:3,WordLong:4},V={era:{label:"{EE}",regexBit:"(AD|BC)",category:B.Era,numeric:!1,apply:(e,t)=>e.getFullYear()>0&&"BC"===t&&e.setFullYear(-e.getFullYear()),applyTod:(e,t)=>k.warn("ApplyTOD era called, undefined behaviour"),extract:e=>e.getFullYear()>=0?"AD":"BC",extractTod:e=>k.warn("ExtractTOD era called, undefined behaviour")},yearFull:{label:"{YYYY}",regexBit:"([12][0-9]{3,})",category:B.Years,numeric:!0,subtoken:"yearShort",apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>k.warn("ApplyTOD yearFull called, undefined behaviour"),extract:e=>e.getFullYear().toString().padStart(4,"0"),extractTod:e=>k.warn("ExtractTOD yearFull called, undefined behaviour")},yearShort:{label:"{YY}",regexBit:"([0-9]{2})",category:B.Years,numeric:!0,apply:(e,t)=>e.setFullYear(+t),applyTod:(e,t)=>k.warn("ApplyTOD yearShort called, undefined behaviour"),extract:e=>e.getFullYear().toString(),extractTod:e=>k.warn("ExtractTOD yearShort called, undefined behaviour")},monthFull:{label:"{MM}",regexBit:"(0\\d|1[012])",category:B.Months,numeric:!0,subtoken:"monthShort",apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>k.warn("ApplyTOD monthFull called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString().padStart(2,"0"),extractTod:e=>k.warn("ExtractTOD monthFull called, undefined behaviour")},monthShort:{label:"{M}",regexBit:"(0?\\d|1[012])",category:B.Months,numeric:!0,apply:(e,t)=>e.setMonth(t-1),applyTod:(e,t)=>k.warn("ApplyTOD monthShort called, undefined behaviour"),extract:e=>(e.getMonth()+1).toString(),extractTod:e=>k.warn("ExtractTOD monthShort called, undefined behaviour")},monthName:{label:"{MMMM}",regexBit:"("+I.map((e=>"(?:"+e+")")).join("|")+")",category:B.Months,numeric:!1,subtoken:"monthAbbrev",apply:(e,t)=>e.setMonth(I.indexOf(t)),applyTod:(e,t)=>k.warn("ApplyTOD monthName called, undefined behaviour"),extract:e=>I[e.getMonth()],extractTod:e=>k.warn("ExtractTOD monthName called, undefined behaviour")},monthAbbrev:{label:"{MMM}",regexBit:"("+j.map((e=>"(?:"+e+")")).join("|")+")",category:B.Months,numeric:!1,apply:(e,t)=>e.setMonth(j.indexOf(t)),applyTod:(e,t)=>k.warn("ApplyTOD monthAbbrev called, undefined behaviour"),extract:e=>j[e.getMonth()],extractTod:e=>k.warn("ExtractTOD monthAbbrev called, undefined behaviour")},dayFull:{label:"{DD}",regexBit:"(0[1-9]|[12]\\d|3[01])",category:B.Days,numeric:!0,subtoken:"dayShort",apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>k.warn("ApplyTOD dayFull called, undefined behaviour"),extract:e=>e.getDate().toString().padStart(2,"0"),extractTod:e=>k.warn("ExtractTOD dayFull called, undefined behaviour")},dayShort:{label:"{D}",regexBit:"(0?[1-9]|[12]\\d|3[01])",category:B.Days,numeric:!0,apply:(e,t)=>e.setDate(+t),applyTod:(e,t)=>k.warn("ApplyTOD dayShort called, undefined behaviour"),extract:e=>e.getDate().toString(),extractTod:e=>k.warn("ExtractTOD dayShort called, undefined behaviour")},dayOfWeekFull:{label:"{DDDD}",category:B.DayOfWeek,numeric:!1,subtoken:"dayOfWeekShort",regexBit:"("+C.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>k.warn("Apply dayOfWeekFull called, undefined behaviour"),applyTod:(e,t)=>k.warn("ApplyTOD dayOfWeekFull called, undefined behaviour"),extract:e=>C[e.getDay()],extractTod:e=>k.warn("ExtractTOD dayOfWeekFull called, undefined behaviour")},dayOfWeekShort:{label:"{DDD}",category:B.DayOfWeek,numeric:!1,regexBit:"("+F.map((e=>"(?:"+e+")")).join("|")+")",apply:(e,t)=>k.warn("Apply dayOfWeekShort called, undefined behaviour"),applyTod:(e,t)=>k.warn("ApplyTOD dayOfWeekShort called, undefined behaviour"),extract:e=>F[e.getDay()],extractTod:e=>k.warn("ExtractTOD dayOfWeekShort called, undefined behaviour")},meridiem:{label:"{RR}",regexBit:"(AM|PM)",category:B.Meridiem,numeric:!1,apply:(e,t)=>{let n=e.getHours();"PM"===t&&n<12?e.setHours(n+12):"AM"===t&&12===n&&cate.setHours(0)},applyTod:(e,t)=>k.warn("ApplyTOD meridiem called, undefined behaviour"),extract:e=>e.getHours()<12||0===e.getHours()?"AM":"PM",extractTod:e=>e[0]<12||0===e[0]?"AM":"PM"},hourFull:{label:"{hh}",regexBit:"([01]\\d|2[0-3])",category:B.Hours,numeric:!0,subtoken:"hourShort",apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(V.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(V.meridiem.label)&&(n%=12),n.toString().padStart(2,"0")}},hourShort:{label:"{h}",regexBit:"([01]?\\d|2[0-3])",category:B.Hours,numeric:!0,apply:(e,t)=>e.setHours(t),applyTod:(e,t)=>e[0]=t,extract:(e,t)=>{let n=e.getHours();return t&&t.includes(V.meridiem.label)&&(n%=12),n.toString()},extractTod:(e,t)=>{let n=e[0];return t&&t.includes(V.meridiem.label)&&(n%=12),n.toString()}},minuteFull:{label:"{mm}",regexBit:"([0-5]\\d)",category:B.Minutes,numeric:!0,subtoken:"minuteShort",apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString().padStart(2,"0"),extractTod:e=>e[1].toString().padStart(2,"0")},minuteShort:{label:"{m}",regexBit:"([0-5]?\\d)",category:B.Minutes,numeric:!0,apply:(e,t)=>e.setMinutes(t),applyTod:(e,t)=>e[1]=t,extract:e=>e.getMinutes().toString(),extractTod:e=>e[1].toString()},secondFull:{label:"{ss}",regexBit:"([0-5]\\d)",category:B.Seconds,numeric:!0,subtoken:"secondShort",apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString().padStart(2,"0"),extractTod:e=>e[2].toString().padStart(2,"0")},secondShort:{label:"{s}",regexBit:"([0-5]?\\d)",category:B.Seconds,numeric:!0,apply:(e,t)=>e.setSeconds(t),applyTod:(e,t)=>e[2]=t,extract:e=>e.getSeconds().toString(),extractTod:e=>e[2].toString()},millisecondFull:{label:"{nnn}",regexBit:"(\\d{3})",category:B.Milliseconds,numeric:!0,subtoken:"millisecondShort",apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString().padStart(3,"0"),extractTod:e=>e[3].toString().padStart(3,"0")},millisecondShort:{label:"{n}",regexBit:"(\\d{,3})",category:B.Milliseconds,numeric:!0,apply:(e,t)=>e.setMilliseconds(t),applyTod:(e,t)=>e[3]=t,extract:e=>e.getMilliseconds().toString(),extractTod:e=>e[3].toString()}};function z(e){return function(e){return V[e]}(function(e){return P[e]}(e))||{literal:!0}}delete V.yearShort,delete V.millisecondShort;const P=(()=>{let e={};for(let t in V)e[V[t].label]=t;return e})();function H(){return new Date(2e3,3,21,15,20,25,30)}class $ extends t{constructor(e,t){super(t);let n=e.type;n||(n="none");let i="none";e.min&&(this.min=e.min,i=isValidDate(e.min)?"datetime":isValidTimeOfDay(e.min)?"timeofday":"unknown");let s="none";e.max&&(this.max=e.max,s=isValidDate(e.max)?"datetime":isValidTimeOfDay(e.max)?"timeofday":"unknown");let r=[i,s,n,function(e){let t=e.map((e=>P[e]));t=t.filter((e=>e));let n=t.map((e=>V[e].category));const i=[B.Hours,B.Minutes,B.Seconds,B.Milliseconds],s=[B.Years,B.Months,B.Days,B.Era];let r=!1;n.some((e=>s.includes(e)))&&(r=!0);let a=!1;return n.some((e=>i.includes(e)))&&(a=!0),a&&r?"datetime":a?"timeofday":r?"date":"unknown"}(e.formatting)];if(r=r.filter((e=>"none"!==e)),r.every((e=>e===r[0]))||(this.timestampType="unknown"),this.timestampType=r[0],this.formatting=[...e.formatting],!e.skipValidation&&!N(this))return void(this.timestampType="unknown");let a=[],o=[],l=[],u=[],c=[],h="apply",d="extract";"timeofday"===this.timestampType&&(h="applyTod",d="extractTod"),this.formatting.forEach((e=>{if(void 0!==P[e]){let t=z(e);a.push(t.regexBit),o.push(t[h]),l.push(t[d]),u.push(W(e,t[h])),c.push(W(e,t[d]))}else a.push(p(e)),l.push((()=>e))}));let m=new RegExp(a.join(""));this._extractors=l,this._pattern=m,this._appliers=o,this._verboseAppliers=u,this._verboseExtractors=c}min=null;max=null;formatting=null;timestampType="none";pattern=null;replacement=null;type="timestamp";domainType="ordinal";priority=3;toString(){let e="";var t;this.min&&this.max?e=this.format(this.min)+"-"+this.format(this.max):this.min||this.max?e=this.format(this.min?this.min:this.max):"datetime"===this.timestampType||"date"===this.timestampType?e=this.format(H()):"timeofday"===this.timestampType&&(e=this.format([(t=H()).getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]));let n="X";return"date"===this.timestampType?n="D":"datetime"===this.timestampType?n="DT":"timeofday"===this.timestampType&&(n="TOD"),n+"{"+e+"}"}format(e,t=!1){return t?this._verboseExtractors.map((t=>t(e,this.formatting))).join(""):this._extractors.map((t=>t(e,this.formatting))).join("")}deformat(e,t=!1){let n=null;if("timeofday"===this.timestampType)n=[15,20,25,30];else{if(!["time","date","datetime"].includes(this.timestampType))return t&&k.warn("Timestamp ",this.formatting," deformat(",e,") failed due to invalid type."),n;n=H()}let i=e.match(this._pattern);return i?(t?this._verboseAppliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))):this._appliers.forEach(((e,t)=>e(n,i[t+1],this.formatting))),e!==this.format(n,t)?(t&&k.warn("Timestamp ",this.formatting," deformat(",e,") = ",n," vs consistency check ",this.format(n)),null):(this._checkDomain(n),n)):(t&&k.warn("Timestamp ",this.formatting," deformat(",e,") failed to match to pattern"),null)}isSupersetOf(e){if(this.formatting.length!==e.formatting.length)return!1;for(let t=0,n=this.formatting.length;t<n;t++){let n=z(this.formatting[t]),i=V[n.subtoken],s=z(e.formatting[t]);if(n.literal){if(!s.literal)return!1;if(this.formatting[t]!==e.formatting[t])return!1}else if(s!==n&&s!==i)return!1}return!0}isSubsetOf(e){return e.isSupersetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}_checkDomain(e){let t;if("timeofday"===this.timestampType)t=O;else{if("date"!==this.timestampType)return;t=M}(!this.min||t(this.min,e)>0)&&(this.min=e),(!this.max||t(this.max,e)<0)&&(this.max=e)}static fromShortFormatting(e){let t=[];for(let e in V)t.push(V[e].label.slice(1,-1));let n=e,i=[];for(;n.length>0;){let e=t.filter((e=>n.startsWith(e)));if(e.length>0){let t=e.reduce(((e,t)=>e.length<t.length?t:e),"");i.push("{"+t+"}"),n=n.slice(t.length)}else i.push(n[0]),n=n.slice(1)}return i[0]=[i[0]],i=i.reduce(((e,t)=>e[e.length-1].endsWith("}")||t.startsWith("{")?(e.push(t),e):(e[e.length-1]=e[e.length-1]+t,e))),new $({formatting:i})}}function W(e,t){return function(n,i){k.log("Function ",e,"(",n,i,") => ");let s=t(n,i);return k.log(n),s}}let L=(window.verbose??{}).enum;if(console.log("parse.enum.js verbosity = ",L),L)var q=window.console;else q={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>q[e]=window.console[e]));class R extends t{domain=[];constructor({domain:e=[]},t){super(t),e&&(this.domain=e)}format(e){return this.domain.includes(e)?e:void 0}deformat(e){return this.domain.includes(e)?e:void 0}isSubsetOf(e){return this.domain.every((t=>e.domain.includes(t)))}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}size(){return this.domain.length}toString(){return`E{[${this.domain}]}`}toDebugString(){return`Usetype.Enum([${this.domain}])`}compatibleTypes=["string"];type="string";domainType="nominal";priority=1}let J=(window.verbose??{}).string;if(console.log("parse.string.js verbosity = ",J),J)var K=window.console;else K={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>K[e]=window.console[e]));class Q extends t{constructor(e){super(e),e.potentialIds&&(this.unique=!0),e.constant&&(this.constant=!0,this.constantValue=e.constant),e.type&&(this.kind=e.type)}format(e){return e.toString()}deformat(e){return e.toString()}isSubsetOf(e){return e.type===this.type||this.type&&!e.type}isSupersetOf(e){return e.isSubsetOf(this)}isEqualTo(e){return this.isSubsetOf(e)&&this.isSupersetOf(e)}isSimilarTo(e){return this.isSubsetOf(e)||this.isSupersetOf(e)}toString(){return this.unique?"SID{"+(this.type??"")+"}":this.constant?"SC("+this.constantValue+"){"+(this.type??"")+"}":"S{"+(this.kind??"")+"}"}compatibleTypes=["string"];type="string";domainType="nominal";priority=0}let X=(window.verbose??{}).parser;if(console.log("parse.main.js verbosity = ",X),X)var G=window.console;else G={},Object.getOwnPropertyNames(window.console).filter((e=>"function"==typeof window.console[e])).forEach((e=>G[e]=window.console[e]));const Z={skipConstants:!1,sizeHardLimit:50,sampleSize:500};function ee(e,t){t||(t=Object.assign({},Z)),G.groupCollapsed(`detemineType(${e.length>0?e[0]+"...":[]})`),G.log("args = ",t);let n=[],i=function(e,t){if(!t.sizeHardLimit)return!0;let n=e.every((e=>e.length<t.sizeHardLimit));return n||(t.limitExceeded=!0),n}(e,t),s=[];if(i&&([e,s,t]=function(e,t){let n=function(e){if(!e||0===e.length)return[];let t={};for(let n in e)t[e[n]]||(t[e[n]]=[]),t[e[n]].push(n);console.log("Value indexes",t);let n=[];for(let e in t)n.push([e,t[e].length]);if(n=n.sort(((e,t)=>e[1]-t[1])),1===n.length)return[{isConstant:!0,constantVal:n[0][0]}];if(n.length===e.length)return[{potentialIds:!0,ambiguousSets:[]}];let i=[];for(let e in t)t[e].length>1&&i.push(t[e]);return e.length/n.length>.5&&n[0][1]>=2&&n.length>2?[new R({domain:n.map((e=>e[0]))},{ambiguousSets:i})]:n[n.length-1][1]/n[n.length-2][1]>2&&n[n.length-2][1]>0?[{hasNoval:!0,novalVal:n[n.length-1][0],ambiguousSets:i}]:[{ambiguousSets:i}]}(e);console.log("preprocessEnumlikeness",n);let i=n[0];return i?i.hasNoval?(G.log("NOVAL detected as ",i.noval),t.hasNoval=!0,t.novalValue=i.novalVal,t.ambiguousSets=i.ambiguousSets,e=e.filter((e=>e!==t.noval)),n=[]):i.isConstant?(G.log("CONSTANT detected as ",i.constant),t.isConstant=!0,t.constantVal=i.constantVal,e=[e[0]],n=[]):i.potentialIds?(G.log("POTENTIAL ID column found"),t.potentialIds=!0,n=[]):i.ambiguousSets?(t.ambiguousSets=i.ambiguousSets,n=[]):(G.log("Enum usetype detected as ",i),t.ambiguousSets=i.ambiguousSets):n=[],console.log("args after enum ",t),[e,n,t]}(e,t),n.push(...s)),(!t.skipConstants||!t.isConstant)&&i){let i=performance.now(),s=function(e,t){if(!e||0===e.length)return[];let n=[];n=[...e].sort().slice(0,5),f.log("recognizeNum -- initial batch = ",n);let i=g(n,t);f.log("extractedNumUsetypes",i);let s=i.map((()=>0));for(let n=0,r=e.length;n<r;n++){let r,a=e[n];for(let e=0,n=i.length;e<n;e++)if(!i[e].disabled){let n=i[e].deformat(a);if(n)s[e]++,i[e].max<n&&(i[e].max=n),i[e].min>n&&(i[e].min=n);else{f.log("Matching",i[e],"against",a,"failed, disabling potential format."),f.log("Trying to recover expanded number usetype..."),r?f.log("Using pre-extracted potential usetypes ",r):(r=g([a],t),f.log("Extracting potential expanding usetypes ",r));let n=!1;for(let t=0,s=r.length;t<s;t++)if(r[t].isSupersetOf(i[e])){f.log("Found fitting expansion. Replacing old ",i[e],"with new ",r[t]),n=!0,i[e]=r[t],r.splice(t,1);break}n||(i[e].disabled=!0)}}if(0===i.length)return[]}return i.forEach(((t,n)=>t.confidence=s[n]/e.length)),i=i.filter((e=>!e.disabled)),i}(e,t);G.log("determineType -- recognizeNumbers -- took ",performance.now()-i),G.log("NumberUsetypes detected: ",s),n.push(...s);let r=performance.now(),a=function(e,t){let n=performance.now(),i=function(e){return Y||function(){let e=[];const t=[["{YYYY}","{MM}","{DD}"],["--","{MM}","{DD}"]];e=e.concat(t);const n=[["{YYYY}","-","{MM}","-","{DD}"],["{YYYY}","-","{MM}"],["--","{MM}","-","{DD}"]];e=e.concat(n);const i=[["T","{hh}","{mm}","{ss}",".","{nnn}"],["T","{hh}","{mm}","{ss}"],["T","{hh}","{mm}"],["T","{hh}"]];e=e.concat(i);let s=[];for(let e of t)for(let t of i)s.push(e.concat(t));e=e.concat(s);const r=[["{hh}",":","{mm}",":","{ss}",".","{nnn}"],["{hh}",":","{mm}",":","{ss}"],["{hh}",":","{mm}"]];e=e.concat(r);let a=[];for(let e of n)for(let t of r)a.push(e.concat(["T"],t));e=e.concat(a);const o=[".","-","/"],l=[":","."],u=[" ","\t"],c=[["{DD}","{MM}","{YYYY}"],["{DD}","{MM}","{YY}"],["{MM}","{DD}","{YYYY}"],["{MM}","{DD}","{YY}"],["{YYYY}","{MM}","{DD}"]],h=[["{hh}","{mm}","{ss}","{nnn}"],["{hh}","{mm}","{ss}"],["{hh}","{mm}"]];let p=[];for(let e of c)for(let t of o)p.push(d(e,t));e=e.concat(p);let m=[];for(let e of h)for(let t of l)m.push(d(e,t));e=e.concat(m);let f=[];for(let e of p)for(let t of m)f=f.concat(u.map((n=>[].concat(e,[n],t))));e=e.concat(f),Y=e}(),Y.map((t=>new $({formatting:t,skipValidation:!0},e)))}(t);if(i=E(e,i),i=A(i),i.length>0)return k.log("recognizeTimestamp -- expected usetypes found."),i;k.log("recognizeTimestamp -- expectedUsetypes -- took ",performance.now()-n),n=performance.now();let s=function(e,t){let n=[],i={},s={},r=Object.keys(V);for(let t of e)a(t).forEach((e=>{s[e]||(s[e]=!0,n.push(e))}));return n.map((e=>new $({formatting:e},t)));function a(e,t=[],n=0){if(""===e)return[[]];if(i[[e,"|",t]])return i[[e,"|",t]];let s=[];for(let i=n,o=r.length;i<o;i++){let n=V[r[i]];if(t.includes(n.category))continue;let o=new RegExp(n.regexBit),l=e.match(o);if(l){let i=[n.category,...t],r=e.split(l[1]),o=r[0],u=r.slice(1).join(l[1]),c=a(o,i);for(let e of c){let t=e.map((e=>z(e).category)).filter((e=>e)),r=a(u,[].concat(i,t));for(let t of r){let i=[].concat(e,[n.label],t);s.push(i)}}}}return s.length>0?(i[[e,"|",t]]=s,s):(i[[e,"|",t]]=[[e]],[[e]])}}(e.slice(0,5),t);return k.log("recognizeTimestamp -- extractedUsetypes === ",s),k.log("recognizeTimestamp -- extractTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),s=s.filter(N),k.log("recognizeTimestamp -- extractedUsetypes === ",s),k.log("recognizeTimestamp -- filterInvalidUsetypes -- took ",performance.now()-n),n=performance.now(),s=E(e,s),k.log("recognizeTimestamp -- extractedUsetypes === ",s),k.log("recognizeTimestamp -- filterTimestampUsetypes -- took ",performance.now()-n),n=performance.now(),s=A(s),k.log("recognizeTimestamp -- extractedUsetypes === ",s),k.log("recognizeTimestamp -- filterDuplicatesAndSubtypes -- took ",performance.now()-n),n=performance.now(),s}(e,t);G.log("determineType -- recognizeTimestamps -- took ",performance.now()-r),G.log("TimestampUsetypes detected: ",a),n.push(...a)}if(0===n.length){let i=performance.now(),s=function(e,t){console.log("recognizeStrings...");let n=Object.assign({},t);return e.slice(0,10).every((e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)))&&(n.type="url"),[new Q(n)]}(e,t);G.log("detemineType -- recognizeSTrings -- took ",performance.now()-i),G.log("StringUsetypes detected: ",s),n=s}return G.groupEnd(),n}function te(e){if(0===e.length)return!1;if(1===e.length)return e[0].every((e=>1===e.length));let t=e[0],n=e.slice(1);for(let e=0;e<t.length;e++){let i=t[e],s=[];for(let r=0;r<t[e].length;r++){let e=i[r],t=[];for(let i=0;i<n.length;i++){let s=n[i];for(let r=0;r<n[i].length;r++){let n=s[r].indexOf(e);if(-1!==n){t.push([r,n]);break}}}s.push(t)}for(let e=0;e<i.length;e++)if(s.map((t=>t[e])).filter((e=>void 0!==e)).some((e=>u(e.filter((e=>void 0!==e))))))return!1}return!0}let ne;function ie(e,t,n){console.log("getAppropriateChartTypes",n),n.keys.map((e=>t[e])),n.keys.map((e=>t[e]));let i=[];for(let e in ne){let s=ne[e],r=!0,a=s.constraints;if(a){let e=a.xAxis;e&&(se(e,0,t,n.keys)||(r=!1));let i=a.yAxis;i&&(se(i,0,t,n.values)||(r=!1))}r&&i.push(s.type)}return i.length>1&&console.warn("Multiple potential chart types determined for ",n," as ",i),console.log("getAppropriateChartTypes returns ",i),i}function se(e,t,n,i,s=!1){if(console.log("checkConstraints ",e,i),!e||0===e.length||!i||0===i.length)return!1;if(!s&&e.length!==i.length)return!1;if(s&&1!==e.length)return!1;for(let t in i){let r=e[0];s||(r=e[t]);let a=n[i[t]];if(r.domainType&&r.domainType!==a.domainType)return console.log("domainType discrepancy ",r,a),!1;if(r.type&&r.type!==a.type)return console.log("type discrepancy ",r,a),!1;r.range&&r.range}return!0}function re(e){return["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"][e]}class ae{_head=[];_headValid=!1;get head(){return this._headValid||this._checkHeaderValidity(),this._head}_data=[];get height(){return this._data.length}get width(){return(this._data[0]??[]).length}get length(){return this.height*this.width}get data(){return this._data}row(e){return this._data[e]}col(e){return this._data.map((t=>t[e]))}_usetypes=[];get usetypes(){return 0===this._usetypes.length&&this._auto&&this._determineUsetypes(),this._usetypes}_meta={};get meta(){return this._meta}_dataErr=[];get errors(){return this._dataErr}_bindings=[];get size(){return this._bindings.length}get bindings(){return 0===this._bindings.length&&this._auto&&this._createBindings(),this._bindings}_keySets=[];get keySets(){return 0===this._keySets.length&&this._generateKeySets(),this._keySets}_valueSets=[];get valueSets(){return 0===this._valueSets.length&&this._generateValueSets(),this._valueSets}constructor({auto:e=!0}={}){this._auto=e}_reset(){this._head=[],this._data=[],this._dataErr=[],this._meta={},this._usetypes=[],this._keySets=[],this._valueSets=[],this._bindings=[];for(let e in Chart.instances)Chart.instances[e].destroy()}setAutomatic(e){this._auto=e}setData(e){this._reset();let t=e.data;1===t[t.length-1].length&&""===t[t.length-1][0]&&t.splice(-1),t.every((e=>0===e[e.length-1].trim().length))&&(t=t.map((e=>e.slice(0,-1))));let n=t.slice(0,20),i=t.slice(t.length-20,t.length),s=n.concat(i).map((e=>e.length)).reduce(((e,t)=>(e[t]?e[t]++:e[t]=1,e)),{});s=function(e){let t=[];for(let n in e)t.push([n,e[n]]);return t}(s),s.sort(((e,t)=>t[1]-e[1]));let r=s[0][0],a=0;for(;t[a++].length!=r;);for(t.splice(0,a-1),a=t.length-1;t[a--].length!=r;);t.splice(a+1,t.length-a),this._head=t[0],this._data=t.slice(1),this._meta=e.meta,this._dataErr=e.errors,this.triggerEvent(le.sourceChange,e)}loadFromUrl(e,t){Papa.parse(e,{encoding:"utf8",download:!0,skipEmptyFiles:!0,complete:e=>this.setData(e)})}loadFromLocal(e,t){Papa.parse(e,{encoding:"utf8",skipEmptyFiles:!0,complete:e=>this.setData(e)})}setUsetypes(e){this._auto||(this._usetypes=e)}_determineUsetypes(){this._usetypes=[],this._allUsetypes=[];for(let e=0,t=this.width;e<t;e++){let t=ee(this.col(e));this._allUsetypes.push(t),1===t.length||t.sort(((e,t)=>t.priority-e.priority)),this._usetypes[e]=t[0]}this._checkHeaderValidity()}_checkHeaderValidity(){this._headValid=!1;for(let e=0;e<this._head.length;e++){let t=this.usetypes[e];t.hasNoval&&(t.novalVal,this._head[e]),null===t.deformat(this._head[e])&&(this._headValid=!0)}this._headValid||(console.warn("Header seems not to be present, appending usetype information instead..."),this._data=[this._head,...this._data],this._head=this._usetypes.map((e=>e.toString())),this._headValid=!0)}createBindings(e){if(!this._auto)throw new Error("Not implemented");return this._createBindings(),this._bindings}_createBindings(){this._bindings=[];for(let e of this.keySets)for(let t of this.valueSets){console.log("for sets",e,t);let n=h(e,t);if(n.length>0){if(n.length===e.length||n.length===t.length)continue;t=t.filter((e=>!n.includes(e)))}let i=ie(this.data,this.usetypes,{keys:e,values:t}).map((n=>new oe(this,{keyIdxs:e,valueIdxs:t,chartType:n})));this._bindings=this._bindings.concat(i)}}_generateKeySets(){let e=this.usetypes,t=[...Array(this.usetypes.length).keys()],n=t.filter((t=>e[t].potentialIds)),i=(t.filter((t=>e[t].isConstant)),e.filter((e=>!e.potentialIds&&!e.isConstant&&!e.ignored))),s=t.filter((t=>!e[t].potentialIds&&!e[t].isConstant)),r=(o=i.map((e=>e.ambiguousSets)),function(e){let t=[...Array(e.length).keys()].reduce(((e,t)=>e.concat(e.map((e=>[t,...e])))),[[]]),n=t.map((()=>!1)),i=[];for(let s in t){if(n[s])continue;let r=t[s];te(e.filter(((e,t)=>r.includes(t))))&&(i.push(r),n=n.map(((e,n)=>e||c(r,t[n]))))}return i}(o)).map((e=>e.map((e=>s[e])))),a=function(e){let t=[];for(let n=0;n<e.length;n++){let i=!0;for(let t=0;t<e.length;t++)if(n!==t&&c(e[t],e[n])){i=!1;break}i&&t.push(e[n])}return t}(r);var o;a.length!==r.length&&(r=a),this._keySets=n.map((e=>[e])).concat(r),0===this._keySets.length&&(this._keySets=[[-1]])}_generateValueSets(){let e=[];this.usetypes.forEach(((t,n)=>{"ordinal"===t.domainType&&e.push(n)}));let t=e.map((e=>this.usetypes[e])),n=t.filter((e=>"number"===e.type)).reduce(s,[]).map((e=>e.map((e=>this.usetypes.indexOf(e))))),i=t.filter((e=>"timestamp"===e.type)).reduce(s,[]).map((e=>e.map((e=>this.usetypes.indexOf(e)))));function s(e,t){let n=!1;for(let i of e){let s=[];for(let e of i)e.isSimilarTo(t)&&s.push(e);s.push(t),s.length-1===i.length?(i.push(t),n=!0):s.length>1&&(e.push(s),n=!0)}return n||e.push([t]),e}this._valueSets=n.concat(i)}setBindingElementId(e,t){this._bindings[e].boundElementId=t}drawBinding(e){this._drawBinding(this._bindings[e])}_drawBinding(e){!function(e,t,n,i){if(i.type||(i.type=ie(0,n,i)[0]),i.head||(i.head=[...Object.keys(Array(n.length))]),"bubble"===i.type)return function(e,t,n,i){let s,r=[],a=i.keys[0],o=n[a],l=i.header[a],u=i.keys[1],c=n[u],h=i.header[u],d=i.values[0],p=n[d],m=i.header[d],f=0;for(let e of t){let t=o.deformat(e[a]),n=c.deformat(e[u]),i=p.deformat(e[d]);r.push({x:t,y:n,r:i}),f=Math.max(f,i)}if(f>10){s=Math.floor(Math.log10(f)),console.log(f,s);for(let e of r)console.log(e.r),e.r/=10**s,console.log(e.r)}let g={type:i.type,data:{datasets:[{label:"("+l+")x("+h+") => "+m+(s?"(e"+s+")":""),data:r,borderColor:re(0),backgroundColor:re(1)}]}};return new Chart(document.getElementById(e),g)}(e,t,n,i);let s=[],r=[],a=i.keys.map((e=>i.header[e])).join(", "),o=i.values.map((e=>i.header[e])),l=i.keys.map((e=>n[e])),u=i.values.map((e=>n[e]));for(let e of t){let t=i.keys.map((t=>e[t])).join(", ");r.push(t);let n={};n.x=t;for(let t=0;t<u.length;t++)n["y"+t]=u[t].deformat(e[i.values[t]]);s.push(n)}let c=[];for(let e=0;e<u.length;e++){let t={label:o[e],data:s,parsing:{yAxisKey:"y"+e},borderColor:re(e)};c.push(t)}let h={labels:r,datasets:c},d={scales:{}};d.scales.x={scaleLabel:{display:!0,labelString:a}},1===l.length&&"timestamp"===l[0].type&&(d.scales.x.type="time"),1===l.length&&l[0].min&&(d.scales.x.min=l[0].min,d.scales.x.max=l[0].max);for(let e=0;e<u.length;e++)d.scales["y"+e]={scaleLabel:{display:!0,labelString:"TEST"+o[e]}},"timestamp"===u[e].type&&(d.scales["y"+e]={type:"time"}),u[e].min&&(d.scales["y"+e]=d.scales["y"+e]??{},d.scales["y"+e].min=u[e].min,d.scales["y"+e].max=u[e].max,console.log("MINMAX",u[e].min,u[e].max));let p={type:i.type,data:h,options:d};new Chart(document.getElementById(e),p)}(e.boundElementId,this.data,this.usetypes,{keys:e.keyIdxs,values:e.valueIdxs,header:this.head,type:e.chartType})}_getUsetypedData(e){let t=e._bindOrder;console.log("getUsetypedData ",t);let n=new google.visualization.DataTable;for(let e=0;e<t.length;e++)n.addColumn(this._usetypes[t[e]][0].type,this._head[t[e]]);for(let e=0;e<this._data.length;e++){let i=[];for(let n=0;n<t.length;n++){let s=this._usetypes[t[n]][0].deformat(this._data[e][t[n]]);if(!s&&0!==s)return console.error("In column ",this._head[t[n]]," Could not parse value ",this._data[e][t[n]]," into type ",this._usetypes[t[n]][0]),null;i.push(s)}n.addRow(i)}return n}}class oe{_catalogue;_keyIdxs;get keyIdxs(){return this._keyIdxs}_valueIdxs;get valueIdxs(){return this._valueIdxs}_boundElementId;get boundElementId(){return this._boundElementId}set boundElementId(e){this._boundElementId?console.warn("Binding.boundElementId setter called while already having elId set to ",this._boundElementId):this._boundElementId=e}get usedFeatures(){return[this._keyIdxs,this._valueIdxs]}_chartType;get chartType(){return this._chartType}constructor(e,{keyIdxs:t=[],valueIdxs:n=[],chartType:i="",boundElementId:s=null}){this._catalogue=e,this._chartType=i,this._keyIdxs=t,this._valueIdxs=n,s&&(this._boundElementId=s)}}const le={sourceChange:"dataChanged",usetypeChange:"usetypesChanged",bindingChange:"bindingsChanged"};var ue,ce;ue=ae,ce=Object.values(le),e.events=ue.prototype.events??{},ce.forEach((t=>e.events[t]=[])),Object.assign(ue.prototype,e),console.log("Loaded core/Main.js"),window.Catalogue=ae,window.Init=function(e){fetch("https://raw.githubusercontent.com/SaNuelson/DataChartRenderer/master/src/json/chart.js.json").then((e=>e.json())).then((t=>{!function(e){if(ne)console.error("Chart.js integration template data already defined.");else{ne={};for(let t of e.ChartTypes)ne[t.label]=t}}(t),e.onChartTemplatesLoaded&&e.onChartTemplatesLoaded()})).catch((e=>console.error(e)))}})();